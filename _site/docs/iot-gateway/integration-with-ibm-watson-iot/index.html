

<!Doctype html>
<html id="docs" class="Thingsboard Documentation">



<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	
	<!-- Begin Jekyll SEO tag v2.0.0 -->
<title>Integration with IBM Watson IoT - Thingsboard</title>
<meta property="og:title" content="Integration with IBM Watson IoT" />
<meta name="description" content="Streaming IBM Watson IoT data to Thingsboard for advanced IoT data visualization" />
<meta property="og:description" content="Streaming IBM Watson IoT data to Thingsboard for advanced IoT data visualization" />
<link rel="canonical" href="http://localhost:4000/docs/iot-gateway/integration-with-ibm-watson-iot/" />
<meta property="og:url" content="http://localhost:4000/docs/iot-gateway/integration-with-ibm-watson-iot/" />
<meta property="og:site_name" content="Thingsboard" />
<meta property="og:image" content="http://localhost:4000/images/thingsboard_logo.png" />
<meta name="twitter:image" content="http://localhost:4000/images/thingsboard_logo.png" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="@thingsboard" />
<meta name="twitter:creator" content="@thingsboard" />
<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "WebPage",
    "headline": "Integration with IBM Watson IoT",
    "image": "http://localhost:4000/images/thingsboard_logo.png",
    "description": "Streaming IBM Watson IoT data to Thingsboard for advanced IoT data visualization",
    "logo": "http://localhost:4000/images/thingsboard_logo.png",
    "url": "http://localhost:4000/docs/iot-gateway/integration-with-ibm-watson-iot/"
  }
</script>
<!-- End Jekyll SEO tag -->
	
	
	<meta name="twitter:description" content="Streaming IBM Watson IoT data to Thingsboard for advanced IoT data visualization"/>
	
	
	<link rel="shortcut icon" type="image/png" href="/images/favicon.png">
	<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700" rel="stylesheet">
	<link rel="stylesheet" href="/css/styles.css">
	<script type="text/javascript">
		/*! loadCSS. [c]2017 Filament Group, Inc. MIT License */
		!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);
		/*! onloadCSS. (onload callback for loadCSS) [c]2017 Filament Group, Inc. MIT License */
		function onloadCSS(a,b){function c(){!d&&b&&(d=!0,b.call(a))}var d;a.addEventListener&&a.addEventListener("load",c),a.attachEvent&&a.attachEvent("onload",c),"isApplicationInstalled"in navigator&&"onloadcssdefined"in a&&a.onloadcssdefined(c)}
	</script>
	<script type="text/javascript">

		function jqueryDefer(method) {
			if (window.jQuery) {
				method();
			} else {
				setTimeout(function() {
					jqueryDefer(method)
				}, 50);
			}
		}

		function jqueryUiDefer(method) {
			if (window.jQuery && window.jQuery.ui) {
				method();
			} else {
				setTimeout(function() {
					jqueryUiDefer(method)
				}, 50);
			}
		}

		function loadScript(src, callback)
		{
			var s, r, t;
			r = false;
			s = document.createElement('script');
			s.type = 'text/javascript';
			s.src = src;
			s.onload = s.onreadystatechange = function() {
				if ( !r && (!this.readyState || this.readyState == 'complete') )
				{
					r = true;
					if (callback) {
						callback();
					}
				}
			};
			t = document.getElementsByTagName('script')[0];
			t.parentNode.insertBefore(s, t);
		}

		function loadCssAsync(src, callback) {
			var stylesheet = loadCSS( src );
			if (callback) {
				onloadCSS(stylesheet, callback);
			}
		}

		function loadNextScript(index, scriptsList, completeCallback) {
			if (index < scriptsList.length) {
				var script = scriptsList[index];
				if (script.type === 'script') {
					loadScript(script.src, function() {
						index++;
						loadNextScript(index, scriptsList, completeCallback);
					});
				} else if (script.type === 'css') {
					loadCssAsync(script.src, function() {
						index++;
						loadNextScript(index, scriptsList, completeCallback);
					});
				}
			} else if (completeCallback) {
				completeCallback();
			}
		}

		var initialScriptsList = [
			{src: '/js/jquery-2.2.0.min.js', type: 'script'},
			{src: '/css/jquery-ui.min.css', type: 'css'},
			{src: '/js/jquery-ui.min.js', type: 'script'},
			{src: '/js/script.js', type: 'script'},
			{src: '/css/sweetalert.css', type: 'css'},
			{src: '/js/sweetalert.min.js', type: 'script'}
		];

		loadNextScript(0, initialScriptsList);

	</script>
	<script type="text/javascript">
		function _gaLt(event) {
			/* If GA is blocked or not loaded, or not main|middle|touch click then don't track */
			if (!ga.hasOwnProperty("loaded") || ga.loaded != true || (event.which != 1 && event.which != 2)) {
				return;
			}
			var el = event.srcElement || event.target;

			while (el && (typeof el.tagName == 'undefined' || el.tagName.toLowerCase() != 'a' || !el.href)) {
				el = el.parentNode;
			}
			if (el && el.href) {
				var link = el.href;
				if ((link.indexOf(location.host) == -1 || link.indexOf('.' + location.host) > 0) && !link.match(/^javascript\:/i)) {
					var target = (el.target && !el.target.match(/^_(self|parent|top)$/i)) ? el.target : false;
					if (event.ctrlKey || event.shiftKey || event.metaKey || event.which == 2) {
						target = "_blank";
					}

					var hbrun = false; // tracker has not yet run
					var hitBack = function() {
						if (hbrun) return;
						hbrun = true;
						window.location.href = link;
					};

					if (target) {
						ga(
								"send", "event", "Outgoing Links", link,
								document.location.pathname + document.location.search
						);
					} else {
						event.preventDefault ? event.preventDefault() : event.returnValue = !1;
						ga(
								"send", "event", "Outgoing Links", link,
								document.location.pathname + document.location.search, {
									"hitCallback": hitBack
								}
						);

						setTimeout(hitBack, 1000);
					}
				}
			}
		}

		var _w = window;
		var _gaLtEvt = ("ontouchstart" in _w) ? "click" : "mousedown";
		_w.addEventListener ? _w.addEventListener("load", function() {document.body.addEventListener(_gaLtEvt, _gaLt, !1)}, !1)
				: _w.attachEvent && _w.attachEvent("onload", function() {document.body.attachEvent("on" + _gaLtEvt, _gaLt)});
	</script>
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
					(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
				m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-88383331-1', 'auto');
		ga('send', 'pageview');
	</script>
</head>
<body>
<div id="cellophane" onclick="tb.toggleMenu()"></div>
<header>
	<a href="/" class="logo"></a>
	<div id="githubButtonContainer">
		<iframe id="gh-btn-frame" src="https://ghbtns.com/github-btn.html?user=thingsboard&repo=thingsboard&type=star&count=true&size=large"
				frameborder="0"
				scrolling="0" width="130px" height="30px"></iframe>
	</div>
	<div class="nav-buttons" data-auto-burger="primary">
		<a href="/docs/" class="button" id="viewDocs" data-auto-burger-exclude>View Documentation</a>
		<a href="/iot-use-cases/" class="button" id="useCases" data-auto-burger-exclude>Use cases</a>
		<a href="/docs/getting-started-guides/helloworld/" class="button" id="gettingStarted" data-auto-burger-exclude>Getting started</a>
		<a target="_blank" href="https://demo.thingsboard.io/signup" class="button" id="liveDemo" data-auto-burger-exclude>Live demo</a>
		<button id="hamburger" onclick="tb.toggleMenu()" data-auto-burger-exclude><div></div></button>
	</div>

	<nav id="mainNav">
		<main id="headNav" data-auto-burger="primary">
			<div class="nav-box">
				<h3><a href="/docs/getting-started-guides/helloworld/">Get Started</a></h3>
			</div>
			<div class="nav-box">
				<h3><a href="/docs/">Documentation</a></h3>
			</div>
			<div class="nav-box">
				<h3><a href="/iot-use-cases/">Use cases</a></h3>
			</div>
			<div class="nav-box">
				<h3><a href="http://blog.thingsboard.io/">Blog</a></h3>
			</div>
			<div class="nav-box">
				<h3><a href="/docs/services/">Services</a></h3>
			</div>
			<div class="nav-box">
				<h3><a href="/docs/contact-us/">Contact us</a></h3>
			</div>
		</main>
		<main data-auto-burger="primary">
			<div class="center">
				<div class="social">
					<a href="https://twitter.com/thingsboard" class="twitter"><span>Twitter</span></a>
					<a href="https://github.com/thingsboard/thingsboard" class="github"><span>Github</span></a>
					<a href="https://gitter.im/thingsboard/chat" class="gitter"><span>Gitter</span></a>
					<a href="http://stackoverflow.com/questions/tagged/thingsboard" class="stack-overflow"><span>Stack Overflow</span></a>
					<a href="https://groups.google.com/forum/#!forum/thingsboard" class="mailing-list"><span>Mailing List</span></a>
					<a href="https://www.youtube.com/channel/UCDb9fsV-YR4JmnipAMGsVAQ" class="youtube"><span>YouTube Channel</span></a>
					<a href="https://www.facebook.com/thingsboard" class="facebook"><span>Facebook Page</span></a>
				</div>
			</div>
			<div class="clear" style="clear: both"></div>
		</main>
	</nav>
</header>


<!--  HERO  -->
<section id="hero" class="light-text">
  <h1>Thingsboard Documentation</h1>
  <h5>Documentation for using Thingsboard IoT Platform.</h5>
  <div id="vendorStrip" class="light-text">
    <div id="docsList">
        <ul>
          <li><a href="/docs/" class="YAH">DOCS HOME</a></li>
          <li><a href="/docs/api/" >API</a></li>
          <li><a href="/docs/iot-gateway/" >IOT GATEWAY</a></li>
          <li><a href="/docs/reference/" >REFERENCE</a></li>
          <li><a href="/docs/samples/" >SAMPLES</a></li>
          <li><a href="/iot-use-cases/" >USE CASES</a></li>
          <li><a href="/docs/iot-video-tutorials/" >VIDEO TUTORIALS</a></li>
          <li><a href="/docs/faq/" >FAQ</a></li>
          <li><a href="/docs/services/" >SERVICES</a></li>
          <li><a href="/docs/contact-us/" >CONTACT US</a></li>
        </ul>
    </div>
    <div id="searchBox">
      <input type="text" id="search" placeholder="Search" onkeydown="if (event.keyCode==13) window.location.replace('/docs/search/?q=' + this.value)">
    </div>
  </div>
</section>





<section id="encyclopedia">
  
  <div id="docsToc" >
        <div class="pi-accordion">
        
    <a class="item" data-title="Thingsboard Documentation" href="/docs/"></a>
    <a class="item" data-title="What is Thingsboard?" href="/docs/getting-started-guides/what-is-thingsboard/"></a>
    <a class="item" data-title="Getting Started" href="/docs/getting-started-guides/helloworld/"></a>
<div class="item" data-title="Installation">
  <div class="container">
    <a class="item" data-title="Installation options" href="/docs/user-guide/install/installation-options/"></a>
    <a class="item" data-title="Installing Thingsboard on Windows" href="/docs/user-guide/install/windows/"></a>
    <a class="item" data-title="Installing Thingsboard on Linux (Ubuntu & CentOS)" href="/docs/user-guide/install/linux/"></a>
    <a class="item" data-title="Installing Thingsboard on Raspberry Pi 3" href="/docs/user-guide/install/rpi/"></a>
    <a class="item" data-title="Installing Thingsboard using Docker (Linux or Mac OS)" href="/docs/user-guide/install/docker/"></a>
    <a class="item" data-title="Installing Thingsboard using Docker (Windows)" href="/docs/user-guide/install/docker-windows/"></a>
    <a class="item" data-title="Installing Thingsboard on AWS EC2" href="/docs/user-guide/install/aws/"></a>
    <a class="item" data-title="Building from sources" href="/docs/user-guide/install/building-from-source/"></a>
    <a class="item" data-title="Upgrade instructions" href="/docs/user-guide/install/upgrade-instructions/"></a>
    <a class="item" data-title="Configuration" href="/docs/user-guide/install/config/"></a>
    <a class="item" data-title="Cluster setup" href="/docs/user-guide/install/cluster-setup/"></a>
  </div>
</div>
<div class="item" data-title="Features">
  <div class="container">
    <a class="item" data-title="Working with device attributes" href="/docs/user-guide/attributes/"></a>
    <a class="item" data-title="Working with telemetry data" href="/docs/user-guide/telemetry/"></a>
    <a class="item" data-title="Using RPC capabilities" href="/docs/user-guide/rpc/"></a>
    <a class="item" data-title="Rule engine" href="/docs/user-guide/rule-engine/"></a>
    <a class="item" data-title="Data visualization" href="/docs/user-guide/visualization/"></a>
  </div>
</div>
<div class="item" data-title="Integrations Cookbook">
  <div class="container">
    <a class="item" data-title="Persist and visualize AWS IoT data" href="/docs/iot-gateway/integration-with-aws-iot/"></a>
    <a class="item" data-title="IoT data analytics using Apache Spark" href="/docs/samples/analytics/spark-integration-with-thingsboard/"></a>
    <a class="item" data-title="SigFox IoT data collection and visualization" href="/docs/iot-gateway/sigfox-iot-data-visualization/"></a>
    <a class="item" data-title="Persist and visualize IBM Watson IoT data" href="/docs/iot-gateway/integration-with-ibm-watson-iot/"></a>
  </div>
</div>
<div class="item" data-title="Security">
  <div class="container">
    <a class="item" data-title="MQTT over SSL" href="/docs/user-guide/mqtt-over-ssl/"></a>
    <a class="item" data-title="Device authentication options" href="/docs/user-guide/device-credentials/"></a>
    <a class="item" data-title="Access Token based authentication" href="/docs/user-guide/access-token/"></a>
    <a class="item" data-title="X.509 Certificate based authentication" href="/docs/user-guide/certificates/"></a>
  </div>
</div>
<div class="item" data-title="Administration UI">
  <div class="container">
    <a class="item" data-title="Tenants" href="/docs/user-guide/ui/tenants/"></a>
    <a class="item" data-title="Customers" href="/docs/user-guide/ui/customers/"></a>
    <a class="item" data-title="Users" href="/docs/user-guide/ui/users/"></a>
    <a class="item" data-title="Devices" href="/docs/user-guide/ui/devices/"></a>
    <a class="item" data-title="Rules" href="/docs/user-guide/ui/rules/"></a>
    <a class="item" data-title="Plugins" href="/docs/user-guide/ui/plugins/"></a>
    <a class="item" data-title="Widgets Library" href="/docs/user-guide/ui/widget-library/"></a>
    <a class="item" data-title="Dashboards" href="/docs/user-guide/ui/dashboards/"></a>
    <a class="item" data-title="Mail Settings" href="/docs/user-guide/ui/mail-settings/"></a>
  </div>
</div>
    <a class="item" data-title="Troubleshooting" href="/docs/user-guide/troubleshooting/"></a>
<div class="item" data-title="Contribution Guide">
  <div class="container">
    <a class="item" data-title="How to contribute" href="/docs/user-guide/contribution/how-to-contribute/"></a>
    <a class="item" data-title="Extensions (Plugins and Actions) development" href="/docs/user-guide/contribution/extensions-development/"></a>
  </div>
</div>
        </div> <!-- /pi-accordion -->
    <button class="push-menu-close-button" onclick="tb.toggleToc()"></button>
  </div> <!-- /docsToc -->
  
  <div id="docsContent" class="">
    <h1>Integration with IBM Watson IoT</h1>
    <ul id="markdown-toc">
  <li><a href="#overview" id="markdown-toc-overview">Overview</a></li>
  <li><a href="#prerequisites" id="markdown-toc-prerequisites">Prerequisites</a></li>
  <li><a href="#ibm-watson-iot-configuration-steps" id="markdown-toc-ibm-watson-iot-configuration-steps">IBM Watson IoT configuration steps</a>    <ul>
      <li><a href="#step-1-ibm-watson-iot-platform-device" id="markdown-toc-step-1-ibm-watson-iot-platform-device">Step 1. IBM Watson IoT platform device</a></li>
      <li><a href="#step-2-ibm-watson-iot-api-key-for-applications" id="markdown-toc-step-2-ibm-watson-iot-api-key-for-applications">Step 2. IBM Watson IoT API key for applications</a></li>
    </ul>
  </li>
  <li><a href="#thingsboard-iot-gateway-configuration-steps" id="markdown-toc-thingsboard-iot-gateway-configuration-steps">Thingsboard IoT Gateway configuration steps</a>    <ul>
      <li><a href="#step-3-enable-mqtt-extension" id="markdown-toc-step-3-enable-mqtt-extension">Step 3. Enable MQTT extension</a></li>
      <li><a href="#step-4-mqtt-extension-configuration" id="markdown-toc-step-4-mqtt-extension-configuration">Step 4. MQTT extension configuration</a></li>
    </ul>
  </li>
  <li><a href="#dry-run" id="markdown-toc-dry-run">Dry Run</a></li>
</ul>

<p>While some of the IBM Watson IoT and Thingsboard features overlap, you are able to integrate them and leverage best features from both.
For example, you can collect data using IBM Watson IoT and then push it to Thingsboard for storage and data visualization on customizable end-user dashboards.</p>

<p>To integrate IBM Watson IoT and Thingsboard the best option is to use Thingsboard <strong><a href="/docs/iot-gateway/what-is-iot-gateway/">IoT Gateway</a></strong>, which is an open-source solution that allows you to integrate devices connected to legacy and third-party systems with Thingsboard.
We will cover basic configuration steps below.</p>

<h3 id="overview">Overview</h3>

<p><img src="/images/gateway/ibm-watson/ibm-watson-iot-gateway-integration.svg" alt="image" /></p>

<p>Thingsboard IoT Gateway is a light-weight service that connects to both IBM Watson IoT MQTT broker and Thingsboard MQTT server and acts as aproxy or API bridge.
You are able to configure the Gateway to subscribe to certain IBM Watson IoT topics, convert incoming data to unified format and push it to Thingsboard.
This article provides basic configuration steps. You can refer to advanced configuration topic for <a href="/docs/iot-gateway/mqtt/">more details</a>.</p>

<h3 id="prerequisites">Prerequisites</h3>

<p>We assume you have already <a href="/docs/iot-gateway/installation/"><strong>installed</strong></a> Thingsboard IoT Gateway and <a href="/docs/iot-gateway/getting-started/#step-3-gateway-provisioning"><strong>provisioned</strong></a> it within your local or demo Thingsboard instance.</p>

<p>As well we assume that you have <strong>IBM Account</strong> already and have access to <strong>IBM Watson IoT Platform</strong>.</p>

<p>Additionally service <strong>Internet of Things Platform</strong> must be created inside your IBM account. You can check it by this <a href="https://console.ng.bluemix.net/dashboard/services">link</a> or by navigation <strong>Menu -&gt; Services -&gt; Dashboard</strong>:</p>

<p><img src="/images/gateway/ibm-watson/ibm-watson-services.png" alt="image" /></p>

<p>If service is not created please click <strong>Create Service</strong> button and in the Catalog filter <em>Internet of Things Platform</em>:</p>

<p><img src="/images/gateway/ibm-watson/create-iot-service.png" alt="image" /></p>

<p>Select <strong>Internet of Things Platform</strong> and following instructions to create this service.</p>

<h3 id="ibm-watson-iot-configuration-steps">IBM Watson IoT configuration steps</h3>

<p>Before configuration of the Thingsboard <strong>IoT Gateway</strong> we must configure <strong>IBM Watson</strong> IoT Platform service and generate access tokens.</p>

<h4 id="step-1-ibm-watson-iot-platform-device">Step 1. IBM Watson IoT platform device</h4>

<p>We must have some <strong>IBM Watson IoT device</strong> registered in the platform.
Let’s launch IoT Platform service:</p>

<p><img src="/images/gateway/ibm-watson/launch-iot-platform.png" alt="image" /></p>

<p>Go to the <strong>Device</strong> menu and verify list of devices that already exists:</p>

<p><img src="/images/gateway/ibm-watson/ibm-devices.png" alt="image" /></p>

<p>If you don’t have device created, please click <strong>Add Device</strong> and create it following the instructions.
In other case click on particular device and get device credentials:</p>

<p><img src="/images/gateway/ibm-watson/device-credentials.png" alt="image" /></p>

<p>In this window you’ll need <em>Organization ID</em> that we later refer as <strong>$IBM_WATSON_ORGANIZATION_ID</strong>, <em>Device Type</em> as <strong>$IBM_WATSON_DEVICE_TYPE</strong>, <em>Device ID</em> as <strong>$IBM_WATSON_DEVICE_ID</strong> and <em>Authentication Token</em> as <strong>$IBM_WATSON_DEVICE_TOKEN</strong>.</p>

<p>Please write them down somewhere because later we’ll use them.</p>

<h4 id="step-2-ibm-watson-iot-api-key-for-applications">Step 2. IBM Watson IoT API key for applications</h4>

<p>Now we need to generate <strong>API key</strong> for the <strong>IBM Watson</strong> <em>application</em>. In our case <strong>Thingsboard Gateway</strong> is going to be application that will be subscribed to <strong>IBM Watson</strong> <em>MQTT</em> topics.</p>

<p>Go to <strong>Apps</strong> menu:</p>

<p><img src="/images/gateway/ibm-watson/generate-ip-key-1.png" alt="image" /></p>

<p>If you have key already created you can use it, in other case click <strong>Generate API Key</strong> button:</p>

<p><img src="/images/gateway/ibm-watson/generate-ip-key-2.png" alt="image" /></p>

<p>Please write down from this screen <em>API Key</em> that we’ll later refer to as <strong>$IBM_WATSON_APP_NAME</strong> and <em>Authentication Token</em> as <strong>$IBM_WATSON_APP_TOKEN</strong>.</p>

<h3 id="thingsboard-iot-gateway-configuration-steps">Thingsboard IoT Gateway configuration steps</h3>

<h4 id="step-3-enable-mqtt-extension">Step 3. Enable MQTT extension</h4>

<p>Navigate to the gateway configuration folder and edit <strong>tb-gateway.yml</strong> file. Please change <strong>mqtt.enabled</strong> property value to <strong>true</strong> to enable Gateway MQTT extension.</p>

<h4 id="step-4-mqtt-extension-configuration">Step 4. MQTT extension configuration</h4>

<p>Now it’s time to configure Thingsboard <strong>IoT Gateway</strong> to connect to your <strong>IBM Watson IoT</strong> broker.</p>

<p><strong>NOTE</strong> If you at this point don’t know how devices and applications are connecting to MQTT topics in <strong>IBM Watson</strong> platform please visit these links <a href="https://console.ng.bluemix.net/docs/services/IoT/reference/security/connect_devices_apps_gw.html">Connecting applications, devices, and gateways to Watson IoT Platform</a> and <a href="https://console.ng.bluemix.net/docs/services/IoT/applications/mqtt.html">MQTT connectivity for applications</a> before continue.</p>

<p>We need to compose <strong>host</strong> and <strong>clientId</strong> properties to be able to connect <strong>Thingsboard Gateway</strong> to <strong>IBM Watson</strong> <em>MQTT</em> topics.</p>

<p>According to <strong>IBM Watson</strong> <a href="https://console.ng.bluemix.net/docs/services/IoT/applications/mqtt.html">documentation</a> <strong>host</strong> should be create as <strong>$IBM_WATSON_ORGANIZATION_ID</strong>.<em>messaging.internetofthings.ibmcloud.com</em>. We’ll later refer to this as <strong>$IBM_WATSON_MQTT_ENDPOINT</strong>.</p>

<p>As well for identification we’ll need correctly compose <strong>clientId</strong> property as <em>a</em>:<strong>$IBM_WATSON_ORGANIZATION_ID</strong>.<strong>$IBM_WATSON_APP_NAME</strong>. We’ll later refer to this as  <strong>$IBM_WATSON_CLIENT_ID</strong>.</p>

<p>Configuration of the brokers is located in <strong>mqtt-config.json</strong> file.</p>

<p>You should update it using next values:</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
</span><span class="nt">"host"</span><span class="p">:</span><span class="w"> </span><span class="s2">"$IBM_WATSON_MQTT_ENDPOINT"</span><span class="p">,</span><span class="w">
</span><span class="nt">"port"</span><span class="p">:</span><span class="w"> </span><span class="mi">1883</span><span class="p">,</span><span class="w">
</span><span class="nt">"ssl"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
</span><span class="nt">"retryInterval"</span><span class="p">:</span><span class="w"> </span><span class="mi">3000</span><span class="p">,</span><span class="w">
</span><span class="nt">"clientId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"$IBM_WATSON_CLIENT_ID"</span><span class="p">,</span><span class="w">
</span><span class="nt">"credentials"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"basic"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"$IBM_WATSON_APP_NAME"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"password"</span><span class="p">:</span><span class="w"> </span><span class="s2">"$IBM_WATSON_APP_TOKEN"</span><span class="w">
</span><span class="p">}</span><span class="w">
 </span><span class="err">...</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>here is sample with real values:</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nt">"host"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4p62co.messaging.internetofthings.ibmcloud.com"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"port"</span><span class="p">:</span><span class="w"> </span><span class="mi">1883</span><span class="p">,</span><span class="w">
    </span><span class="nt">"ssl"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nt">"retryInterval"</span><span class="p">:</span><span class="w"> </span><span class="mi">3000</span><span class="p">,</span><span class="w">
    </span><span class="nt">"clientId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"a:4p62co:a-4p62co-vuflwimden"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"credentials"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"basic"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"a-4p62co-vuflwimden"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"password"</span><span class="p">:</span><span class="w"> </span><span class="s2">"l5xa*A9X9)PrDi5Jvg"</span><span class="w">
    </span><span class="p">}</span><span class="w">
    </span><span class="err">...</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>Configuration of the broker is done. Now you are ready to start Thingsboard <strong>IoT Gateway</strong> and publish messages to <strong>IBM Watson IoT</strong> topics that will be consumed by Thingsboard <strong>IoT Gateway</strong> and republished to <strong>Thingsboard</strong> instance.</p>

<h3 id="dry-run">Dry Run</h3>

<p>It’s time to configure mapping of the <strong>Thingsboard Gateway</strong> to be able to subscribe to <strong>IBM Watson</strong> device topics.</p>

<p><strong>NOTE</strong> If you at this point don’t know how subscribe to <strong>IBM Watson</strong> <em>MQTT</em> topics please visit this <a href="https://console.ng.bluemix.net/docs/services/IoT/applications/mqtt.html#subscribe_device_events">link</a></p>

<p>In general <em>topic</em> that we can use to subscribe to device events has next definition:</p>

<p><em>iot-2/type</em>/<strong>$IBM_WATSON_DEVICE_TYPE</strong>/<em>id</em>/<strong>$IBM_WATSON_DEVICE_ID</strong>/<em>evt</em>/<strong>event_id</strong>/<em>fmt</em>/<strong>format_string</strong></p>

<p>Here is the detail description of <em>event_id</em> and <em>format_string</em> properties:</p>

<ul>
  <li><strong>event_id</strong> is the ID of the event, for example “status”. The event ID can be any string permitted by MQTT. Subscriber applications must use this string in their subscription topic to receive the events published on this topic if wildcards are not used.</li>
  <li><strong>format_string</strong> is the format of the event payload, for example “json”. The format can be any string permitted by MQTT. Subscriber applications must use this string in their subscription topic to receive events published on this topic if wildcards are not used. If the format is not “json”, then messages will not be stored in the Historian.</li>
</ul>

<p>Consider that we have next configuration of the mapping for <strong>my-device-type</strong> <em>Device Type</em> and would like to get all <strong>temp</strong> events for all the <em>Device Ids</em>. <em>Device Id</em> is going to be used as <em>Device Name</em> in <strong>Thingsboard</strong>:</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="err">...</span><span class="w">
    </span><span class="nt">"topicFilter"</span><span class="p">:</span><span class="w"> </span><span class="s2">"iot-2/type/my-device-type/id/+/evt/temp/fmt/json"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"converter"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"json"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"filterExpression"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
        </span><span class="nt">"deviceNameTopicExpression"</span><span class="p">:</span><span class="w"> </span><span class="s2">"(?&lt;=iot-2/type/my-device-type/id\/)(.*?)(?=\/evt/temp/fmt/json)"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"timeseries"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="p">{</span><span class="w">
            </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"double"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"temperature"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"${$.value}"</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
    </span><span class="err">...</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>To check that everything is configured correctly you are able to use <strong>mosquitto_pub</strong> tool that is able to publish messages to <strong>IBM Watson IoT</strong>.
The list of options that we are going to use in <strong>mosquitto_pub</strong>:</p>

<ul>
  <li><strong>‘-h’</strong> Specify the host to connect to.</li>
  <li><strong>‘-u’</strong> Provide a username to be used for authenticating with the broker.</li>
  <li><strong>‘-P’</strong> Provide a password to be used for authenticating with the broker.</li>
  <li><strong>‘-i’</strong> The id to use for this client.</li>
  <li><strong>‘-t’</strong> The MQTT topic on which to publish the message.</li>
</ul>

<p>Here is the general command that could be used to publish message of particular device to <strong>IBM Watson</strong> <em>MQTT</em> topic:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>mosquitto_pub -h <span class="nv">$IBM_WATSON_ORGANIZATION_ID</span>.messaging.internetofthings.ibmcloud.com -p 1883 -u <span class="s1">'use-token-auth'</span> -P <span class="s1">'$IBM_WATSON_DEVICE_TOKEN'</span> -i <span class="s2">"d:</span><span class="nv">$IBM_WATSON_ORGANIZATION_ID</span><span class="s2">:</span><span class="nv">$IBM_WATSON_DEVICE_TYPE</span><span class="s2">:</span><span class="nv">$IBM_WATSON_DEVICE_ID</span><span class="s2">"</span> -t iot-2/evt/<span class="nv">$event_id</span>/fmt/<span class="nv">$format_string</span> -m <span class="s1">'{"value":64}'</span>
</code></pre>
</div>

<p><strong>NOTE</strong> For the details how to connect to <strong>IBM Watson</strong> <em>MQTT</em> topics please visit this <a href="https://console.ng.bluemix.net/docs/services/IoT/applications/mqtt.html">link</a></p>

<p>And this is a sample of the command that will publish temperature readings to IBM Watson IoT topic <strong>iot-2/evt/temp/fmt/json</strong>. 
Thingsboard <strong>IoT Gateway</strong> will receive these values, create or update device <strong>MY-DEVICE-ID</strong> inside <strong>Thingsboard</strong>, and publish telemetry <em>‘temperature’</em> using value <strong>64</strong></p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>mosquitto_pub -h 4p62co.messaging.internetofthings.ibmcloud.com -p 1883 -u <span class="s1">'use-token-auth'</span> -P <span class="s1">'Lw&amp;FJ3F29Rs&amp;xNeuJt'</span> -i <span class="s2">"d:4p62co:my-device-type:my-device-id"</span> -t iot-2/evt/temp/fmt/json -m <span class="s1">'{"value":64}'</span>
</code></pre>
</div>

<p>To validate that data arrived to Thingsboard, please open the administration UI and navigate to <strong>Devices -&gt; MY-DEVICE-ID -&gt; Latest Telemetry</strong>. See screen-shoot attached.</p>

<p><img src="/images/gateway/ibm-watson/dry-run.png" alt="image" /></p>

  </div>
</section>

<footer>
	<main class="light-text">
		<nav>
			<a href="/docs/getting-started-guides/helloworld/">Get Started</a>
			<a href="/docs/">Documentation</a>
			<a href="/iot-use-cases/">Use cases</a>
			<a href="https://blog.thingsboard.io/">Blog</a>
			<a href="/docs/services/">Services</a>
			<a href="/docs/contact-us/">Contact us</a>
		</nav>
		<div class="newsletterSubsContainer">
			<form id="newsletter-form" method="post" onsubmit="return validateNewsletterForm(this)">
				<fieldset>
					<div class="newsletterInputs">
						<p class="subsTitle">Sign up for Thingsboard IoT newsletter</p>
						<input id="subsEmail" placeholder="Email" class="text-input" name="email" type="text" size="20" maxlength="80">
						<input type="hidden" name="_next" value="/docs/newsletter-thanks/" />
						<input type="text" name="_gotcha" style="display:none" />
						<input class="button" value="Submit" type="submit">
					</div>
				</fieldset>
			</form>
		</div>
		<div class="center">
			<div class="social">
				<div>
					<a href="https://twitter.com/thingsboard" class="twitter"><span>twitter</span></a>
					<a href="https://github.com/thingsboard/thingsboard" class="github"><span>Github</span></a>
					<a href="https://gitter.im/thingsboard/chat" class="gitter"><span>Gitter</span></a>
					<a href="http://stackoverflow.com/questions/tagged/thingsboard" class="stack-overflow"><span>Stack Overflow</span></a>
				</div>
				<div>
					<a href="https://groups.google.com/forum/#!forum/thingsboard" class="mailing-list"><span>Mailing List</span></a>
					<a href="https://www.youtube.com/channel/UCDb9fsV-YR4JmnipAMGsVAQ" class="youtube"><span>YouTube Channel</span></a>
					<a href="https://www.facebook.com/thingsboard" class="facebook"><span>Facebook Page</span></a>
				</div>
			</div>
		</div>
		<div id="miceType" class="center">&copy; 2017 The Thingsboard Authors</div>
	</main>

	<script type="text/javascript">

		function validateNewsletterForm(form) {
			var email = $('input[name=email]', form).val();

			if (!validateValue('Email Address', email)) {
				return false;
			}

			var emailExp = /^[a-zA-Z0-9._%-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;
			if(email.match(emailExp)==null) {
				window.alert("Entered Email Address is not valid.");
				return false;
			}
			return true;
		}

		function validateValue(name, val) {
			if (isEmpty(val)) {
				window.alert("Please fill '" + name + "' field.");
				return false;
			}
			return true;
		}

		function isEmpty(val) {
			return val === undefined || val.trim().length == 0;
		}

	</script>

	<script type="text/javascript">

		var newsletterform =  document.getElementById('newsletter-form');
		newsletterform.setAttribute('action', 'https://formspree.io/' + 'newsletter' + '@' + 'thingsboard' + '.' + 'io');

	</script>

</footer>



<button class="flyout-button" onclick="tb.toggleToc()"></button>


<style>
  .cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
  }
  .gsc-control-cse table, .gsc-control-cse-en table {
    margin:0px !important;
  }
  .gsc-above-wrapper-area {
    border-bottom: 0;
  }
</style>
</body>
</html>
