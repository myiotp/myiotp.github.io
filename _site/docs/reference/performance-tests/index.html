

<!Doctype html>
<html id="docs" class="Reference Documentation">



<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	
	<!-- Begin Jekyll SEO tag v2.0.0 -->
<title>How to repeat the tests - Thingsboard</title>
<meta property="og:title" content="How to repeat the tests" />
<meta name="description" content="Thingsboard IoT Platform performance tests" />
<meta property="og:description" content="Thingsboard IoT Platform performance tests" />
<link rel="canonical" href="http://localhost:4000/docs/reference/performance-tests/" />
<meta property="og:url" content="http://localhost:4000/docs/reference/performance-tests/" />
<meta property="og:site_name" content="Thingsboard" />
<meta property="og:image" content="http://localhost:4000/images/thingsboard_logo.png" />
<meta name="twitter:image" content="http://localhost:4000/images/thingsboard_logo.png" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="@thingsboard" />
<meta name="twitter:creator" content="@thingsboard" />
<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "WebPage",
    "headline": "How to repeat the tests",
    "image": "http://localhost:4000/images/thingsboard_logo.png",
    "description": "Thingsboard IoT Platform performance tests",
    "logo": "http://localhost:4000/images/thingsboard_logo.png",
    "url": "http://localhost:4000/docs/reference/performance-tests/"
  }
</script>
<!-- End Jekyll SEO tag -->
	
	
	<link rel="shortcut icon" type="image/png" href="/images/favicon.png">

	<link rel="stylesheet" href="/css/styles.css">
	<script type="text/javascript">
		/*! loadCSS. [c]2017 Filament Group, Inc. MIT License */
		!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);
		/*! onloadCSS. (onload callback for loadCSS) [c]2017 Filament Group, Inc. MIT License */
		function onloadCSS(a,b){function c(){!d&&b&&(d=!0,b.call(a))}var d;a.addEventListener&&a.addEventListener("load",c),a.attachEvent&&a.attachEvent("onload",c),"isApplicationInstalled"in navigator&&"onloadcssdefined"in a&&a.onloadcssdefined(c)}
	</script>
	<script type="text/javascript">

		function jqueryDefer(method) {
			if (window.jQuery) {
				method();
			} else {
				setTimeout(function() {
					jqueryDefer(method)
				}, 50);
			}
		}

		function jqueryUiDefer(method) {
			if (window.jQuery && window.jQuery.ui) {
				method();
			} else {
				setTimeout(function() {
					jqueryUiDefer(method)
				}, 50);
			}
		}

		function loadScript(src, callback)
		{
			var s, r, t;
			r = false;
			s = document.createElement('script');
			s.type = 'text/javascript';
			s.src = src;
			s.onload = s.onreadystatechange = function() {
				if ( !r && (!this.readyState || this.readyState == 'complete') )
				{
					r = true;
					if (callback) {
						callback();
					}
				}
			};
			t = document.getElementsByTagName('script')[0];
			t.parentNode.insertBefore(s, t);
		}

		function loadCssAsync(src, callback) {
			var stylesheet = loadCSS( src );
			if (callback) {
				onloadCSS(stylesheet, callback);
			}
		}

		function loadNextScript(index, scriptsList, completeCallback) {
			if (index < scriptsList.length) {
				var script = scriptsList[index];
				if (script.type === 'script') {
					loadScript(script.src, function() {
						index++;
						loadNextScript(index, scriptsList, completeCallback);
					});
				} else if (script.type === 'css') {
					loadCssAsync(script.src, function() {
						index++;
						loadNextScript(index, scriptsList, completeCallback);
					});
				}
			} else if (completeCallback) {
				completeCallback();
			}
		}

		var initialScriptsList = [
			{src: '/js/jquery-2.2.0.min.js', type: 'script'},
			{src: '/css/jquery-ui.min.css', type: 'css'},
			{src: '/js/jquery-ui.min.js', type: 'script'},
			{src: '/js/script.js', type: 'script'},
			{src: '/css/sweetalert.css', type: 'css'},
			{src: '/js/sweetalert.min.js', type: 'script'}
		];

		loadNextScript(0, initialScriptsList);

	</script>
	<script type="text/javascript">
		function _gaLt(event) {
			/* If GA is blocked or not loaded, or not main|middle|touch click then don't track */
			if (!ga.hasOwnProperty("loaded") || ga.loaded != true || (event.which != 1 && event.which != 2)) {
				return;
			}
			var el = event.srcElement || event.target;

			while (el && (typeof el.tagName == 'undefined' || el.tagName.toLowerCase() != 'a' || !el.href)) {
				el = el.parentNode;
			}
			if (el && el.href) {
				var link = el.href;
				if ((link.indexOf(location.host) == -1 || link.indexOf('.' + location.host) > 0) && !link.match(/^javascript\:/i)) {
					var target = (el.target && !el.target.match(/^_(self|parent|top)$/i)) ? el.target : false;
					if (event.ctrlKey || event.shiftKey || event.metaKey || event.which == 2) {
						target = "_blank";
					}

					var hbrun = false; // tracker has not yet run
					var hitBack = function() {
						if (hbrun) return;
						hbrun = true;
						window.location.href = link;
					};

					if (target) {
						ga(
								"send", "event", "Outgoing Links", link,
								document.location.pathname + document.location.search
						);
					} else {
						event.preventDefault ? event.preventDefault() : event.returnValue = !1;
						ga(
								"send", "event", "Outgoing Links", link,
								document.location.pathname + document.location.search, {
									"hitCallback": hitBack
								}
						);

						setTimeout(hitBack, 1000);
					}
				}
			}
		}

		var _w = window;
		var _gaLtEvt = ("ontouchstart" in _w) ? "click" : "mousedown";
		_w.addEventListener ? _w.addEventListener("load", function() {document.body.addEventListener(_gaLtEvt, _gaLt, !1)}, !1)
				: _w.attachEvent && _w.attachEvent("onload", function() {document.body.attachEvent("on" + _gaLtEvt, _gaLt)});
	</script>
</head>
<body>
<div id="cellophane" onclick="tb.toggleMenu()"></div>
<header>
	<a href="#" class="logo"></a>
	<div class="nav-buttons" data-auto-burger="primary">
		<a href="#" class="button" id="viewDocs" data-auto-burger-exclude>&nbsp;&nbsp;主要功能&nbsp;&nbsp;</a>
		<a href="#" class="button" id="useCases" data-auto-burger-exclude>&nbsp;&nbsp;查看文档&nbsp;&nbsp;</a>
		<a href="#" class="button" id="useCases" data-auto-burger-exclude>&nbsp;&nbsp;案例分析&nbsp;&nbsp;</a>
		<a href="#" class="button" id="gettingStarted" data-auto-burger-exclude>&nbsp;&nbsp;开始使用&nbsp;&nbsp;</a>
		<button id="hamburger" onclick="tb.toggleMenu()" data-auto-burger-exclude><div></div></button>
	</div>

	<nav id="mainNav">
		<main id="headNav" data-auto-burger="primary">
			<div class="nav-box">
				<h3><a href="#">开始使用<a></h3>
			</div>
			<div class="nav-box">
				<h3><a href="#">查看文档</a></h3>
			</div>
			<div class="nav-box">
				<h3><a href="#">案例分析</a></h3>
			</div>
			<div class="nav-box">
				<h3><a href="http://osswangxining.github.io/">Blog</a></h3>
			</div>
			<div class="nav-box">
				<h3><a href="#">服务支持</a></h3>
			</div>
			<div class="nav-box">
				<h3><a href="#">联系我们</a></h3>
			</div>
		</main>

	</nav>
</header>


<!--  HERO  -->
<section id="hero" class="light-text">
  <h1>Reference Documentation</h1>
  <h5>Design docs, concept definitions, and references for APIs and CLIs.</h5>
  <div id="vendorStrip" class="light-text">
    <div id="docsList">
        <ul>
          <li><a href="/docs/" >DOCS HOME</a></li>
          <li><a href="/docs/api/" >API</a></li>
          <li><a href="/docs/iot-gateway/" >IOT GATEWAY</a></li>
          <li><a href="/docs/reference/" class="YAH">REFERENCE</a></li>
          <li><a href="/docs/samples/" >SAMPLES</a></li>
          <li><a href="/iot-use-cases/" >USE CASES</a></li>
          <li><a href="/docs/iot-video-tutorials/" >VIDEO TUTORIALS</a></li>
          <li><a href="/docs/faq/" >FAQ</a></li>
          <li><a href="/docs/services/" >SERVICES</a></li>
          <li><a href="/docs/contact-us/" >CONTACT US</a></li>
        </ul>
    </div>
    <div id="searchBox">
      <input type="text" id="search" placeholder="Search" onkeydown="if (event.keyCode==13) window.location.replace('/docs/search/?q=' + this.value)">
    </div>
  </div>
</section>





<section id="encyclopedia">
  
  <div id="docsToc" >
        <div class="pi-accordion">
        
    <a class="item" data-title="Reference Documentation" href="/docs/reference/"></a>
    <a class="item" data-title="Thingsboard Architecture" href="/docs/reference/architecture/"></a>
<div class="item" data-title="Thingsboard Performance">
  <div class="container">
    <a class="item" data-title="Data Collection Performance" href="/docs/reference/performance/"></a>
    <a class="item" data-title="Performance Test Tools" href="/docs/reference/performance-tools/"></a>
    <a class="item" data-title="How to repeate the tests" href="/docs/reference/performance-tests/"></a>
  </div>
</div>
<div class="item" data-title="Rule Engine components">
  <div class="container">
<div class="item" data-title="Filters">
  <div class="container">
    <a class="item" data-title="Message Type Filter" href="/docs/reference/filters/message-type-filter/"></a>
    <a class="item" data-title="Device Attributes Filter" href="/docs/reference/filters/device-attributes-filter/"></a>
    <a class="item" data-title="Device Telemetry Filter" href="/docs/reference/filters/device-telemetry-filter/"></a>
    <a class="item" data-title="Method Name Filter" href="/docs/reference/filters/method-name-filter/"></a>
  </div>
</div>
<div class="item" data-title="Processors">
  <div class="container">
    <a class="item" data-title="Alarm Deduplication Processor" href="/docs/reference/processors/alarm-deduplication-processor/"></a>
  </div>
</div>
<div class="item" data-title="Actions">
  <div class="container">
    <a class="item" data-title="Telemetry Plugin Action" href="/docs/reference/actions/telemetry-plugin-action/"></a>
    <a class="item" data-title="Send Mail Action" href="/docs/reference/actions/send-mail-action/"></a>
    <a class="item" data-title="Kafka Plugin Action" href="/docs/reference/actions/kafka-plugin-action/"></a>
    <a class="item" data-title="RabbitMQ Plugin Action" href="/docs/reference/actions/rabbitmq-plugin-action/"></a>
    <a class="item" data-title="REST API Call Plugin Action" href="/docs/reference/actions/rest-api-call-plugin-action/"></a>
    <a class="item" data-title="RPC Plugin Action" href="/docs/reference/actions/rpc-plugin-action/"></a>
  </div>
</div>
<div class="item" data-title="Plugins">
  <div class="container">
    <a class="item" data-title="Telemetry Plugin" href="/docs/reference/plugins/telemetry/"></a>
    <a class="item" data-title="RPC Plugin" href="/docs/reference/plugins/rpc/"></a>
    <a class="item" data-title="Device Messaging Plugin" href="/docs/reference/plugins/messaging/"></a>
    <a class="item" data-title="Mail Plugin" href="/docs/reference/plugins/mail/"></a>
    <a class="item" data-title="Kafka Plugin" href="/docs/reference/plugins/kafka/"></a>
    <a class="item" data-title="RabbitMQ Plugin" href="/docs/reference/plugins/rabbitmq/"></a>
    <a class="item" data-title="REST API Call Plugin" href="/docs/reference/plugins/rest/"></a>
    <a class="item" data-title="Time RPC Plugin" href="/docs/reference/plugins/time/"></a>
  </div>
</div>
  </div>
</div>
    <a class="item" data-title="Release Notes" href="https://github.com/thingsboard/thingsboard/releases/" target='_blank'></a>
        </div> <!-- /pi-accordion -->
    <button class="push-menu-close-button" onclick="tb.toggleToc()"></button>
  </div> <!-- /docsToc -->
  
  <div id="docsContent" class="">
    <h1>How to repeat the tests</h1>
    <p>We have prepared several AWS AMIs for anyone who is interested in replication of these tests.
These AMIs contain some tuned OS parameters, for example maximum amount of threads per process and open file descriptors:</p>

<ul>
  <li>
    <p><a href="https://console.aws.amazon.com/ec2/v2/home?region=us-west-1#LaunchInstanceWizard:ami=ami-09b1ed69">Thingsboard AMI</a> (username <strong>ubuntu</strong>)</p>

    <p><strong>Following ports must be accessible for the cluster nodes: 8080, 1883</strong></p>
  </li>
  <li>
    <p><a href="https://console.aws.amazon.com/ec2/v2/home?region=us-west-1#LaunchInstanceWizard:ami=ami-4db2ee2d">Cassandra AMI</a> (username <strong>ubuntu</strong>)</p>

    <p><strong>Following ports must be accessible for the cluster nodes: 7000 - 7001, 9160, 9042</strong></p>
  </li>
  <li>
    <p><a href="https://console.aws.amazon.com/ec2/v2/home?region=us-west-1#LaunchInstanceWizard:ami=ami-30b0ec50">Test Client AMI</a> (username <strong>ubuntu</strong>)</p>
  </li>
</ul>

<p>If you would like to verify performance for all components hosted on a single server instance, simply run Thingsboard AMI instance. 
By default this instance will be using Cassandra that runs locally.</p>

<p>If you would like to verify performance for standalone Thingsboard server that uses external Cassandra Cluster, please init Cassandra cluster using provided Cassandra AMI first.
For example let’s do the configuration for three Cassandra instances.
Once you have launched 3 AWS instances using Cassandra AMI please update <strong>cassandra.yml</strong> file to make them run in a cluster.
In our case we have 3 instances with the following IP addresses:</p>

<ul>
  <li>172.21.12.100, <em>instance A</em></li>
  <li>172.21.12.101, <em>instance B</em></li>
  <li>172.21.12.102, <em>instance C</em></li>
</ul>

<p>Login into every cluster instance, clean up cassandra data directories and modify cassandra configuration:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>sudo rm -rf /var/lib/cassandra/saved_caches/<span class="k">*</span>
sudo rm -rf /var/lib/cassandra/commitlog/<span class="k">*</span>
sudo rm -rf /var/lib/cassandra/data/<span class="k">*</span>
sudo nano /etc/cassandra/cassandra.yaml
</code></pre>
</div>

<p>Find in the file next lines and update them accordingly.</p>

<p>For instance A:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>seeds: <span class="s2">"172.21.12.100,172.21.12.101,172.21.12.102"</span>

listen_address: <span class="s2">"172.21.12.100"</span>

rpc_address: <span class="s2">"172.21.12.100"</span>
</code></pre>
</div>

<p>For instance B:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>seeds: <span class="s2">"172.21.12.100,172.21.12.101,172.21.12.102"</span>

listen_address: <span class="s2">"172.21.12.101"</span>

rpc_address: <span class="s2">"172.21.12.101"</span>
</code></pre>
</div>

<p>For instance C:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>seeds: <span class="s2">"172.21.12.100,172.21.12.101,172.21.12.102"</span>

listen_address: <span class="s2">"172.21.12.102"</span>

rpc_address: <span class="s2">"172.21.12.102"</span>

</code></pre>
</div>

<p>On every instance restart cassandra:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>sudo service cassandra stop
sudo service cassandra start
</code></pre>
</div>

<p>And verify that Cassandra cluster setup was successful:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>nodetool status
</code></pre>
</div>

<p>In the output should be something similar:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>Datacenter: datacenter1
<span class="o">=======================</span>
<span class="nv">Status</span><span class="o">=</span>Up/Down
|/ <span class="nv">State</span><span class="o">=</span>Normal/Leaving/Joining/Moving
--  Address        Load       Tokens       Owns <span class="o">(</span>effective<span class="o">)</span>  Host ID                               Rack
UN  172.31.28.47   192.99 KiB  256          30.9%             a323e6fb-2e8c-4bb4-82d0-4e621cb7cba8  rack1
UN  172.31.19.231  132.23 KiB  256          33.9%             6da17a19-2a4b-4f99-9ac7-e38f05ebf7a9  rack1
UN  172.31.25.178  289.4 KiB  256          35.2%             87f1ab4d-16d4-4969-aea8-b858e62d1d73  rack1
</code></pre>
</div>

<p>Once the cluster is ready we need to create schema, system and demo data. At any of the Cassandra cluster node (here we use instance A) execute following commands:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>cqlsh 172.21.12.100 -f /usr/share/thingsboard/data/schema.cql 
cqlsh 172.21.12.100 -f /usr/share/thingsboard/data/system-data.cql 
cqlsh 172.21.12.100 -f /usr/share/thingsboard/data/demo-data.cql 
</code></pre>
</div>

<p>Once Cassandra cluster setup is done please run Thingsboard AMI instance. You need to update <strong>thingsbaord.yml</strong> config to use Cassandra cluster instead of local instance:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>sudo nano /etc/thingsboard/conf/thingsboard.yml
</code></pre>
</div>

<p>And update cassandra url from localhost to IPs of cassandra ring:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>url: <span class="s2">"</span><span class="k">${</span><span class="nv">CASSANDRA_URL</span>:172.21.12.100:9042,172.21.12.101:9042,172.21.12.102:9042<span class="k">}</span><span class="s2">"</span>
</code></pre>
</div>

<p>After configuration update restart Thingsboard service:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>sudo service thingsboard stop
sudo service thingsboard start
</code></pre>
</div>

<p>Once you will setup your cluster configuration using Thingsboard and Cassandra AMIs you can execute tests from “client” machines (Thingsboard Performance Test AMIs) using following commands:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="nb">cd </span>projects/performance-tests
</code></pre>
</div>

<p>Update <strong>mqttUrls</strong> and <strong>restUrl</strong> and set private IPs of AWS instance where Thingsboard service is deployed in <strong>test.properties</strong> file:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>nano src/main/resources/test.properties
</code></pre>
</div>

<p>Re-install project so Gatling can pick up latest config files and start test:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>mvn clean install gatling:execute
</code></pre>
</div>

  </div>
</section>

<footer>
	<main class="light-text">
		
		<div id="miceType" class="center">&copy; 2016 - 2017 IoT套件</div>
	</main>

</footer>



<button class="flyout-button" onclick="tb.toggleToc()"></button>


<style>
  .cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
  }
  .gsc-control-cse table, .gsc-control-cse-en table {
    margin:0px !important;
  }
  .gsc-above-wrapper-area {
    border-bottom: 0;
  }
</style>
</body>
</html>
