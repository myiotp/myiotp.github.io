

<!Doctype html>
<html id="docs" class="Thingsboard Documentation">



<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	
	<!-- Begin Jekyll SEO tag v2.0.0 -->
<title>Working with telemetry data - Thingsboard</title>
<meta property="og:title" content="Working with telemetry data" />
<meta name="description" content="IoT device time-series data collection using various IoT protocols and Thingsboard telemetry feature" />
<meta property="og:description" content="IoT device time-series data collection using various IoT protocols and Thingsboard telemetry feature" />
<link rel="canonical" href="http://localhost:4000/docs/user-guide/telemetry/" />
<meta property="og:url" content="http://localhost:4000/docs/user-guide/telemetry/" />
<meta property="og:site_name" content="Thingsboard" />
<meta property="og:image" content="http://localhost:4000/images/thingsboard_logo.png" />
<meta name="twitter:image" content="http://localhost:4000/images/thingsboard_logo.png" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="@thingsboard" />
<meta name="twitter:creator" content="@thingsboard" />
<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "WebPage",
    "headline": "Working with telemetry data",
    "image": "http://localhost:4000/images/thingsboard_logo.png",
    "description": "IoT device time-series data collection using various IoT protocols and Thingsboard telemetry feature",
    "logo": "http://localhost:4000/images/thingsboard_logo.png",
    "url": "http://localhost:4000/docs/user-guide/telemetry/"
  }
</script>
<!-- End Jekyll SEO tag -->
	
	
	<link rel="shortcut icon" type="image/png" href="/images/favicon.png">

	<link rel="stylesheet" href="/css/styles.css">
	<script type="text/javascript">
		/*! loadCSS. [c]2017 Filament Group, Inc. MIT License */
		!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);
		/*! onloadCSS. (onload callback for loadCSS) [c]2017 Filament Group, Inc. MIT License */
		function onloadCSS(a,b){function c(){!d&&b&&(d=!0,b.call(a))}var d;a.addEventListener&&a.addEventListener("load",c),a.attachEvent&&a.attachEvent("onload",c),"isApplicationInstalled"in navigator&&"onloadcssdefined"in a&&a.onloadcssdefined(c)}
	</script>
	<script type="text/javascript">

		function jqueryDefer(method) {
			if (window.jQuery) {
				method();
			} else {
				setTimeout(function() {
					jqueryDefer(method)
				}, 50);
			}
		}

		function jqueryUiDefer(method) {
			if (window.jQuery && window.jQuery.ui) {
				method();
			} else {
				setTimeout(function() {
					jqueryUiDefer(method)
				}, 50);
			}
		}

		function loadScript(src, callback)
		{
			var s, r, t;
			r = false;
			s = document.createElement('script');
			s.type = 'text/javascript';
			s.src = src;
			s.onload = s.onreadystatechange = function() {
				if ( !r && (!this.readyState || this.readyState == 'complete') )
				{
					r = true;
					if (callback) {
						callback();
					}
				}
			};
			t = document.getElementsByTagName('script')[0];
			t.parentNode.insertBefore(s, t);
		}

		function loadCssAsync(src, callback) {
			var stylesheet = loadCSS( src );
			if (callback) {
				onloadCSS(stylesheet, callback);
			}
		}

		function loadNextScript(index, scriptsList, completeCallback) {
			if (index < scriptsList.length) {
				var script = scriptsList[index];
				if (script.type === 'script') {
					loadScript(script.src, function() {
						index++;
						loadNextScript(index, scriptsList, completeCallback);
					});
				} else if (script.type === 'css') {
					loadCssAsync(script.src, function() {
						index++;
						loadNextScript(index, scriptsList, completeCallback);
					});
				}
			} else if (completeCallback) {
				completeCallback();
			}
		}

		var initialScriptsList = [
			{src: '/js/jquery-2.2.0.min.js', type: 'script'},
			{src: '/css/jquery-ui.min.css', type: 'css'},
			{src: '/js/jquery-ui.min.js', type: 'script'},
			{src: '/js/script.js', type: 'script'},
			{src: '/css/sweetalert.css', type: 'css'},
			{src: '/js/sweetalert.min.js', type: 'script'}
		];

		loadNextScript(0, initialScriptsList);

	</script>
	<script type="text/javascript">
		function _gaLt(event) {
			/* If GA is blocked or not loaded, or not main|middle|touch click then don't track */
			if (!ga.hasOwnProperty("loaded") || ga.loaded != true || (event.which != 1 && event.which != 2)) {
				return;
			}
			var el = event.srcElement || event.target;

			while (el && (typeof el.tagName == 'undefined' || el.tagName.toLowerCase() != 'a' || !el.href)) {
				el = el.parentNode;
			}
			if (el && el.href) {
				var link = el.href;
				if ((link.indexOf(location.host) == -1 || link.indexOf('.' + location.host) > 0) && !link.match(/^javascript\:/i)) {
					var target = (el.target && !el.target.match(/^_(self|parent|top)$/i)) ? el.target : false;
					if (event.ctrlKey || event.shiftKey || event.metaKey || event.which == 2) {
						target = "_blank";
					}

					var hbrun = false; // tracker has not yet run
					var hitBack = function() {
						if (hbrun) return;
						hbrun = true;
						window.location.href = link;
					};

					if (target) {
						ga(
								"send", "event", "Outgoing Links", link,
								document.location.pathname + document.location.search
						);
					} else {
						event.preventDefault ? event.preventDefault() : event.returnValue = !1;
						ga(
								"send", "event", "Outgoing Links", link,
								document.location.pathname + document.location.search, {
									"hitCallback": hitBack
								}
						);

						setTimeout(hitBack, 1000);
					}
				}
			}
		}

		var _w = window;
		var _gaLtEvt = ("ontouchstart" in _w) ? "click" : "mousedown";
		_w.addEventListener ? _w.addEventListener("load", function() {document.body.addEventListener(_gaLtEvt, _gaLt, !1)}, !1)
				: _w.attachEvent && _w.attachEvent("onload", function() {document.body.attachEvent("on" + _gaLtEvt, _gaLt)});
	</script>
</head>
<body>
<div id="cellophane" onclick="tb.toggleMenu()"></div>
<header>
	<a href="#" class="logo"></a>
	<div class="nav-buttons" data-auto-burger="primary">
		<a href="#" class="button" id="viewDocs" data-auto-burger-exclude>&nbsp;&nbsp;主要功能&nbsp;&nbsp;</a>
		<a href="#" class="button" id="useCases" data-auto-burger-exclude>&nbsp;&nbsp;查看文档&nbsp;&nbsp;</a>
		<a href="#" class="button" id="useCases" data-auto-burger-exclude>&nbsp;&nbsp;案例分析&nbsp;&nbsp;</a>
		<a href="#" class="button" id="gettingStarted" data-auto-burger-exclude>&nbsp;&nbsp;开始使用&nbsp;&nbsp;</a>
		<button id="hamburger" onclick="tb.toggleMenu()" data-auto-burger-exclude><div></div></button>
	</div>

	<nav id="mainNav">
		<main id="headNav" data-auto-burger="primary">
			<div class="nav-box">
				<h3><a href="#">开始使用<a></h3>
			</div>
			<div class="nav-box">
				<h3><a href="#">查看文档</a></h3>
			</div>
			<div class="nav-box">
				<h3><a href="#">案例分析</a></h3>
			</div>
			<div class="nav-box">
				<h3><a href="http://osswangxining.github.io/">Blog</a></h3>
			</div>
			<div class="nav-box">
				<h3><a href="#">服务支持</a></h3>
			</div>
			<div class="nav-box">
				<h3><a href="#">联系我们</a></h3>
			</div>
		</main>

	</nav>
</header>


<!--  HERO  -->
<section id="hero" class="light-text">
  <h1>Thingsboard Documentation</h1>
  <h5>Documentation for using Thingsboard IoT Platform.</h5>
  <div id="vendorStrip" class="light-text">
    <div id="docsList">
        <ul>
          <li><a href="/docs/" class="YAH">DOCS HOME</a></li>
          <li><a href="/docs/api/" >API</a></li>
          <li><a href="/docs/iot-gateway/" >IOT GATEWAY</a></li>
          <li><a href="/docs/reference/" >REFERENCE</a></li>
          <li><a href="/docs/samples/" >SAMPLES</a></li>
          <li><a href="/iot-use-cases/" >USE CASES</a></li>
          <li><a href="/docs/iot-video-tutorials/" >VIDEO TUTORIALS</a></li>
          <li><a href="/docs/faq/" >FAQ</a></li>
          <li><a href="/docs/services/" >SERVICES</a></li>
          <li><a href="/docs/contact-us/" >CONTACT US</a></li>
        </ul>
    </div>
    <div id="searchBox">
      <input type="text" id="search" placeholder="Search" onkeydown="if (event.keyCode==13) window.location.replace('/docs/search/?q=' + this.value)">
    </div>
  </div>
</section>





<section id="encyclopedia">
  
  <div id="docsToc" >
        <div class="pi-accordion">
        
    <a class="item" data-title="Thingsboard Documentation" href="/docs/"></a>
    <a class="item" data-title="What is Thingsboard?" href="/docs/getting-started-guides/what-is-thingsboard/"></a>
    <a class="item" data-title="Getting Started" href="/docs/getting-started-guides/helloworld/"></a>
<div class="item" data-title="Installation">
  <div class="container">
    <a class="item" data-title="Installation options" href="/docs/user-guide/install/installation-options/"></a>
    <a class="item" data-title="Installing Thingsboard on Windows" href="/docs/user-guide/install/windows/"></a>
    <a class="item" data-title="Installing Thingsboard on Linux (Ubuntu & CentOS)" href="/docs/user-guide/install/linux/"></a>
    <a class="item" data-title="Installing Thingsboard on Raspberry Pi 3" href="/docs/user-guide/install/rpi/"></a>
    <a class="item" data-title="Installing Thingsboard using Docker (Linux or Mac OS)" href="/docs/user-guide/install/docker/"></a>
    <a class="item" data-title="Installing Thingsboard using Docker (Windows)" href="/docs/user-guide/install/docker-windows/"></a>
    <a class="item" data-title="Installing Thingsboard on AWS EC2" href="/docs/user-guide/install/aws/"></a>
    <a class="item" data-title="Building from sources" href="/docs/user-guide/install/building-from-source/"></a>
    <a class="item" data-title="Upgrade instructions" href="/docs/user-guide/install/upgrade-instructions/"></a>
    <a class="item" data-title="Configuration" href="/docs/user-guide/install/config/"></a>
    <a class="item" data-title="Cluster setup" href="/docs/user-guide/install/cluster-setup/"></a>
  </div>
</div>
<div class="item" data-title="Features">
  <div class="container">
    <a class="item" data-title="Working with device attributes" href="/docs/user-guide/attributes/"></a>
    <a class="item" data-title="Working with telemetry data" href="/docs/user-guide/telemetry/"></a>
    <a class="item" data-title="Using RPC capabilities" href="/docs/user-guide/rpc/"></a>
    <a class="item" data-title="Rule engine" href="/docs/user-guide/rule-engine/"></a>
    <a class="item" data-title="Data visualization" href="/docs/user-guide/visualization/"></a>
  </div>
</div>
<div class="item" data-title="Integrations Cookbook">
  <div class="container">
    <a class="item" data-title="Persist and visualize AWS IoT data" href="/docs/iot-gateway/integration-with-aws-iot/"></a>
    <a class="item" data-title="IoT data analytics using Apache Spark" href="/docs/samples/analytics/spark-integration-with-thingsboard/"></a>
    <a class="item" data-title="SigFox IoT data collection and visualization" href="/docs/iot-gateway/sigfox-iot-data-visualization/"></a>
    <a class="item" data-title="Persist and visualize IBM Watson IoT data" href="/docs/iot-gateway/integration-with-ibm-watson-iot/"></a>
  </div>
</div>
<div class="item" data-title="Security">
  <div class="container">
    <a class="item" data-title="MQTT over SSL" href="/docs/user-guide/mqtt-over-ssl/"></a>
    <a class="item" data-title="Device authentication options" href="/docs/user-guide/device-credentials/"></a>
    <a class="item" data-title="Access Token based authentication" href="/docs/user-guide/access-token/"></a>
    <a class="item" data-title="X.509 Certificate based authentication" href="/docs/user-guide/certificates/"></a>
  </div>
</div>
<div class="item" data-title="Administration UI">
  <div class="container">
    <a class="item" data-title="Tenants" href="/docs/user-guide/ui/tenants/"></a>
    <a class="item" data-title="Customers" href="/docs/user-guide/ui/customers/"></a>
    <a class="item" data-title="Users" href="/docs/user-guide/ui/users/"></a>
    <a class="item" data-title="Devices" href="/docs/user-guide/ui/devices/"></a>
    <a class="item" data-title="Rules" href="/docs/user-guide/ui/rules/"></a>
    <a class="item" data-title="Plugins" href="/docs/user-guide/ui/plugins/"></a>
    <a class="item" data-title="Widgets Library" href="/docs/user-guide/ui/widget-library/"></a>
    <a class="item" data-title="Dashboards" href="/docs/user-guide/ui/dashboards/"></a>
    <a class="item" data-title="Mail Settings" href="/docs/user-guide/ui/mail-settings/"></a>
  </div>
</div>
    <a class="item" data-title="Troubleshooting" href="/docs/user-guide/troubleshooting/"></a>
<div class="item" data-title="Contribution Guide">
  <div class="container">
    <a class="item" data-title="How to contribute" href="/docs/user-guide/contribution/how-to-contribute/"></a>
    <a class="item" data-title="Extensions (Plugins and Actions) development" href="/docs/user-guide/contribution/extensions-development/"></a>
  </div>
</div>
        </div> <!-- /pi-accordion -->
    <button class="push-menu-close-button" onclick="tb.toggleToc()"></button>
  </div> <!-- /docsToc -->
  
  <div id="docsContent" class="">
    <h1>Working with telemetry data</h1>
    <ul id="markdown-toc">
  <li><a href="#device-telemetry-upload-api" id="markdown-toc-device-telemetry-upload-api">Device telemetry upload API</a></li>
  <li><a href="#telemetry-plugin" id="markdown-toc-telemetry-plugin">Telemetry plugin</a>    <ul>
      <li><a href="#internal-data-storage" id="markdown-toc-internal-data-storage">Internal data storage</a>        <ul>
          <li><a href="#data-query-api" id="markdown-toc-data-query-api">Data Query API</a>            <ul>
              <li><a href="#timeseries-data-keys-api" id="markdown-toc-timeseries-data-keys-api">Timeseries data keys API</a></li>
              <li><a href="#timeseries-data-values-api" id="markdown-toc-timeseries-data-values-api">Timeseries data values API</a></li>
            </ul>
          </li>
          <li><a href="#websocket-api" id="markdown-toc-websocket-api">Websocket API</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#data-visualization" id="markdown-toc-data-visualization">Data visualization</a></li>
  <li><a href="#rule-engine" id="markdown-toc-rule-engine">Rule engine</a></li>
</ul>

<p>Thingsboard provides rich set of features related to telemetry data:</p>

<ul>
  <li><strong>collect</strong> data from devices using MQTT, CoAP or HTTP protocols.</li>
  <li><strong>store</strong> timeseries data in Cassandra (efficient, scalable and fault-tolerant NoSQL database).</li>
  <li><strong>query</strong> latest timeseries data values or all data within specified time interval.</li>
  <li><strong>subscribe</strong> to data updates using websockets (for visualization or real-time analytics).</li>
  <li><strong>visualize</strong> timeseries data using configurable and highly customizable widgets and dashboards.</li>
  <li><strong>filter and analyze</strong> data using flexible Rule Engine (/docs/user-guide/rule-engine/).</li>
  <li><strong>generate alarms</strong> based on collected data.</li>
  <li><strong>forward</strong> data to external systems using plugins (e.g. Kafka or RabbitMQ plugins).</li>
</ul>

<p>This guide provides overview of the features listed above and some useful links to get more details.</p>

<p><img src="/images/user-guide/telemetry.svg" alt="image" /></p>

<h2 id="device-telemetry-upload-api">Device telemetry upload API</h2>

<p>Thingsboard provides an API to upload timeseries key-value data. 
Flexibility and simplicity of key-value format allows easy and seamless integration with almost any IoT device on the market.
Telemetry upload API is specific for each supported network protocol.
You can review API and examples in corresponding reference page:</p>

<ul>
  <li><a href="/docs/reference/mqtt-api/#telemetry-upload-api">MQTT API reference</a></li>
  <li><a href="/docs/reference/coap-api/#telemetry-upload-api">CoAP API reference</a></li>
  <li><a href="/docs/reference/http-api/#telemetry-upload-api">HTTP API reference</a></li>
</ul>

<h2 id="telemetry-plugin">Telemetry plugin</h2>

<p>Thingsboard consist of core services and plug-able modules called plugins. 
Telemetry plugin is responsible for persisting timeseries data to internal data storage; 
provides server-side api to query and subscribe for data updates. 
Since Telemetry plugin functionality is critical for data visualization purposes in dashboards, it is configured on the system level by system administrator.
Advanced users or platform developers can customize telemetry plugin functionality.</p>

<h3 id="internal-data-storage">Internal data storage</h3>

<p>Thingsboard uses Cassandra NoSQL database. This database is optimized for storage of timeseries data.
Cassandra takes care of data replication and provides scalable, reliable and fault-tolerant storage.</p>

<p>Device that is sending data to the server will receive confirmation about data delivery as soon as data is stored in cassandra.
Modern MQTT clients allow temporary local storage of undelivered data. 
Thus, even if one of the Thingsboard nodes goes down, device will not lose the data and will be able to push it to other servers.</p>

<p>Data is stored into several column families:</p>

<ul>
  <li><strong>ts_kv_cf</strong> - raw data is partitioned by <em>device id</em>, <em>data key</em> and <em>partition</em></li>
  <li><strong>ts_kv_partitions_cf</strong> - stores list of partitions for each <em>device id</em> and <em>data key</em> that allows execution of efficient queries of the data.</li>
  <li><strong>ts_kv_latest_cf</strong> - stores latest values for quick access.</li>
</ul>

<p>Although you can query database directly, Thingsboard provide set of RESTful and Websocket API that simplify this process and apply certain security policies:</p>

<ul>
  <li>Tenant Administrator user is able to fetch data for all unassigned devices that belong to corresponding tenant.</li>
  <li>Customer user is able to fetch data only for devices that are assigned to corresponding customer.</li>
</ul>

<h4 id="data-query-api">Data Query API</h4>

<p>Telemetry plugin provides following API to fetch device data:</p>

<h5 id="timeseries-data-keys-api">Timeseries data keys API</h5>

<p>You can fetch list of all <em>data keys</em> for particular <em>device id</em> using GET request to the following URL</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>http<span class="o">(</span>s<span class="o">)</span>://host:port/api/plugins/telemetry/<span class="o">{</span>deviceId<span class="o">}</span>/keys/timeseries
</code></pre>
</div>

<script>
  jqueryUiDefer(initTabs);
  function initTabs() {
    $(function(){$("#get-telemetry-keys").tabs();});
  }
</script>

<div id="get-telemetry-keys">
  <ul>
    <li><a href="#A">get-telemetry-keys.sh</a></li>
    <li><a href="#B">get-telemetry-keys-result.json</a></li>
  </ul>
  <div id="A">
    <table class="includecode"><thead><tr><th><a href="https://raw.githubusercontent.com/thingsboard/thingsboard.github.io/master/docs/user-guide/resources/get-telemetry-keys.sh" download="resources/get-telemetry-keys.sh"><code>resources/get-telemetry-keys.sh</code></a><img src="/images/copycode.svg" style="max-height:24px" onclick="copyCode('resources/get-telemetry-keys.sh')" title="Copy resources/get-telemetry-keys.sh to clipboard" /></th></tr></thead>
<tr><td>
<div id="resources/get-telemetry-keys.sh" class="language-shell highlighter-rouge"><pre class="highlight"><code>curl -v -X GET http://localhost:8080/api/plugins/telemetry/ac8e6020-ae99-11e6-b9bd-2b15845ada4e/keys/timeseries <span class="se">\</span>
--header <span class="s2">"Content-Type:application/json"</span> <span class="se">\</span>
--header <span class="s2">"X-Authorization: </span><span class="nv">$JWT_TOKEN</span><span class="s2">"</span>
</code></pre>
</div>
</td></tr></table>
  </div>
  <div id="B">
    <table class="includecode"><thead><tr><th><a href="https://raw.githubusercontent.com/thingsboard/thingsboard.github.io/master/docs/user-guide/resources/get-telemetry-keys-result.json" download="resources/get-telemetry-keys-result.json"><code>resources/get-telemetry-keys-result.json</code></a><img src="/images/copycode.svg" style="max-height:24px" onclick="copyCode('resources/get-telemetry-keys-result.json')" title="Copy resources/get-telemetry-keys-result.json to clipboard" /></th></tr></thead>
<tr><td>
<div id="resources/get-telemetry-keys-result.json" class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">[</span><span class="s2">"gas"</span><span class="p">,</span><span class="s2">"temperature"</span><span class="p">]</span><span class="w">
</span></code></pre>
</div>
</td></tr></table>
  </div>
</div>

<h5 id="timeseries-data-values-api">Timeseries data values API</h5>

<p>You can fetch list of latest values for particular <em>device id</em> using GET request to the following URL</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>http<span class="o">(</span>s<span class="o">)</span>://host:port/api/plugins/telemetry/<span class="o">{</span>deviceId<span class="o">}</span>/values/timeseries?keys<span class="o">=</span>key1,key2,key3
</code></pre>
</div>

<script>
  jqueryUiDefer(initTabs);
  function initTabs() {
    $(function(){$("#get-latest-telemetry-values").tabs();});
  }
</script>

<div id="get-latest-telemetry-values">
  <ul>
    <li><a href="#A">get-latest-telemetry-values.sh</a></li>
    <li><a href="#B">get-latest-telemetry-values-result.json</a></li>
  </ul>
  <div id="A">
    <table class="includecode"><thead><tr><th><a href="https://raw.githubusercontent.com/thingsboard/thingsboard.github.io/master/docs/user-guide/resources/get-latest-telemetry-values.sh" download="resources/get-latest-telemetry-values.sh"><code>resources/get-latest-telemetry-values.sh</code></a><img src="/images/copycode.svg" style="max-height:24px" onclick="copyCode('resources/get-latest-telemetry-values.sh')" title="Copy resources/get-latest-telemetry-values.sh to clipboard" /></th></tr></thead>
<tr><td>
<div id="resources/get-latest-telemetry-values.sh" class="language-shell highlighter-rouge"><pre class="highlight"><code>curl -v -X GET http://localhost:8080/api/plugins/telemetry/ac8e6020-ae99-11e6-b9bd-2b15845ada4e/values/timeseries?keys<span class="o">=</span>gas,temperature <span class="se">\</span>
--header <span class="s2">"Content-Type:application/json"</span> <span class="se">\</span>
--header <span class="s2">"X-Authorization: </span><span class="nv">$JWT_TOKEN</span><span class="s2">"</span>
</code></pre>
</div>
</td></tr></table>
  </div>
  <div id="B">
    <table class="includecode"><thead><tr><th><a href="https://raw.githubusercontent.com/thingsboard/thingsboard.github.io/master/docs/user-guide/resources/get-latest-telemetry-values-result.json" download="resources/get-latest-telemetry-values-result.json"><code>resources/get-latest-telemetry-values-result.json</code></a><img src="/images/copycode.svg" style="max-height:24px" onclick="copyCode('resources/get-latest-telemetry-values-result.json')" title="Copy resources/get-latest-telemetry-values-result.json to clipboard" /></th></tr></thead>
<tr><td>
<div id="resources/get-latest-telemetry-values-result.json" class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"gas"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"ts"</span><span class="p">:</span><span class="w"> </span><span class="mi">1479735870786</span><span class="p">,</span><span class="w">
      </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nt">"temperature"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"ts"</span><span class="p">:</span><span class="w"> </span><span class="mi">1479735870786</span><span class="p">,</span><span class="w">
      </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>
</td></tr></table>
  </div>
</div>

<p>You can also fetch list of historical values for particular <em>device id</em> using GET request to the following URL</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>http<span class="o">(</span>s<span class="o">)</span>://host:port/api/plugins/telemetry/<span class="o">{</span>deviceId<span class="o">}</span>/values/timeseries?keys<span class="o">=</span>key1,key2,key3&amp;startTs<span class="o">=</span>1479735870785&amp;endTs<span class="o">=</span>1479735871858&amp;interval<span class="o">=</span>60000&amp;limit<span class="o">=</span>100&amp;agg<span class="o">=</span>AVG
</code></pre>
</div>

<p>The supported parameters are described below:</p>

<ul>
  <li><strong>keys</strong> - comma separated list of telemetry keys to fetch.</li>
  <li><strong>startTs</strong> - unix timestamp that identifies start of the interval in milliseconds.</li>
  <li><strong>endTs</strong> - unix timestamp that identifies end of the interval in milliseconds.</li>
  <li><strong>interval</strong> - the aggregation interval, in milliseconds.</li>
  <li><strong>agg</strong> - the aggregation function. One of MIN, MAX, AVG, SUM, COUNT, NONE.</li>
  <li><strong>limit</strong> - the max amount of data points to return or intervals to process.</li>
</ul>

<p>Thingsboard will use <em>startTs</em>, <em>endTs</em> and <em>interval</em> to identify aggregation partitions or sub-queries and execute asynchronous queries to Cassandra that levarage built-in aggregation functions.</p>

<script>
  jqueryUiDefer(initTabs);
  function initTabs() {
    $(function(){$("#get-telemetry-values").tabs();});
  }
</script>

<div id="get-telemetry-values">
  <ul>
    <li><a href="#A">get-telemetry-values.sh</a></li>
    <li><a href="#B">get-telemetry-values-result.json</a></li>
  </ul>
  <div id="A">
    <table class="includecode"><thead><tr><th><a href="https://raw.githubusercontent.com/thingsboard/thingsboard.github.io/master/docs/user-guide/resources/get-telemetry-values.sh" download="resources/get-telemetry-values.sh"><code>resources/get-telemetry-values.sh</code></a><img src="/images/copycode.svg" style="max-height:24px" onclick="copyCode('resources/get-telemetry-values.sh')" title="Copy resources/get-telemetry-values.sh to clipboard" /></th></tr></thead>
<tr><td>
<div id="resources/get-telemetry-values.sh" class="language-shell highlighter-rouge"><pre class="highlight"><code>curl -v -X GET <span class="s2">"http://localhost:8080/api/plugins/telemetry/ac8e6020-ae99-11e6-b9bd-2b15845ada4e/values/timeseries?keys=gas,temperature&amp;startTs=1479735870785&amp;endTs=1479735871858&amp;interval=60000&amp;limit=100&amp;agg=AVG"</span> <span class="se">\</span>
--header <span class="s2">"Content-Type:application/json"</span> <span class="se">\</span>
--header <span class="s2">"X-Authorization: </span><span class="nv">$JWT_TOKEN</span><span class="s2">"</span>
</code></pre>
</div>
</td></tr></table>
  </div>
  <div id="B">
    <table class="includecode"><thead><tr><th><a href="https://raw.githubusercontent.com/thingsboard/thingsboard.github.io/master/docs/user-guide/resources/get-telemetry-values-result.json" download="resources/get-telemetry-values-result.json"><code>resources/get-telemetry-values-result.json</code></a><img src="/images/copycode.svg" style="max-height:24px" onclick="copyCode('resources/get-telemetry-values-result.json')" title="Copy resources/get-telemetry-values-result.json to clipboard" /></th></tr></thead>
<tr><td>
<div id="resources/get-telemetry-values-result.json" class="language-json highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"gas"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"ts"</span><span class="p">:</span><span class="w"> </span><span class="mi">1479735870786</span><span class="p">,</span><span class="w">
      </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"ts"</span><span class="p">:</span><span class="w"> </span><span class="mi">1479735871857</span><span class="p">,</span><span class="w">
      </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="nt">"temperature"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"ts"</span><span class="p">:</span><span class="w"> </span><span class="mi">1479735870786</span><span class="p">,</span><span class="w">
      </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nt">"ts"</span><span class="p">:</span><span class="w"> </span><span class="mi">1479735871857</span><span class="p">,</span><span class="w">
      </span><span class="nt">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>
</td></tr></table>
  </div>
</div>

<h4 id="websocket-api">Websocket API</h4>

<p>Websockets are actively used by Thingsobard Web UI. Websocket API duplicates REST API functionality and provides ability to subscribe to device data changes.
You can open a websocket connection to a telemetry plugin using following URL</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>ws<span class="o">(</span>s<span class="o">)</span>://host:port/api/ws/plugins/telemetry?token<span class="o">=</span><span class="nv">$JWT_TOKEN</span>
</code></pre>
</div>

<p>Once opened, you can send 
<a href="https://github.com/thingsboard/thingsboard/blob/master/extensions/extensions-core/src/main/java/org/thingsboard/server/extensions/core/plugin/telemetry/cmd/TelemetryPluginCmdsWrapper.java">subscription commands</a> 
and receive 
<a href="https://github.com/thingsboard/thingsboard/blob/master/extensions/extensions-core/src/main/java/org/thingsboard/server/extensions/core/plugin/telemetry/sub/SubscriptionUpdate.java">subscription updates</a>:</p>

<p>where</p>

<ul>
  <li><strong>cmdId</strong> - unique command id (within corresponding websocket connection)</li>
  <li><strong>deviceId</strong> - unique device identifier</li>
  <li><strong>keys</strong> - comma separated list of data keys</li>
  <li><strong>timeWindow</strong> - fetch interval for timeseries subscriptions, in milliseconds. Data will be fetch within following interval <strong>[now()-timeWindow, now()]</strong></li>
  <li><strong>startTs</strong> - start time of fetch interval for historical data query, in milliseconds.</li>
  <li><strong>endTs</strong> - end time of fetch interval for historical data query, in milliseconds.</li>
</ul>

<p>Complete example is coming soon!</p>

<h2 id="data-visualization">Data visualization</h2>

<p>Thingsboard provide ability to configure and customize dashboards for data visualization. 
This topic is covered in separate guide.</p>
<p><a href="/docs/user-guide/visualization" class="button">Data Visualization guide</a></p>

<h2 id="rule-engine">Rule engine</h2>

<p>Thingsboard provide ability to configure data processing rules. 
Each rule consists of</p>

<ul>
  <li>filters - to filter incoming data feed,</li>
  <li>processor - to generate alarms or enrich incoming data with some server-side values</li>
  <li>action - to apply certain logic to filtered data.
You can find more details in a separate guide.</li>
</ul>
<p><a href="/docs/user-guide/rule-engine" class="button">Rule Engine guide</a></p>


  </div>
</section>

<footer>
	<main class="light-text">
		
		<div id="miceType" class="center">&copy; 2016 - 2017 IoT套件</div>
	</main>

</footer>



<button class="flyout-button" onclick="tb.toggleToc()"></button>


<style>
  .cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
  }
  .gsc-control-cse table, .gsc-control-cse-en table {
    margin:0px !important;
  }
  .gsc-above-wrapper-area {
    border-bottom: 0;
  }
</style>
</body>
</html>
