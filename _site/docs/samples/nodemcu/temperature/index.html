

<!Doctype html>
<html id="docs" class="Samples">



<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	
	<!-- Begin Jekyll SEO tag v2.0.0 -->
<title>Temperature upload over MQTT using NodeMCU and DHT11 sensor - Thingsboard</title>
<meta property="og:title" content="Temperature upload over MQTT using NodeMCU and DHT11 sensor" />
<meta name="description" content="Thingsboard IoT Platform sample for temperature data upload over MQTT using NodeMCU and DHT11 sensor." />
<meta property="og:description" content="Thingsboard IoT Platform sample for temperature data upload over MQTT using NodeMCU and DHT11 sensor." />
<link rel="canonical" href="http://localhost:4000/docs/samples/nodemcu/temperature/" />
<meta property="og:url" content="http://localhost:4000/docs/samples/nodemcu/temperature/" />
<meta property="og:site_name" content="Thingsboard" />
<meta property="og:image" content="http://localhost:4000/images/thingsboard_logo.png" />
<meta name="twitter:image" content="http://localhost:4000/images/thingsboard_logo.png" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="@thingsboard" />
<meta name="twitter:creator" content="@thingsboard" />
<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "WebPage",
    "headline": "Temperature upload over MQTT using NodeMCU and DHT11 sensor",
    "image": "http://localhost:4000/images/thingsboard_logo.png",
    "description": "Thingsboard IoT Platform sample for temperature data upload over MQTT using NodeMCU and DHT11 sensor.",
    "logo": "http://localhost:4000/images/thingsboard_logo.png",
    "url": "http://localhost:4000/docs/samples/nodemcu/temperature/"
  }
</script>
<!-- End Jekyll SEO tag -->
	
	
	<meta name="twitter:description" content="Thingsboard IoT Platform sample for temperature data upload over MQTT using NodeMCU and DHT11 sensor."/>
	
	
	<link rel="shortcut icon" type="image/png" href="/images/favicon.png">
	<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700" rel="stylesheet">
	<link rel="stylesheet" href="/css/styles.css">
	<script type="text/javascript">
		/*! loadCSS. [c]2017 Filament Group, Inc. MIT License */
		!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);
		/*! onloadCSS. (onload callback for loadCSS) [c]2017 Filament Group, Inc. MIT License */
		function onloadCSS(a,b){function c(){!d&&b&&(d=!0,b.call(a))}var d;a.addEventListener&&a.addEventListener("load",c),a.attachEvent&&a.attachEvent("onload",c),"isApplicationInstalled"in navigator&&"onloadcssdefined"in a&&a.onloadcssdefined(c)}
	</script>
	<script type="text/javascript">

		function jqueryDefer(method) {
			if (window.jQuery) {
				method();
			} else {
				setTimeout(function() {
					jqueryDefer(method)
				}, 50);
			}
		}

		function jqueryUiDefer(method) {
			if (window.jQuery && window.jQuery.ui) {
				method();
			} else {
				setTimeout(function() {
					jqueryUiDefer(method)
				}, 50);
			}
		}

		function loadScript(src, callback)
		{
			var s, r, t;
			r = false;
			s = document.createElement('script');
			s.type = 'text/javascript';
			s.src = src;
			s.onload = s.onreadystatechange = function() {
				if ( !r && (!this.readyState || this.readyState == 'complete') )
				{
					r = true;
					if (callback) {
						callback();
					}
				}
			};
			t = document.getElementsByTagName('script')[0];
			t.parentNode.insertBefore(s, t);
		}

		function loadCssAsync(src, callback) {
			var stylesheet = loadCSS( src );
			if (callback) {
				onloadCSS(stylesheet, callback);
			}
		}

		function loadNextScript(index, scriptsList, completeCallback) {
			if (index < scriptsList.length) {
				var script = scriptsList[index];
				if (script.type === 'script') {
					loadScript(script.src, function() {
						index++;
						loadNextScript(index, scriptsList, completeCallback);
					});
				} else if (script.type === 'css') {
					loadCssAsync(script.src, function() {
						index++;
						loadNextScript(index, scriptsList, completeCallback);
					});
				}
			} else if (completeCallback) {
				completeCallback();
			}
		}

		var initialScriptsList = [
			{src: '/js/jquery-2.2.0.min.js', type: 'script'},
			{src: '/css/jquery-ui.min.css', type: 'css'},
			{src: '/js/jquery-ui.min.js', type: 'script'},
			{src: '/js/script.js', type: 'script'},
			{src: '/css/sweetalert.css', type: 'css'},
			{src: '/js/sweetalert.min.js', type: 'script'}
		];

		loadNextScript(0, initialScriptsList);

	</script>
	<script type="text/javascript">
		function _gaLt(event) {
			/* If GA is blocked or not loaded, or not main|middle|touch click then don't track */
			if (!ga.hasOwnProperty("loaded") || ga.loaded != true || (event.which != 1 && event.which != 2)) {
				return;
			}
			var el = event.srcElement || event.target;

			while (el && (typeof el.tagName == 'undefined' || el.tagName.toLowerCase() != 'a' || !el.href)) {
				el = el.parentNode;
			}
			if (el && el.href) {
				var link = el.href;
				if ((link.indexOf(location.host) == -1 || link.indexOf('.' + location.host) > 0) && !link.match(/^javascript\:/i)) {
					var target = (el.target && !el.target.match(/^_(self|parent|top)$/i)) ? el.target : false;
					if (event.ctrlKey || event.shiftKey || event.metaKey || event.which == 2) {
						target = "_blank";
					}

					var hbrun = false; // tracker has not yet run
					var hitBack = function() {
						if (hbrun) return;
						hbrun = true;
						window.location.href = link;
					};

					if (target) {
						ga(
								"send", "event", "Outgoing Links", link,
								document.location.pathname + document.location.search
						);
					} else {
						event.preventDefault ? event.preventDefault() : event.returnValue = !1;
						ga(
								"send", "event", "Outgoing Links", link,
								document.location.pathname + document.location.search, {
									"hitCallback": hitBack
								}
						);

						setTimeout(hitBack, 1000);
					}
				}
			}
		}

		var _w = window;
		var _gaLtEvt = ("ontouchstart" in _w) ? "click" : "mousedown";
		_w.addEventListener ? _w.addEventListener("load", function() {document.body.addEventListener(_gaLtEvt, _gaLt, !1)}, !1)
				: _w.attachEvent && _w.attachEvent("onload", function() {document.body.attachEvent("on" + _gaLtEvt, _gaLt)});
	</script>
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
					(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
				m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-88383331-1', 'auto');
		ga('send', 'pageview');
	</script>
</head>
<body>
<div id="cellophane" onclick="tb.toggleMenu()"></div>
<header>
	<a href="/" class="logo"></a>
	<div id="githubButtonContainer">
		<iframe id="gh-btn-frame" src="https://ghbtns.com/github-btn.html?user=thingsboard&repo=thingsboard&type=star&count=true&size=large"
				frameborder="0"
				scrolling="0" width="130px" height="30px"></iframe>
	</div>
	<div class="nav-buttons" data-auto-burger="primary">
		<a href="/docs/" class="button" id="viewDocs" data-auto-burger-exclude>View Documentation</a>
		<a href="/iot-use-cases/" class="button" id="useCases" data-auto-burger-exclude>Use cases</a>
		<a href="/docs/getting-started-guides/helloworld/" class="button" id="gettingStarted" data-auto-burger-exclude>Getting started</a>
		<a target="_blank" href="https://demo.thingsboard.io/signup" class="button" id="liveDemo" data-auto-burger-exclude>Live demo</a>
		<button id="hamburger" onclick="tb.toggleMenu()" data-auto-burger-exclude><div></div></button>
	</div>

	<nav id="mainNav">
		<main id="headNav" data-auto-burger="primary">
			<div class="nav-box">
				<h3><a href="/docs/getting-started-guides/helloworld/">Get Started</a></h3>
			</div>
			<div class="nav-box">
				<h3><a href="/docs/">Documentation</a></h3>
			</div>
			<div class="nav-box">
				<h3><a href="/iot-use-cases/">Use cases</a></h3>
			</div>
			<div class="nav-box">
				<h3><a href="http://blog.thingsboard.io/">Blog</a></h3>
			</div>
			<div class="nav-box">
				<h3><a href="/docs/services/">Services</a></h3>
			</div>
			<div class="nav-box">
				<h3><a href="/docs/contact-us/">Contact us</a></h3>
			</div>
		</main>
		<main data-auto-burger="primary">
			<div class="center">
				<div class="social">
					<a href="https://twitter.com/thingsboard" class="twitter"><span>Twitter</span></a>
					<a href="https://github.com/thingsboard/thingsboard" class="github"><span>Github</span></a>
					<a href="https://gitter.im/thingsboard/chat" class="gitter"><span>Gitter</span></a>
					<a href="http://stackoverflow.com/questions/tagged/thingsboard" class="stack-overflow"><span>Stack Overflow</span></a>
					<a href="https://groups.google.com/forum/#!forum/thingsboard" class="mailing-list"><span>Mailing List</span></a>
					<a href="https://www.youtube.com/channel/UCDb9fsV-YR4JmnipAMGsVAQ" class="youtube"><span>YouTube Channel</span></a>
					<a href="https://www.facebook.com/thingsboard" class="facebook"><span>Facebook Page</span></a>
				</div>
			</div>
			<div class="clear" style="clear: both"></div>
		</main>
	</nav>
</header>


<!--  HERO  -->
<section id="hero" class="light-text">
  <h1>Samples</h1>
  <h5>A collection of example applications that show how to use Thingsboard.</h5>
  <div id="vendorStrip" class="light-text">
    <div id="docsList">
        <ul>
          <li><a href="/docs/" >DOCS HOME</a></li>
          <li><a href="/docs/api/" >API</a></li>
          <li><a href="/docs/iot-gateway/" >IOT GATEWAY</a></li>
          <li><a href="/docs/reference/" >REFERENCE</a></li>
          <li><a href="/docs/samples/" class="YAH">SAMPLES</a></li>
          <li><a href="/iot-use-cases/" >USE CASES</a></li>
          <li><a href="/docs/iot-video-tutorials/" >VIDEO TUTORIALS</a></li>
          <li><a href="/docs/faq/" >FAQ</a></li>
          <li><a href="/docs/services/" >SERVICES</a></li>
          <li><a href="/docs/contact-us/" >CONTACT US</a></li>
        </ul>
    </div>
    <div id="searchBox">
      <input type="text" id="search" placeholder="Search" onkeydown="if (event.keyCode==13) window.location.replace('/docs/search/?q=' + this.value)">
    </div>
  </div>
</section>





<section id="encyclopedia">
  
  <div id="docsToc" >
        <div class="pi-accordion">
        
    <a class="item" data-title="Samples" href="/docs/samples/"></a>
    <a class="item" data-title="Live Demo Server" href="/docs/user-guide/live-demo/"></a>
    <a class="item" data-title="Local Demo Account" href="/docs/samples/demo-account/"></a>
<div class="item" data-title="Hardware samples">
  <div class="container">
<div class="item" data-title="Arduino">
  <div class="container">
    <a class="item" data-title="Arduino overview" href="/docs/samples/arduino/"></a>
    <a class="item" data-title="Temperature upload over MQTT using Arduino UNO, ESP8266 and DHT22 sensor" href="/docs/samples/arduino/temperature/"></a>
  </div>
</div>
<div class="item" data-title="ESP8266">
  <div class="container">
    <a class="item" data-title="ESP8266 overview" href="/docs/samples/esp8266/"></a>
    <a class="item" data-title="Temperature upload over MQTT using ESP8266 and DHT22 sensor" href="/docs/samples/esp8266/temperature/"></a>
    <a class="item" data-title="ESP8266 GPIO control over MQTT using Thingsboard" href="/docs/samples/esp8266/gpio/"></a>
  </div>
</div>
<div class="item" data-title="NodeMCU">
  <div class="container">
    <a class="item" data-title="NodeMCU overview" href="/docs/samples/nodemcu/"></a>
    <a class="item" data-title="Temperature upload over MQTT using NodeMCU and DHT11 sensor" href="/docs/samples/nodemcu/temperature/"></a>
  </div>
</div>
<div class="item" data-title="Raspberry Pi">
  <div class="container">
    <a class="item" data-title="Raspberry Pi overview" href="/docs/samples/raspberry/"></a>
    <a class="item" data-title="Raspberry Pi GPIO control over MQTT using Thingsboard" href="/docs/samples/raspberry/gpio/"></a>
    <a class="item" data-title="Raspberry Pi GPIO control using Android Things and Thingsboard" href="/docs/samples/raspberry/gpio-android-things/"></a>
    <a class="item" data-title="Temperature upload over MQTT using Raspberry Pi and DHT22 sensor" href="/docs/samples/raspberry/temperature/"></a>
  </div>
</div>
<div class="item" data-title="LinkIt ONE">
  <div class="container">
    <a class="item" data-title="LinkIt ONE overview" href="/docs/samples/linkit-one/"></a>
    <a class="item" data-title="GPS data upload and visualization using LinkIt ONE and Thingsboard" href="/docs/samples/linkit-one/gps/"></a>
  </div>
</div>
  </div>
</div>
<div class="item" data-title="Tutorials">
  <div class="container">
<div class="item" data-title="Alarms">
  <div class="container">
    <a class="item" data-title="Sending Alarms using Email Plugin" href="/docs/samples/alarms/mail/"></a>
    <a class="item" data-title="Alarms based on devices attributes and sensor readings" href="/docs/samples/alarms/basic-rules/"></a>
  </div>
</div>
    <a class="item" data-title="Facilities Monitoring PoC" href="/docs/samples/monitoring/facilities-monitoring-poc/"></a>
  </div>
</div>
        </div> <!-- /pi-accordion -->
    <button class="push-menu-close-button" onclick="tb.toggleToc()"></button>
  </div> <!-- /docsToc -->
  
  <div id="docsContent" class="">
    <h1>Temperature upload over MQTT using NodeMCU and DHT11 sensor</h1>
    <ul id="markdown-toc">
  <li><a href="#introduction" id="markdown-toc-introduction">Introduction</a></li>
  <li><a href="#prerequisites" id="markdown-toc-prerequisites">Prerequisites</a></li>
  <li><a href="#list-of-hardware-and-pinouts" id="markdown-toc-list-of-hardware-and-pinouts">List of hardware and pinouts</a></li>
  <li><a href="#wiring-schema" id="markdown-toc-wiring-schema">Wiring schema</a></li>
  <li><a href="#programming-the-nodemcu-device" id="markdown-toc-programming-the-nodemcu-device">Programming the NodeMCU device</a>    <ul>
      <li><a href="#firmware-download" id="markdown-toc-firmware-download">Firmware download</a></li>
      <li><a href="#building-firmware-using-docker" id="markdown-toc-building-firmware-using-docker">Building firmware using Docker</a></li>
      <li><a href="#application-source-code" id="markdown-toc-application-source-code">Application source code</a></li>
      <li><a href="#flashing-the-firmware" id="markdown-toc-flashing-the-firmware">Flashing the firmware</a></li>
      <li><a href="#troubleshooting" id="markdown-toc-troubleshooting">Troubleshooting</a></li>
    </ul>
  </li>
  <li><a href="#data-visualization" id="markdown-toc-data-visualization">Data visualization</a></li>
  <li><a href="#next-steps" id="markdown-toc-next-steps">Next steps</a></li>
  <li><a href="#your-feedback" id="markdown-toc-your-feedback">Your feedback</a></li>
</ul>

<h2 id="introduction">Introduction</h2>
<p>Thingsboard is an open-source server-side platform that allows you to monitor and control IoT devices. 
It is free for both personal and commercial usage and you can deploy it anywhere. 
If this is your first experience with the platform we recommend to review 
<a href="/docs/getting-started-guides/what-is-thingsboard/">what-is-thingsboard</a> page and <a href="/docs/getting-started-guides/helloworld/">getting-started</a> guide.</p>

<p>This sample application performs collection of temperature and humidity values produced by DHT11 sensor. 
Collected data is pushed to Thingsboard for storage and visualization.
The purpose of this application is to demonstrate Thingsboard <a href="/docs/user-guide/telemetry/">data collection API</a> and <a href="/docs/user-guide/visualization/">visualization capabilities</a>.</p>

<p>The DHT11 sensor is connected to <a href="https://en.wikipedia.org/wiki/NodeMCU">NodeMCU</a>. NodeMCU push data to Thingsboard server via <a href="https://en.wikipedia.org/wiki/MQTT">MQTT</a> protocol.
Data is visualized using built-in customizable dashboard. The application that is running on NodeMCU is written using Lua scripting language which is quite simple and easy to understand.</p>

<p>Once you complete this sample/tutorial, you will see your sensor data on the following dashboard.</p>

<p><img src="/images/samples/nodemcu/temperature/dashboard.png" alt="image" /></p>

<h2 id="prerequisites">Prerequisites</h2>

<p>You will need to Thingsboard server up and running. Use either <a href="https://demo.thingsboard.io/signup">Live Demo</a> or 
<a href="/docs/user-guide/install/installation-options/">Installation Guide</a> to install Thingsboard.</p>

<h2 id="list-of-hardware-and-pinouts">List of hardware and pinouts</h2>

<ul>
  <li><a href="https://www.aliexpress.com/item/1pcs-Wireless-module-NodeMcu-Lua-WIFI-Internet-of-Things-development-board-based-ESP8266-CP2102-with-pcb/32656401198.html?spm=2114.01010208.3.1.JnJev4&amp;ws_ab_test=searchweb0_0,searchweb201602_3_10065_10068_10000007_10084_10083_10080_10082_10081_10060_10061_10062_10056_10055_10037_10054_10033_10059_10032_10099_10078_10079_10077_10073_10097_10100_10096_10070_423_10052_10050_424_10051,searchweb201603_2&amp;btsid=22a4a35a-c3ac-4896-b8b4-8ce38945d312">NodeMCU V3</a> - You 
 can find list of additional documentation in <a href="/docs/samples/nodemcu/">NodeMCU overview</a></li>
</ul>

<p><img src="/images/samples/nodemcu/temperature/nodemcu-pinout.jpg" alt="image" /></p>

<ul>
  <li><a href="https://www.aliexpress.com/item/Smart-3pin-KEYES-KY-015-DHT-11-DHT11-Digital-Temperature-And-Relative-Humidity-Sensor-Module-PCB/32571935933.html">Keyes DHT-11</a> - DHT11 sensor with built-in resistor.</li>
</ul>

<p><img src="/images/samples/nodemcu/temperature/dht-pinout.jpg" alt="image" /></p>

<ul>
  <li>3 female-to-female jumper wires</li>
</ul>

<h2 id="wiring-schema">Wiring schema</h2>

<p><img src="/images/samples/nodemcu/temperature/schema.png" alt="image" /></p>

<table>
  <thead>
    <tr>
      <th>NodeMCU Pin</th>
      <th>DHT-11 Pin</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>NodeMCU 3.3V</td>
      <td>DHT-11 VCC</td>
    </tr>
    <tr>
      <td>NodeMCU GND</td>
      <td>DHT-11 GND (-)</td>
    </tr>
    <tr>
      <td>NodeMCU D5</td>
      <td>DHT-11 Data (S)</td>
    </tr>
  </tbody>
</table>

<h2 id="programming-the-nodemcu-device">Programming the NodeMCU device</h2>

<p>We need to download and build firmware with Lua interpreter for NodeMCU. 
This process is described in <a href="https://nodemcu.readthedocs.io/en/master/en/build/">official documentation</a> and there are multiple way to do this.
You can use <a href="http://nodemcu-build.com/">cloud build service</a> for this purpose, however, we will use <a href="https://hub.docker.com/r/marcelstoer/nodemcu-build/">Docker Image</a>.</p>

<h3 id="firmware-download">Firmware download</h3>

<p>Use following commands to clone official github repository for NodeMCU firmware.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>mkdir -p ~/samples/nodemcu
<span class="gp">$ </span><span class="nb">cd</span> ~/samples/nodemcu
<span class="gp">$ </span>git clone https://github.com/nodemcu/nodemcu-firmware.git
</code></pre>
</div>
<p>There is ability to customize firmware by changing two files:</p>

<ul>
  <li>~/samples/nodemcu/nodemcu-firmware/app/include/user_config.h - There is an ability to change default baud rate in.</li>
</ul>

<p>Please find and update line below to specify custom baud rate.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>...
#define BIT_RATE_DEFAULT BIT_RATE_115200
...
</code></pre>
</div>

<ul>
  <li>~/samples/nodemcu/nodemcu-firmware/app/include/user_modules.h - Contains list of what kind of modules included by default.</li>
</ul>

<p>In our case all necessary modules included by default. However, please check that these modules are uncommented.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>...
define LUA_USE_MODULES_DHT
...
define LUA_USE_MODULES_MQTT
...
</code></pre>
</div>

<h3 id="building-firmware-using-docker">Building firmware using Docker</h3>

<p>The easiest way to build nodemcu firmware is by using prepared docker container for that task.</p>

<p>Please visit <a href="https://docs.docker.com/engine/installation/">docker installation</a> page and install docker on your machine.</p>

<p>After installation you need to download docker image from docker hub by command:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>sudo docker pull marcelstoer/nodemcu-build 
</code></pre>
</div>

<p>Eventually build the firmware by next command:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>sudo docker run --rm -ti -v ~/samples/nodemcu/nodemcu-firmware:/opt/nodemcu-firmware marcelstoer/nodemcu-build
</code></pre>
</div>

<p>As the result binary firmware located in the <strong>~/samples/nodemcu/nodemcu-firmware/bin</strong> folder.</p>

<h3 id="application-source-code">Application source code</h3>

<p>Our application consists of three <em>.lua</em> files:</p>

<ul>
  <li>config.lua - configuration file, where we define custom configuration. 
You need to modify this file in order to setup your wifi network parameters and address of Thingsboard server.
    <ul>
      <li>your wifi network SSID - name of the wifi network.</li>
      <li>your wifi network password - password to the network.</li>
      <li>thingsboard server ip - host where your thingsboard installation. Use “demo.thingsboard.io” if you are using <a href="https://demo.thingsboard.io/">live demo</a> server.</li>
      <li>thingsboard mqtt port - 1883 is the default value.</li>
      <li>thingsboard access token - DHT11_DEMO_TOKEN is the default value that corresponds to pre-provisioned <a href="/docs/samples/demo-account/#tenant-devices">demo account</a>.</li>
    </ul>

    <p>If you are using <a href="https://demo.thingsboard.io/">live demo</a> server - <a href="/docs/user-guide/ui/devices/#manage-device-credentials">get the access token</a> for pre-provisioned “DHT11 Demo Device”.</p>
  </li>
  <li>dht11.lua - sending temperature and humidity every 10 seconds to thingsboard server via MQTT protocol.</li>
  <li>init.lua - initalization file that contains 
config.lua:</li>
</ul>

<script>
  jqueryUiDefer(initTabs);
  function initTabs() {
    $(function(){$("#lua-scripts").tabs();});
  }
</script>

<div id="lua-scripts">
  <ul>
    <li><a href="#Config">config.lua</a></li>
    <li><a href="#Dht11">dht11.lua</a></li>
    <li><a href="#Init">init.lua</a></li>
  </ul>
  <div id="Config">
    <table class="includecode"><thead><tr><th><a href="https://raw.githubusercontent.com/thingsboard/thingsboard.github.io/master/docs/samples/nodemcu/resources/config.lua" download="resources/config.lua"><code>resources/config.lua</code></a><img src="/images/copycode.svg" style="max-height:24px" onclick="copyCode('resources/config.lua')" title="Copy resources/config.lua to clipboard" /></th></tr></thead>
<tr><td>
<div id="resources/config.lua" class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="n">wifi_mode</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">wifi_ssid</span> <span class="o">=</span> <span class="s2">"YOUR_WIFI_SSID_HERE"</span>
<span class="n">wifi_pass</span> <span class="o">=</span> <span class="s2">"YOUR_WIFI_PASSWORD_HERE"</span>
<span class="n">mqtt_ip</span> <span class="o">=</span> <span class="s2">"YOUR_THINGSBOARD_HOST_OR_IP_HERE"</span>
<span class="n">mqtt_port</span> <span class="o">=</span> <span class="mi">1883</span>
<span class="n">access_token</span> <span class="o">=</span> <span class="s2">"DHT11_DEMO_TOKEN"</span>
</code></pre>
</div>
</td></tr></table>
  </div>
  <div id="Dht11">
    <table class="includecode"><thead><tr><th><a href="https://raw.githubusercontent.com/thingsboard/thingsboard.github.io/master/docs/samples/nodemcu/resources/dht11.lua" download="resources/dht11.lua"><code>resources/dht11.lua</code></a><img src="/images/copycode.svg" style="max-height:24px" onclick="copyCode('resources/dht11.lua')" title="Copy resources/dht11.lua to clipboard" /></th></tr></thead>
<tr><td>
<div id="resources/dht11.lua" class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="c1">-- init mqtt client with keepalive timer 120sec</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">mqtt</span><span class="p">.</span><span class="n">Client</span><span class="p">(</span><span class="s2">"esp8266"</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="n">access_token</span><span class="p">,</span> <span class="s2">"password"</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"Connecting to MQTT broker..."</span><span class="p">)</span>
<span class="n">m</span><span class="p">:</span><span class="n">connect</span><span class="p">(</span><span class="n">mqtt_ip</span><span class="p">,</span> <span class="n">mqtt_port</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="n">client</span><span class="p">)</span> <span class="nb">print</span><span class="p">(</span><span class="s2">"Connected to MQTT!"</span><span class="p">)</span> <span class="k">end</span><span class="p">,</span>
    <span class="k">function</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">reason</span><span class="p">)</span> <span class="nb">print</span><span class="p">(</span><span class="s2">"Could not connect, failed reason: "</span> <span class="o">..</span> <span class="n">reason</span><span class="p">)</span> <span class="k">end</span><span class="p">)</span>

<span class="n">m</span><span class="p">:</span><span class="n">on</span><span class="p">(</span><span class="s2">"offline"</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="n">client</span><span class="p">)</span> <span class="nb">print</span><span class="p">(</span><span class="s2">"MQTT offline"</span><span class="p">)</span> <span class="k">end</span><span class="p">)</span>

<span class="n">pin</span> <span class="o">=</span> <span class="mi">5</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"Collecting Temperature and Humidity..."</span><span class="p">)</span>
<span class="n">tmr</span><span class="p">.</span><span class="n">alarm</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">10000</span><span class="p">,</span> <span class="n">tmr</span><span class="p">.</span><span class="n">ALARM_AUTO</span><span class="p">,</span> <span class="k">function</span><span class="p">()</span>
    <span class="n">status</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">humi</span><span class="p">,</span> <span class="n">temp_dec</span><span class="p">,</span> <span class="n">humi_dec</span> <span class="o">=</span> <span class="n">dht</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">pin</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="n">dht</span><span class="p">.</span><span class="n">OK</span> <span class="k">then</span>
        <span class="c1">-- Integer firmware using this example</span>
        <span class="nb">print</span><span class="p">(</span><span class="nb">string.format</span><span class="p">(</span><span class="s2">"DHT Temperature:%d.%03d;Humidity:%d.%03d\r\n"</span><span class="p">,</span>
            <span class="nb">math.floor</span><span class="p">(</span><span class="n">temp</span><span class="p">),</span>
            <span class="n">temp_dec</span><span class="p">,</span>
            <span class="nb">math.floor</span><span class="p">(</span><span class="n">humi</span><span class="p">),</span>
            <span class="n">humi_dec</span><span class="p">))</span>
        <span class="n">m</span><span class="p">:</span><span class="n">publish</span><span class="p">(</span><span class="s2">"v1/devices/me/telemetry"</span><span class="p">,</span> <span class="nb">string.format</span><span class="p">(</span><span class="s2">"[{\"</span><span class="n">temperature</span><span class="err">\</span><span class="s2">":%d}, {\"</span><span class="n">humidity</span><span class="err">\</span><span class="s2">":%d}]"</span><span class="p">,</span> <span class="nb">math.floor</span><span class="p">(</span><span class="n">temp</span><span class="p">),</span> <span class="nb">math.floor</span><span class="p">(</span><span class="n">humi</span><span class="p">)),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">function</span><span class="p">(</span><span class="n">client</span><span class="p">)</span> <span class="nb">print</span><span class="p">(</span><span class="s2">"Data sent"</span><span class="p">)</span> <span class="k">end</span><span class="p">)</span>
    <span class="k">elseif</span> <span class="n">status</span> <span class="o">==</span> <span class="n">dht</span><span class="p">.</span><span class="n">ERROR_CHECKSUM</span> <span class="k">then</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"DHT Checksum error."</span><span class="p">)</span>
    <span class="k">elseif</span> <span class="n">status</span> <span class="o">==</span> <span class="n">dht</span><span class="p">.</span><span class="n">ERROR_TIMEOUT</span> <span class="k">then</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"DHT timed out."</span><span class="p">)</span>
    <span class="k">end</span>
<span class="k">end</span><span class="p">)</span>
</code></pre>
</div>
</td></tr></table>
  </div>
  <div id="Init">
    <table class="includecode"><thead><tr><th><a href="https://raw.githubusercontent.com/thingsboard/thingsboard.github.io/master/docs/samples/nodemcu/resources/init.lua" download="resources/init.lua"><code>resources/init.lua</code></a><img src="/images/copycode.svg" style="max-height:24px" onclick="copyCode('resources/init.lua')" title="Copy resources/init.lua to clipboard" /></th></tr></thead>
<tr><td>
<div id="resources/init.lua" class="language-lua highlighter-rouge"><pre class="highlight"><code><span class="k">function</span> <span class="nf">startup</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">file</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="s2">"init.lua"</span><span class="p">)</span> <span class="o">==</span> <span class="kc">nil</span> <span class="k">then</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"init.lua deleted"</span><span class="p">)</span>
    <span class="k">else</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"Running"</span><span class="p">)</span>
        <span class="n">file</span><span class="p">.</span><span class="n">close</span><span class="p">(</span><span class="s2">"init.lua"</span><span class="p">)</span>
        <span class="n">tmr</span><span class="p">.</span><span class="n">unregister</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="nb">dofile</span><span class="p">(</span><span class="s2">"dht11.lua"</span><span class="p">)</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="c1">-- setup wifi</span>
<span class="k">function</span> <span class="nf">setup_wifi</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">ssid</span><span class="p">,</span> <span class="n">pass</span><span class="p">)</span>
    <span class="n">wifi</span><span class="p">.</span><span class="n">setmode</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>
    <span class="n">wifi</span><span class="p">.</span><span class="n">sta</span><span class="p">.</span><span class="n">config</span><span class="p">(</span><span class="n">ssid</span><span class="p">,</span> <span class="n">pass</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">end</span>

<span class="c1">--init.lua</span>
<span class="n">wifi</span><span class="p">.</span><span class="n">sta</span><span class="p">.</span><span class="n">disconnect</span><span class="p">()</span>

<span class="k">if</span> <span class="n">file</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">"config.lua"</span><span class="p">)</span> <span class="k">then</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Loading configration from config.lua"</span><span class="p">)</span>
    <span class="nb">dofile</span><span class="p">(</span><span class="s2">"config.lua"</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">setup_wifi</span><span class="p">((</span><span class="n">wifi_mode</span> <span class="ow">or</span> <span class="n">wifi</span><span class="p">.</span><span class="n">AP</span><span class="p">),</span> <span class="p">(</span><span class="n">wifi_ssid</span> <span class="ow">or</span> <span class="s2">"node_esp8266"</span><span class="p">),</span> <span class="p">(</span><span class="n">wifi_pass</span> <span class="ow">or</span> <span class="s2">"_esp8266_"</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"connecting to wifi..."</span><span class="p">)</span>
<span class="n">tmr</span><span class="p">.</span><span class="n">alarm</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">tmr</span><span class="p">.</span><span class="n">ALARM_AUTO</span><span class="p">,</span> <span class="k">function</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">wifi</span><span class="p">.</span><span class="n">sta</span><span class="p">.</span><span class="n">getip</span><span class="p">()</span> <span class="o">==</span> <span class="kc">nil</span> <span class="k">then</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"IP unavaiable, Waiting..."</span><span class="p">)</span>
    <span class="k">else</span>
        <span class="n">tmr</span><span class="p">.</span><span class="n">unregister</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"Config done, IP is "</span> <span class="o">..</span> <span class="n">wifi</span><span class="p">.</span><span class="n">sta</span><span class="p">.</span><span class="n">getip</span><span class="p">())</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"Waiting 10 seconds before startup..."</span><span class="p">)</span>
        <span class="n">tmr</span><span class="p">.</span><span class="n">alarm</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10000</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">startup</span><span class="p">)</span>
    <span class="k">end</span>
<span class="k">end</span><span class="p">)</span>
</code></pre>
</div>
</td></tr></table>
  </div>
</div>

<h3 id="flashing-the-firmware">Flashing the firmware</h3>

<p>Before flashing firmware we need to figure out what serial interface using to communicate with NodeMCU.</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>dmesg
...
<span class="o">[</span>845270.901509] usb 3-3: ch341-uart converter now attached to ttyUSB0
...
</code></pre>
</div>

<p>In our case <strong>/dev/ttyUSB0</strong> is used for communication.</p>

<p>In order to flash firmware for NodeMCU, please download and install following utilities</p>

<ul>
  <li><a href="https://github.com/espressif/esptool">Esptool</a></li>
  <li><a href="https://github.com/4refr0nt/luatool">Luatool</a></li>
</ul>

<p>Upload nodemcu firmware using command:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>sudo ./esptool.py -b 115200 write_flash --flash_mode dio --flash_size 32m 0x0 ~~/samples/nodemcu/nodemcu-firmware/bin/nodemcu_integer_master_<span class="k">*</span>.bin --verify
</code></pre>
</div>

<p>Upload application files using following commands:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>sudo ./luatool.py --port /dev/ttyUSB0 -b 115200 --src config.lua --dest config.lua -v
<span class="gp">$ </span>sudo ./luatool.py --port /dev/ttyUSB0 -b 115200 --src dht11.lua --dest dht11.lua -v
<span class="gp">$ </span>sudo ./luatool.py --port /dev/ttyUSB0 -b 115200 --src init.lua --dest init.lua -v
</code></pre>
</div>

<h3 id="troubleshooting">Troubleshooting</h3>

<p>Sometimes you can observe frequent blinking of the blue led after firmware upload. This is probably related to missing initialization data. Use following command to fix this:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>sudo ./esptool.py -b 115200 write_flash --flash_mode dio --flash_size 32m 0x3fc000 ~/samples/nodemcu/nodemcu-firmware/bin/esp_init_data_default.bin --verify
</code></pre>
</div>

<p>Sometimes you are not able to upload lua files. Try to reset device and executing command again within first 10 seconds after reset. If no success, try to delete init.lua code from NodeMCU:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>sudo ./luatool.py --port /dev/ttyUSB0 -b 115200 --delete init.lua
</code></pre>
</div>

<h2 id="data-visualization">Data visualization</h2>

<p>In order to simplify this guide we have included “Temperature &amp; Humidity Demo Dashboard” to the <a href="/docs/samples/demo-account/">demo data</a> that is available in each Thingsboard installation. 
Of course, you can modify this dashboard: tune, add, delete widgets, etc.
You can access this dashboard by logging in as a tenant administrator. Use</p>

<ul>
  <li>login: tenant@thingsboard.org</li>
  <li>password: tenant</li>
</ul>

<p>in case of local Thingsboard installation.</p>

<p>Once logged in, open <strong>Dashboards-&gt;Temperature &amp; Humidity Demo Dashboard</strong> page. You should observe demo dashboard with live data from your device (similar to dashboard image in the introduction).</p>

<h2 id="next-steps">Next steps</h2>

<p>Browse other <a href="/docs/samples">samples</a> or explore guides related to main Thingsboard features:</p>

<ul>
  <li><a href="/docs/user-guide/attributes/">Device attributes</a> - how to use device attributes.</li>
  <li><a href="/docs/user-guide/telemetry/">Telemetry data collection</a> - how to collect telemetry data.</li>
  <li><a href="/docs/user-guide/rpc/">Using RPC capabilities</a> - how to send commands to/from devices.</li>
  <li><a href="/docs/user-guide/rule-engine/">Rule Engine</a> - how to use rule engine to analyze data from devices.</li>
  <li><a href="/docs/user-guide/visualization/">Data Visualization</a> - how to visualize collected data.</li>
</ul>

<h2 id="your-feedback">Your feedback</h2>

<p>Don’t hesitate to star Thingsboard on <strong><a href="https://github.com/thingsboard/thingsboard">github</a></strong> to help us spread the word.
If you have some questions about this sample - post it on the <strong><a href="https://groups.google.com/forum/#!forum/thingsboard">forum</a></strong>.</p>

<div id="share"></div>
<script>
    jqueryDefer(initSocials);
    function initSocials() {
        var scriptsList = [
            {src: 'https://cdn.jsdelivr.net/jquery.jssocials/1.4.0/jssocials.css', type: 'css'},
            {src: 'https://cdn.jsdelivr.net/jquery.jssocials/1.4.0/jssocials-theme-flat.css', type: 'css'},
            {src: 'https://cdn.jsdelivr.net/jquery.jssocials/1.4.0/jssocials.min.js', type: 'script'}
        ];
        loadNextScript(0, scriptsList,
                function() {
                    $("#share").jsSocials({
                        shares: ["email", "twitter", "facebook", "googleplus", "linkedin", "pinterest", "stumbleupon", "whatsapp", "telegram"],
                        showLabel: false,
                        showCount: false
                    });
                }
        );
    }
</script>


  </div>
</section>

<footer>
	<main class="light-text">
		<nav>
			<a href="/docs/getting-started-guides/helloworld/">Get Started</a>
			<a href="/docs/">Documentation</a>
			<a href="/iot-use-cases/">Use cases</a>
			<a href="https://blog.thingsboard.io/">Blog</a>
			<a href="/docs/services/">Services</a>
			<a href="/docs/contact-us/">Contact us</a>
		</nav>
		<div class="newsletterSubsContainer">
			<form id="newsletter-form" method="post" onsubmit="return validateNewsletterForm(this)">
				<fieldset>
					<div class="newsletterInputs">
						<p class="subsTitle">Sign up for Thingsboard IoT newsletter</p>
						<input id="subsEmail" placeholder="Email" class="text-input" name="email" type="text" size="20" maxlength="80">
						<input type="hidden" name="_next" value="/docs/newsletter-thanks/" />
						<input type="text" name="_gotcha" style="display:none" />
						<input class="button" value="Submit" type="submit">
					</div>
				</fieldset>
			</form>
		</div>
		<div class="center">
			<div class="social">
				<div>
					<a href="https://twitter.com/thingsboard" class="twitter"><span>twitter</span></a>
					<a href="https://github.com/thingsboard/thingsboard" class="github"><span>Github</span></a>
					<a href="https://gitter.im/thingsboard/chat" class="gitter"><span>Gitter</span></a>
					<a href="http://stackoverflow.com/questions/tagged/thingsboard" class="stack-overflow"><span>Stack Overflow</span></a>
				</div>
				<div>
					<a href="https://groups.google.com/forum/#!forum/thingsboard" class="mailing-list"><span>Mailing List</span></a>
					<a href="https://www.youtube.com/channel/UCDb9fsV-YR4JmnipAMGsVAQ" class="youtube"><span>YouTube Channel</span></a>
					<a href="https://www.facebook.com/thingsboard" class="facebook"><span>Facebook Page</span></a>
				</div>
			</div>
		</div>
		<div id="miceType" class="center">&copy; 2017 The Thingsboard Authors</div>
	</main>

	<script type="text/javascript">

		function validateNewsletterForm(form) {
			var email = $('input[name=email]', form).val();

			if (!validateValue('Email Address', email)) {
				return false;
			}

			var emailExp = /^[a-zA-Z0-9._%-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;
			if(email.match(emailExp)==null) {
				window.alert("Entered Email Address is not valid.");
				return false;
			}
			return true;
		}

		function validateValue(name, val) {
			if (isEmpty(val)) {
				window.alert("Please fill '" + name + "' field.");
				return false;
			}
			return true;
		}

		function isEmpty(val) {
			return val === undefined || val.trim().length == 0;
		}

	</script>

	<script type="text/javascript">

		var newsletterform =  document.getElementById('newsletter-form');
		newsletterform.setAttribute('action', 'https://formspree.io/' + 'newsletter' + '@' + 'thingsboard' + '.' + 'io');

	</script>

</footer>



<button class="flyout-button" onclick="tb.toggleToc()"></button>


<style>
  .cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
  }
  .gsc-control-cse table, .gsc-control-cse-en table {
    margin:0px !important;
  }
  .gsc-above-wrapper-area {
    border-bottom: 0;
  }
</style>
</body>
</html>
