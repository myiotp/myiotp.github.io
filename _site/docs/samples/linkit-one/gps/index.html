

<!Doctype html>
<html id="docs" class="Samples">



<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	
	<!-- Begin Jekyll SEO tag v2.0.0 -->
<title>GPS data upload and visualization using LinkIt ONE and Thingsboard - Thingsboard</title>
<meta property="og:title" content="GPS data upload and visualization using LinkIt ONE and Thingsboard" />
<meta name="description" content="Thingsboard IoT Platform sample for GPS data upload and visualization using LinkIt ONE" />
<meta property="og:description" content="Thingsboard IoT Platform sample for GPS data upload and visualization using LinkIt ONE" />
<link rel="canonical" href="http://localhost:4000/docs/samples/linkit-one/gps/" />
<meta property="og:url" content="http://localhost:4000/docs/samples/linkit-one/gps/" />
<meta property="og:site_name" content="Thingsboard" />
<meta property="og:image" content="http://localhost:4000/images/thingsboard_logo.png" />
<meta name="twitter:image" content="http://localhost:4000/images/thingsboard_logo.png" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="@thingsboard" />
<meta name="twitter:creator" content="@thingsboard" />
<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "WebPage",
    "headline": "GPS data upload and visualization using LinkIt ONE and Thingsboard",
    "image": "http://localhost:4000/images/thingsboard_logo.png",
    "description": "Thingsboard IoT Platform sample for GPS data upload and visualization using LinkIt ONE",
    "logo": "http://localhost:4000/images/thingsboard_logo.png",
    "url": "http://localhost:4000/docs/samples/linkit-one/gps/"
  }
</script>
<!-- End Jekyll SEO tag -->
	
	
	<meta name="twitter:description" content="Thingsboard IoT Platform sample for GPS data upload and visualization using LinkIt ONE"/>
	
	
	<link rel="shortcut icon" type="image/png" href="/images/favicon.png">
	<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700" rel="stylesheet">
	<link rel="stylesheet" href="/css/styles.css">
	<script type="text/javascript">
		/*! loadCSS. [c]2017 Filament Group, Inc. MIT License */
		!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);
		/*! onloadCSS. (onload callback for loadCSS) [c]2017 Filament Group, Inc. MIT License */
		function onloadCSS(a,b){function c(){!d&&b&&(d=!0,b.call(a))}var d;a.addEventListener&&a.addEventListener("load",c),a.attachEvent&&a.attachEvent("onload",c),"isApplicationInstalled"in navigator&&"onloadcssdefined"in a&&a.onloadcssdefined(c)}
	</script>
	<script type="text/javascript">

		function jqueryDefer(method) {
			if (window.jQuery) {
				method();
			} else {
				setTimeout(function() {
					jqueryDefer(method)
				}, 50);
			}
		}

		function jqueryUiDefer(method) {
			if (window.jQuery && window.jQuery.ui) {
				method();
			} else {
				setTimeout(function() {
					jqueryUiDefer(method)
				}, 50);
			}
		}

		function loadScript(src, callback)
		{
			var s, r, t;
			r = false;
			s = document.createElement('script');
			s.type = 'text/javascript';
			s.src = src;
			s.onload = s.onreadystatechange = function() {
				if ( !r && (!this.readyState || this.readyState == 'complete') )
				{
					r = true;
					if (callback) {
						callback();
					}
				}
			};
			t = document.getElementsByTagName('script')[0];
			t.parentNode.insertBefore(s, t);
		}

		function loadCssAsync(src, callback) {
			var stylesheet = loadCSS( src );
			if (callback) {
				onloadCSS(stylesheet, callback);
			}
		}

		function loadNextScript(index, scriptsList, completeCallback) {
			if (index < scriptsList.length) {
				var script = scriptsList[index];
				if (script.type === 'script') {
					loadScript(script.src, function() {
						index++;
						loadNextScript(index, scriptsList, completeCallback);
					});
				} else if (script.type === 'css') {
					loadCssAsync(script.src, function() {
						index++;
						loadNextScript(index, scriptsList, completeCallback);
					});
				}
			} else if (completeCallback) {
				completeCallback();
			}
		}

		var initialScriptsList = [
			{src: '/js/jquery-2.2.0.min.js', type: 'script'},
			{src: '/css/jquery-ui.min.css', type: 'css'},
			{src: '/js/jquery-ui.min.js', type: 'script'},
			{src: '/js/script.js', type: 'script'},
			{src: '/css/sweetalert.css', type: 'css'},
			{src: '/js/sweetalert.min.js', type: 'script'}
		];

		loadNextScript(0, initialScriptsList);

	</script>
	<script type="text/javascript">
		function _gaLt(event) {
			/* If GA is blocked or not loaded, or not main|middle|touch click then don't track */
			if (!ga.hasOwnProperty("loaded") || ga.loaded != true || (event.which != 1 && event.which != 2)) {
				return;
			}
			var el = event.srcElement || event.target;

			while (el && (typeof el.tagName == 'undefined' || el.tagName.toLowerCase() != 'a' || !el.href)) {
				el = el.parentNode;
			}
			if (el && el.href) {
				var link = el.href;
				if ((link.indexOf(location.host) == -1 || link.indexOf('.' + location.host) > 0) && !link.match(/^javascript\:/i)) {
					var target = (el.target && !el.target.match(/^_(self|parent|top)$/i)) ? el.target : false;
					if (event.ctrlKey || event.shiftKey || event.metaKey || event.which == 2) {
						target = "_blank";
					}

					var hbrun = false; // tracker has not yet run
					var hitBack = function() {
						if (hbrun) return;
						hbrun = true;
						window.location.href = link;
					};

					if (target) {
						ga(
								"send", "event", "Outgoing Links", link,
								document.location.pathname + document.location.search
						);
					} else {
						event.preventDefault ? event.preventDefault() : event.returnValue = !1;
						ga(
								"send", "event", "Outgoing Links", link,
								document.location.pathname + document.location.search, {
									"hitCallback": hitBack
								}
						);

						setTimeout(hitBack, 1000);
					}
				}
			}
		}

		var _w = window;
		var _gaLtEvt = ("ontouchstart" in _w) ? "click" : "mousedown";
		_w.addEventListener ? _w.addEventListener("load", function() {document.body.addEventListener(_gaLtEvt, _gaLt, !1)}, !1)
				: _w.attachEvent && _w.attachEvent("onload", function() {document.body.attachEvent("on" + _gaLtEvt, _gaLt)});
	</script>
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
					(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
				m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-88383331-1', 'auto');
		ga('send', 'pageview');
	</script>
</head>
<body>
<div id="cellophane" onclick="tb.toggleMenu()"></div>
<header>
	<a href="/" class="logo"></a>
	<div id="githubButtonContainer">
		<iframe id="gh-btn-frame" src="https://ghbtns.com/github-btn.html?user=thingsboard&repo=thingsboard&type=star&count=true&size=large"
				frameborder="0"
				scrolling="0" width="130px" height="30px"></iframe>
	</div>
	<div class="nav-buttons" data-auto-burger="primary">
		<a href="/docs/" class="button" id="viewDocs" data-auto-burger-exclude>View Documentation</a>
		<a href="/iot-use-cases/" class="button" id="useCases" data-auto-burger-exclude>Use cases</a>
		<a href="/docs/getting-started-guides/helloworld/" class="button" id="gettingStarted" data-auto-burger-exclude>Getting started</a>
		<a target="_blank" href="https://demo.thingsboard.io/signup" class="button" id="liveDemo" data-auto-burger-exclude>Live demo</a>
		<button id="hamburger" onclick="tb.toggleMenu()" data-auto-burger-exclude><div></div></button>
	</div>

	<nav id="mainNav">
		<main id="headNav" data-auto-burger="primary">
			<div class="nav-box">
				<h3><a href="/docs/getting-started-guides/helloworld/">Get Started</a></h3>
			</div>
			<div class="nav-box">
				<h3><a href="/docs/">Documentation</a></h3>
			</div>
			<div class="nav-box">
				<h3><a href="/iot-use-cases/">Use cases</a></h3>
			</div>
			<div class="nav-box">
				<h3><a href="http://blog.thingsboard.io/">Blog</a></h3>
			</div>
			<div class="nav-box">
				<h3><a href="/docs/services/">Services</a></h3>
			</div>
			<div class="nav-box">
				<h3><a href="/docs/contact-us/">Contact us</a></h3>
			</div>
		</main>
		<main data-auto-burger="primary">
			<div class="center">
				<div class="social">
					<a href="https://twitter.com/thingsboard" class="twitter"><span>Twitter</span></a>
					<a href="https://github.com/thingsboard/thingsboard" class="github"><span>Github</span></a>
					<a href="https://gitter.im/thingsboard/chat" class="gitter"><span>Gitter</span></a>
					<a href="http://stackoverflow.com/questions/tagged/thingsboard" class="stack-overflow"><span>Stack Overflow</span></a>
					<a href="https://groups.google.com/forum/#!forum/thingsboard" class="mailing-list"><span>Mailing List</span></a>
					<a href="https://www.youtube.com/channel/UCDb9fsV-YR4JmnipAMGsVAQ" class="youtube"><span>YouTube Channel</span></a>
					<a href="https://www.facebook.com/thingsboard" class="facebook"><span>Facebook Page</span></a>
				</div>
			</div>
			<div class="clear" style="clear: both"></div>
		</main>
	</nav>
</header>


<!--  HERO  -->
<section id="hero" class="light-text">
  <h1>Samples</h1>
  <h5>A collection of example applications that show how to use Thingsboard.</h5>
  <div id="vendorStrip" class="light-text">
    <div id="docsList">
        <ul>
          <li><a href="/docs/" >DOCS HOME</a></li>
          <li><a href="/docs/api/" >API</a></li>
          <li><a href="/docs/iot-gateway/" >IOT GATEWAY</a></li>
          <li><a href="/docs/reference/" >REFERENCE</a></li>
          <li><a href="/docs/samples/" class="YAH">SAMPLES</a></li>
          <li><a href="/iot-use-cases/" >USE CASES</a></li>
          <li><a href="/docs/iot-video-tutorials/" >VIDEO TUTORIALS</a></li>
          <li><a href="/docs/faq/" >FAQ</a></li>
          <li><a href="/docs/services/" >SERVICES</a></li>
          <li><a href="/docs/contact-us/" >CONTACT US</a></li>
        </ul>
    </div>
    <div id="searchBox">
      <input type="text" id="search" placeholder="Search" onkeydown="if (event.keyCode==13) window.location.replace('/docs/search/?q=' + this.value)">
    </div>
  </div>
</section>





<section id="encyclopedia">
  
  <div id="docsToc" >
        <div class="pi-accordion">
        
    <a class="item" data-title="Samples" href="/docs/samples/"></a>
    <a class="item" data-title="Live Demo Server" href="/docs/user-guide/live-demo/"></a>
    <a class="item" data-title="Local Demo Account" href="/docs/samples/demo-account/"></a>
<div class="item" data-title="Hardware samples">
  <div class="container">
<div class="item" data-title="Arduino">
  <div class="container">
    <a class="item" data-title="Arduino overview" href="/docs/samples/arduino/"></a>
    <a class="item" data-title="Temperature upload over MQTT using Arduino UNO, ESP8266 and DHT22 sensor" href="/docs/samples/arduino/temperature/"></a>
  </div>
</div>
<div class="item" data-title="ESP8266">
  <div class="container">
    <a class="item" data-title="ESP8266 overview" href="/docs/samples/esp8266/"></a>
    <a class="item" data-title="Temperature upload over MQTT using ESP8266 and DHT22 sensor" href="/docs/samples/esp8266/temperature/"></a>
    <a class="item" data-title="ESP8266 GPIO control over MQTT using Thingsboard" href="/docs/samples/esp8266/gpio/"></a>
  </div>
</div>
<div class="item" data-title="NodeMCU">
  <div class="container">
    <a class="item" data-title="NodeMCU overview" href="/docs/samples/nodemcu/"></a>
    <a class="item" data-title="Temperature upload over MQTT using NodeMCU and DHT11 sensor" href="/docs/samples/nodemcu/temperature/"></a>
  </div>
</div>
<div class="item" data-title="Raspberry Pi">
  <div class="container">
    <a class="item" data-title="Raspberry Pi overview" href="/docs/samples/raspberry/"></a>
    <a class="item" data-title="Raspberry Pi GPIO control over MQTT using Thingsboard" href="/docs/samples/raspberry/gpio/"></a>
    <a class="item" data-title="Raspberry Pi GPIO control using Android Things and Thingsboard" href="/docs/samples/raspberry/gpio-android-things/"></a>
    <a class="item" data-title="Temperature upload over MQTT using Raspberry Pi and DHT22 sensor" href="/docs/samples/raspberry/temperature/"></a>
  </div>
</div>
<div class="item" data-title="LinkIt ONE">
  <div class="container">
    <a class="item" data-title="LinkIt ONE overview" href="/docs/samples/linkit-one/"></a>
    <a class="item" data-title="GPS data upload and visualization using LinkIt ONE and Thingsboard" href="/docs/samples/linkit-one/gps/"></a>
  </div>
</div>
  </div>
</div>
<div class="item" data-title="Tutorials">
  <div class="container">
<div class="item" data-title="Alarms">
  <div class="container">
    <a class="item" data-title="Sending Alarms using Email Plugin" href="/docs/samples/alarms/mail/"></a>
    <a class="item" data-title="Alarms based on devices attributes and sensor readings" href="/docs/samples/alarms/basic-rules/"></a>
  </div>
</div>
    <a class="item" data-title="Facilities Monitoring PoC" href="/docs/samples/monitoring/facilities-monitoring-poc/"></a>
  </div>
</div>
        </div> <!-- /pi-accordion -->
    <button class="push-menu-close-button" onclick="tb.toggleToc()"></button>
  </div> <!-- /docsToc -->
  
  <div id="docsContent" class="">
    <h1>GPS data upload and visualization using LinkIt ONE and Thingsboard</h1>
    <ul id="markdown-toc">
  <li><a href="#introduction" id="markdown-toc-introduction">Introduction</a></li>
  <li><a href="#prerequisites" id="markdown-toc-prerequisites">Prerequisites</a></li>
  <li><a href="#list-of-hardware" id="markdown-toc-list-of-hardware">List of hardware</a></li>
  <li><a href="#thingsboard-configuration" id="markdown-toc-thingsboard-configuration">Thingsboard configuration</a>    <ul>
      <li><a href="#provision-your-device" id="markdown-toc-provision-your-device">Provision your device</a></li>
      <li><a href="#provision-your-dashboard" id="markdown-toc-provision-your-dashboard">Provision your dashboard</a></li>
    </ul>
  </li>
  <li><a href="#programming-the-linkit-one-device" id="markdown-toc-programming-the-linkit-one-device">Programming the LinkIt One device</a>    <ul>
      <li><a href="#step-1-linkit-one-and-arduino-ide-setup" id="markdown-toc-step-1-linkit-one-and-arduino-ide-setup">Step 1. LinkIt ONE and Arduino IDE setup.</a></li>
      <li><a href="#step-2-pubsubclient-library-installation" id="markdown-toc-step-2-pubsubclient-library-installation">Step 2. PubSubClient library installation.</a></li>
    </ul>
  </li>
  <li><a href="#troubleshooting" id="markdown-toc-troubleshooting">Troubleshooting</a></li>
  <li><a href="#data-visualization" id="markdown-toc-data-visualization">Data visualization</a></li>
  <li><a href="#next-steps" id="markdown-toc-next-steps">Next steps</a></li>
  <li><a href="#your-feedback" id="markdown-toc-your-feedback">Your feedback</a></li>
</ul>

<h2 id="introduction">Introduction</h2>
<p>Thingsboard is an open-source server-side platform that allows you to monitor and control IoT devices. 
It is free for both personal and commercial usage and you can deploy it anywhere. 
If this is your first experience with the platform we recommend to review 
<a href="/docs/getting-started-guides/what-is-thingsboard/">what-is-thingsboard</a> page and <a href="/docs/getting-started-guides/helloworld/">getting-started</a> guide.</p>

<p>This sample application shows capability to track GPS location of LinkIt ONE device and further visualization on the map. 
It performs collection of latitude and longitude values produced by GPS module. 
Collected data is pushed to Thingsboard for storage and visualization. 
The purpose of this application is to demonstrate Thingsboard data collection API and visualization capabilities.</p>

<p>The GPS module is built-in module of <a href="http://wiki.seeed.cc/LinkIt_ONE/">LinkIt ONE</a>. 
LinkIt ONE pushes data to Thingsboard server via MQTT protocol by using <a href="https://github.com/knolleary/pubsubclient">PubSubClient</a> library for Arduino. 
Data is visualized using map widget which is part of customizable dashboard. 
The application that is running on LinkIt ONE is written using Arduino SDK which is quite simple and easy to understand.</p>

<p>Once you complete this sample/tutorial, you will see your device GPS and battery data on the following dashboard.</p>

<p><img src="/images/samples/linkit-one/gps/dashboard.png" alt="image" /></p>

<h2 id="prerequisites">Prerequisites</h2>

<p>You will need to Thingsboard server up and running. Use either <a href="https://demo.thingsboard.io/signup">Live Demo</a> or 
<a href="/docs/user-guide/install/installation-options/">Installation Guide</a> to install Thingsboard.</p>

<p>This tutorial was prepared for Windows OS users. However it is possible to run it on other OS (Linux or MacOS).</p>

<h2 id="list-of-hardware">List of hardware</h2>

<ul>
  <li>
    <p><a href="https://www.seeedstudio.com/LinkIt-ONE-p-2017.html">LinkIt One</a></p>

    <p>GPS and WIFI Antenna are shipped with board.</p>
  </li>
</ul>

<h2 id="thingsboard-configuration">Thingsboard configuration</h2>

<p><strong>Note</strong> Thingsboard configuration steps are necessary only in case of <strong>local Thingsboard installation</strong>.
If you are using <a href="https://demo.thingsboard.io/"><strong>Live Demo</strong></a> instance all entities are pre-configured for your demo account.
However, we recommend to review this steps because you will still need to get device access token to send requests to Thingsboard.</p>

<h3 id="provision-your-device">Provision your device</h3>

<p>This step contains instructions that are necessary to connect your device to Thingsboard.</p>

<p>Open Thingsboard Web UI (http://localhost:8080) in browser and login as tenant administrator</p>

<ul>
  <li>login: tenant@thingsboard.org</li>
  <li>password: tenant</li>
</ul>

<p>Goto “Devices” section. Click “+” button and create device with name “LinkIt One Demo Device”.</p>

<p><img src="/images/samples/linkit-one/gps/device.png" alt="image" /></p>

<p>Once device created, open its details and click “Manage credentials”.</p>

<p>Copy auto-generated access token from the “Access token” field. Please save this device token. It will be referred to later as <strong>$ACCESS_TOKEN</strong>.</p>

<p><img src="/images/samples/linkit-one/gps/credentials.png" alt="image" /></p>

<p>Click “Copy Device ID” in device details to copy your device id to clipboard.
Paste your device id to some place, this value will be used in further steps.</p>

<h3 id="provision-your-dashboard">Provision your dashboard</h3>

<p>Download the dashboard file using this <a href="/docs/samples/linkit-one/resources/linkit_one_gps_dashboard_v2.json"><strong>link</strong></a>. 
Use import/export <a href="/docs/user-guide/ui/dashboards/#dashboard-importexport"><strong>instructions</strong></a> to import the dashboard to your Thingsboard instance.</p>

<h2 id="programming-the-linkit-one-device">Programming the LinkIt One device</h2>

<p>If you already familiar with basics of LinkIt One programming using Arduino IDE you can skip the following step and proceed with step 2.</p>

<h3 id="step-1-linkit-one-and-arduino-ide-setup">Step 1. LinkIt ONE and Arduino IDE setup.</h3>
<p>In order to start programming LinkIt One device you will need Arduino IDE installed and all related libraries. Please follow this <a href="http://labs.mediatek.com/site/global/developer_tools/mediatek_linkit/get-started/windows_os_stream/install/index.gsp">guide</a> in order to install the Arduino IDE and LinkIt One SDK:</p>

<p>It’s recommended to update your firmware by following <a href="http://labs.mediatek.com/site/global/developer_tools/mediatek_linkit/get-started/windows_os_stream/update_firmware/index.gsp">this guide</a>.
To try your first LinkIt One sample, please follow <a href="http://labs.mediatek.com/site/global/developer_tools/mediatek_linkit/get-started/windows_os_stream/configure/index.gsp">this guide</a>.</p>

<h3 id="step-2-pubsubclient-library-installation">Step 2. PubSubClient library installation.</h3>

<p>Open Arduino IDE and go to <strong>Sketch -&gt; Include Library -&gt; Manage Libraries</strong>. Find PubSubClient by Nick O’Leary and install it.</p>

<p><strong>Note</strong> that this tutorial was tested with PubSubClient 2.6.</p>

<p>Download and open <strong>gps_tracker.ino</strong> sketch.</p>

<p><strong>Note</strong> You need to edit following constants and variables in the sketch:</p>

<ul>
  <li>WIFI_AP - name of your access point</li>
  <li>WIFI_PASSWORD - access point password</li>
  <li>WIFI_AUTH - choose one of LWIFI_OPEN, LWIFI_WPA, or LWIFI_WEP.</li>
  <li>TOKEN - the <strong>$ACCESS_TOKEN</strong> from Thingsboard configuration step.</li>
  <li>thingsboardServer - Thingsboard HOST/IP address that is accessable within your wifi network. Specify “demo.thingsboard.io” if you are using <a href="https://demo.thingsboard.io/">live demo</a> server.</li>
</ul>

<script>
  jqueryUiDefer(initTabs);
  function initTabs() {
    $(function(){$("#gps-arduino").tabs();});
  }
</script>

<div id="gps-arduino">
  <ul>
    <li><a href="#gps">gps_tracker.ino</a></li>
  </ul>
  <div id="gps">
    <table class="includecode"><thead><tr><th><a href="https://raw.githubusercontent.com/thingsboard/thingsboard.github.io/master/docs/samples/linkit-one/resources/gps_tracker.ino" download="resources/gps_tracker.ino"><code>resources/gps_tracker.ino</code></a><img src="/images/copycode.svg" style="max-height:24px" onclick="copyCode('resources/gps_tracker.ino')" title="Copy resources/gps_tracker.ino to clipboard" /></th></tr></thead>
<tr><td>
<div id="resources/gps_tracker.ino" class="language-c highlighter-rouge"><pre class="highlight"><code><span class="cp">#include &lt;PubSubClient.h&gt;
</span>
<span class="cp">#include &lt;LWiFi.h&gt;
#include &lt;LWiFiClient.h&gt;
#include &lt;LGPS.h&gt;
#include &lt;LBattery.h&gt;
</span>
<span class="cp">#define WIFI_AP "YOUR_WIFI_AP"
#define WIFI_PASSWORD "YOUR_WIFI_PASSWORD"
#define WIFI_AUTH LWIFI_WPA  // choose from LWIFI_OPEN, LWIFI_WPA, or LWIFI_WEP.
</span>
<span class="cp">#define TOKEN "YOUR_ACCESS_TOKEN"
</span>
<span class="n">gpsSentenceInfoStruct</span> <span class="n">gpsInfo</span><span class="p">;</span>

<span class="kt">char</span> <span class="n">thingsboardServer</span><span class="p">[]</span> <span class="o">=</span> <span class="s">"YOUR_THINGSBOARD_HOST_OR_IP"</span><span class="p">;</span>

<span class="n">LWiFiClient</span> <span class="n">wifiClient</span><span class="p">;</span>

<span class="n">PubSubClient</span> <span class="n">client</span><span class="p">(</span> <span class="n">wifiClient</span> <span class="p">);</span>

<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">lastSend</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span>
  <span class="n">LGPS</span><span class="p">.</span><span class="n">powerOn</span><span class="p">();</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"GPS started."</span><span class="p">);</span>
  <span class="n">InitLWiFi</span><span class="p">();</span>
  <span class="n">client</span><span class="p">.</span><span class="n">setServer</span><span class="p">(</span> <span class="n">thingsboardServer</span><span class="p">,</span> <span class="mi">1883</span> <span class="p">);</span>
  <span class="n">lastSend</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">LWifiStatus</span> <span class="n">ws</span> <span class="o">=</span> <span class="n">LWiFi</span><span class="p">.</span><span class="n">status</span><span class="p">();</span>
  <span class="n">boolean</span> <span class="n">status</span> <span class="o">=</span> <span class="n">wifi_status</span><span class="p">(</span><span class="n">ws</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">status</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Connecting to AP ..."</span><span class="p">);</span>
    <span class="k">while</span> <span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="n">LWiFi</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="n">WIFI_AP</span><span class="p">,</span> <span class="n">LWiFiLoginInfo</span><span class="p">(</span><span class="n">WIFI_AUTH</span><span class="p">,</span> <span class="n">WIFI_PASSWORD</span><span class="p">)))</span>
    <span class="p">{</span>
      <span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Connected to AP"</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">client</span><span class="p">.</span><span class="n">connected</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>
    <span class="n">reconnect</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span> <span class="n">millis</span><span class="p">()</span> <span class="o">-</span> <span class="n">lastSend</span> <span class="o">&gt;</span> <span class="mi">1000</span> <span class="p">)</span> <span class="p">{</span> <span class="c1">// Update and send only after 1 seconds
</span>    <span class="n">getAndSendGPSData</span><span class="p">();</span>
    <span class="n">lastSend</span> <span class="o">=</span> <span class="n">millis</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="n">client</span><span class="p">.</span><span class="n">loop</span><span class="p">();</span>

<span class="p">}</span>

<span class="kt">void</span> <span class="nf">getAndSendGPSData</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Collecting GPS data."</span><span class="p">);</span>
  <span class="n">LGPS</span><span class="p">.</span><span class="n">getData</span><span class="p">(</span><span class="o">&amp;</span><span class="n">gpsInfo</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">((</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">gpsInfo</span><span class="p">.</span><span class="n">GPGGA</span><span class="p">);</span>

  <span class="kt">char</span> <span class="n">latitude</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span>
  <span class="kt">char</span> <span class="n">lat_direction</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
  <span class="kt">char</span> <span class="n">longitude</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span>
  <span class="kt">char</span> <span class="n">lon_direction</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
  <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span>
  <span class="kt">char</span> <span class="n">time</span><span class="p">[</span><span class="mi">30</span><span class="p">];</span>

  <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">gpsInfo</span><span class="p">.</span><span class="n">GPGGA</span><span class="p">;</span>

  <span class="n">p</span> <span class="o">=</span> <span class="n">nextToken</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> <span class="c1">// GGA
</span>  <span class="n">p</span> <span class="o">=</span> <span class="n">nextToken</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">time</span><span class="p">);</span> <span class="c1">// Time
</span>  <span class="n">p</span> <span class="o">=</span> <span class="n">nextToken</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">latitude</span><span class="p">);</span> <span class="c1">// Latitude
</span>  <span class="n">p</span> <span class="o">=</span> <span class="n">nextToken</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">lat_direction</span><span class="p">);</span> <span class="c1">// N or S?
</span>  <span class="n">p</span> <span class="o">=</span> <span class="n">nextToken</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">longitude</span><span class="p">);</span> <span class="c1">// Longitude
</span>  <span class="n">p</span> <span class="o">=</span> <span class="n">nextToken</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">lon_direction</span><span class="p">);</span> <span class="c1">// E or W?
</span>  <span class="n">p</span> <span class="o">=</span> <span class="n">nextToken</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span> <span class="c1">// fix quality
</span>
  <span class="k">const</span> <span class="kt">int</span> <span class="n">coord_size</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
  <span class="kt">char</span> <span class="n">lat_fixed</span><span class="p">[</span><span class="n">coord_size</span><span class="p">],</span> <span class="n">lon_fixed</span><span class="p">[</span><span class="n">coord_size</span><span class="p">];</span>
  <span class="n">convertCoords</span><span class="p">(</span><span class="n">latitude</span><span class="p">,</span> <span class="n">longitude</span><span class="p">,</span> <span class="n">lat_direction</span><span class="p">,</span> <span class="n">lon_direction</span><span class="p">,</span> <span class="n">lat_fixed</span><span class="p">,</span> <span class="n">lon_fixed</span><span class="p">,</span> <span class="n">coord_size</span><span class="p">);</span>

  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Latitude:"</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">lat_fixed</span><span class="p">);</span>

  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Longitude:"</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">lon_fixed</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'1'</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="c1">// GPS fix
</span>    <span class="n">p</span> <span class="o">=</span> <span class="n">nextToken</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">buf</span><span class="p">);</span> <span class="c1">// number of satellites
</span>    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"GPS is fixed:"</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">atoi</span><span class="p">(</span><span class="n">buf</span><span class="p">));</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">" satellite(s) found!"</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">else</span>
  <span class="p">{</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"GPS is not fixed yet."</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="c1">// Obtain battery level
</span>  <span class="n">String</span> <span class="n">batteryLevel</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="n">LBattery</span><span class="p">.</span><span class="n">level</span><span class="p">());</span>
  <span class="n">String</span> <span class="n">batteryCharging</span> <span class="o">=</span> <span class="n">LBattery</span><span class="p">.</span><span class="n">isCharging</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">?</span> <span class="s">"true"</span> <span class="o">:</span> <span class="s">"false"</span><span class="p">;</span>

  <span class="c1">// Just debug messages
</span>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span> <span class="s">"Sending gps location and battery level: ["</span> <span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span> <span class="n">lat_fixed</span> <span class="p">);</span> <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span> <span class="n">lon_fixed</span> <span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">" Battery level: "</span><span class="p">);</span> <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span> <span class="n">batteryLevel</span> <span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">" Battery charging: "</span><span class="p">);</span> <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span> <span class="n">batteryCharging</span> <span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span> <span class="s">"]   -&gt; "</span> <span class="p">);</span>

  <span class="c1">// Prepare a JSON payload string
</span>  <span class="n">String</span> <span class="n">payload</span> <span class="o">=</span> <span class="s">"{"</span><span class="p">;</span>
  <span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\"</span><span class="s">latitude</span><span class="se">\"</span><span class="s">:"</span><span class="p">;</span> <span class="n">payload</span> <span class="o">+=</span> <span class="n">lat_fixed</span><span class="p">;</span> <span class="n">payload</span> <span class="o">+=</span> <span class="s">", "</span><span class="p">;</span>
  <span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\"</span><span class="s">longitude</span><span class="se">\"</span><span class="s">:"</span><span class="p">;</span> <span class="n">payload</span> <span class="o">+=</span> <span class="n">lon_fixed</span><span class="p">;</span> <span class="n">payload</span> <span class="o">+=</span> <span class="s">", "</span><span class="p">;</span>
  <span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\"</span><span class="s">batteryLevel</span><span class="se">\"</span><span class="s">:"</span><span class="p">;</span> <span class="n">payload</span> <span class="o">+=</span> <span class="n">batteryLevel</span><span class="p">;</span>  <span class="n">payload</span> <span class="o">+=</span> <span class="s">", "</span><span class="p">;</span>
  <span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\"</span><span class="s">batteryCharging</span><span class="se">\"</span><span class="s">:"</span><span class="p">;</span> <span class="n">payload</span> <span class="o">+=</span> <span class="n">batteryCharging</span><span class="p">;</span>
  <span class="n">payload</span> <span class="o">+=</span> <span class="s">"}"</span><span class="p">;</span>

  <span class="c1">// Send payload
</span>  <span class="kt">char</span> <span class="n">attributes</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
  <span class="n">payload</span><span class="p">.</span><span class="n">toCharArray</span><span class="p">(</span> <span class="n">attributes</span><span class="p">,</span> <span class="mi">100</span> <span class="p">);</span>
  <span class="n">client</span><span class="p">.</span><span class="n">publish</span><span class="p">(</span> <span class="s">"v1/devices/me/attributes"</span><span class="p">,</span> <span class="n">attributes</span> <span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span> <span class="n">attributes</span> <span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">InitLWiFi</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">LWiFi</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
  <span class="c1">// Keep retrying until connected to AP
</span>  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Connecting to AP ..."</span><span class="p">);</span>
  <span class="k">while</span> <span class="p">(</span><span class="mi">0</span> <span class="o">==</span> <span class="n">LWiFi</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="n">WIFI_AP</span><span class="p">,</span> <span class="n">LWiFiLoginInfo</span><span class="p">(</span><span class="n">WIFI_AUTH</span><span class="p">,</span> <span class="n">WIFI_PASSWORD</span><span class="p">)))</span> <span class="p">{</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Connected to AP"</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">reconnect</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Loop until we're reconnected
</span>  <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">client</span><span class="p">.</span><span class="n">connected</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Connecting to Thingsboard node ..."</span><span class="p">);</span>
    <span class="c1">// Attempt to connect (clientId, username, password)
</span>    <span class="k">if</span> <span class="p">(</span> <span class="n">client</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="s">"LinkIt One Device"</span><span class="p">,</span> <span class="n">TOKEN</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
      <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span> <span class="s">"[DONE]"</span> <span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span> <span class="s">"[FAILED] [ rc = "</span> <span class="p">);</span>
      <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span> <span class="n">client</span><span class="p">.</span><span class="n">state</span><span class="p">()</span> <span class="p">);</span>
      <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span> <span class="s">" : retrying in 5 seconds]"</span> <span class="p">);</span>
      <span class="c1">// Wait 5 seconds before retrying
</span>      <span class="n">delay</span><span class="p">(</span> <span class="mi">5000</span> <span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">convertCoords</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">latitude</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">longitude</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">lat_direction</span><span class="p">,</span>
                   <span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">lon_direction</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">lat_return</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">lon_return</span><span class="p">,</span> <span class="kt">int</span> <span class="n">buff_length</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">char</span> <span class="n">lat_deg</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>

  <span class="c1">// extract the first 2 chars to get the latitudinal degrees
</span>  <span class="n">strncpy</span><span class="p">(</span><span class="n">lat_deg</span><span class="p">,</span> <span class="n">latitude</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

  <span class="c1">// null terminate
</span>  <span class="n">lat_deg</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="kt">char</span> <span class="n">lon_deg</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>

  <span class="c1">// extract first 3 chars to get the longitudinal degrees
</span>  <span class="n">strncpy</span><span class="p">(</span><span class="n">lon_deg</span><span class="p">,</span> <span class="n">longitude</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

  <span class="c1">// null terminate
</span>  <span class="n">lon_deg</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="c1">// convert to integer from char array
</span>  <span class="kt">int</span> <span class="n">lat_deg_int</span> <span class="o">=</span> <span class="n">arrayToInt</span><span class="p">(</span><span class="n">lat_deg</span><span class="p">);</span>
  <span class="kt">int</span> <span class="n">lon_deg_int</span> <span class="o">=</span> <span class="n">arrayToInt</span><span class="p">(</span><span class="n">lon_deg</span><span class="p">);</span>

  <span class="c1">// must now take remainder/60
</span>  <span class="c1">// this is to convert from degrees-mins-secs to decimal degrees
</span>  <span class="c1">// so the coordinates are "google mappable"
</span>
  <span class="c1">// convert the entire degrees-mins-secs coordinates into a float - this is for easier manipulation later
</span>  <span class="kt">float</span> <span class="n">latitude_float</span> <span class="o">=</span> <span class="n">arrayToFloat</span><span class="p">(</span><span class="n">latitude</span><span class="p">);</span>
  <span class="kt">float</span> <span class="n">longitude_float</span> <span class="o">=</span> <span class="n">arrayToFloat</span><span class="p">(</span><span class="n">longitude</span><span class="p">);</span>

  <span class="c1">// remove the degrees part of the coordinates - so we are left with only minutes-seconds part of the coordinates
</span>  <span class="n">latitude_float</span> <span class="o">=</span> <span class="n">latitude_float</span> <span class="o">-</span> <span class="p">(</span><span class="n">lat_deg_int</span> <span class="o">*</span> <span class="mi">100</span><span class="p">);</span>
  <span class="n">longitude_float</span> <span class="o">=</span> <span class="n">longitude_float</span> <span class="o">-</span> <span class="p">(</span><span class="n">lon_deg_int</span> <span class="o">*</span> <span class="mi">100</span><span class="p">);</span>

  <span class="c1">// convert minutes-seconds to decimal
</span>  <span class="n">latitude_float</span> <span class="o">/=</span> <span class="mi">60</span><span class="p">;</span>
  <span class="n">longitude_float</span> <span class="o">/=</span> <span class="mi">60</span><span class="p">;</span>

  <span class="c1">// add back on the degrees part, so it is decimal degrees
</span>  <span class="n">latitude_float</span> <span class="o">+=</span> <span class="n">lat_deg_int</span><span class="p">;</span>
  <span class="n">longitude_float</span> <span class="o">+=</span> <span class="n">lon_deg_int</span><span class="p">;</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">strcmp</span> <span class="p">(</span><span class="n">lat_direction</span><span class="p">,</span> <span class="s">"S"</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">latitude_float</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="n">strcmp</span> <span class="p">(</span><span class="n">lon_direction</span><span class="p">,</span> <span class="s">"W"</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">longitude_float</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="c1">// format the coordinates nicey - no more than 6 decimal places
</span>  <span class="n">snprintf</span><span class="p">(</span><span class="n">lat_return</span><span class="p">,</span> <span class="n">buff_length</span><span class="p">,</span> <span class="s">"%2.6f"</span><span class="p">,</span> <span class="n">latitude_float</span><span class="p">);</span>
  <span class="n">snprintf</span><span class="p">(</span><span class="n">lon_return</span><span class="p">,</span> <span class="n">buff_length</span><span class="p">,</span> <span class="s">"%3.6f"</span><span class="p">,</span> <span class="n">longitude_float</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">arrayToInt</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">char_array</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">temp</span><span class="p">;</span>
  <span class="n">sscanf</span><span class="p">(</span><span class="n">char_array</span><span class="p">,</span> <span class="s">"%d"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">temp</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">temp</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">float</span> <span class="nf">arrayToFloat</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">char_array</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">float</span> <span class="n">temp</span><span class="p">;</span>
  <span class="n">sscanf</span><span class="p">(</span><span class="n">char_array</span><span class="p">,</span> <span class="s">"%f"</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">temp</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">temp</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="nf">nextToken</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">src</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">buf</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">while</span> <span class="p">(</span><span class="n">src</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">src</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="sc">','</span><span class="p">)</span>
    <span class="n">i</span><span class="o">++</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">buf</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="n">strncpy</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">src</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
    <span class="n">buf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">src</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">i</span><span class="o">++</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">src</span> <span class="o">+</span> <span class="n">i</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">boolean</span> <span class="nf">wifi_status</span><span class="p">(</span><span class="n">LWifiStatus</span> <span class="n">ws</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">switch</span> <span class="p">(</span><span class="n">ws</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">case</span> <span class="n">LWIFI_STATUS_DISABLED</span><span class="p">:</span>
      <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="n">LWIFI_STATUS_DISCONNECTED</span><span class="p">:</span>
      <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="n">LWIFI_STATUS_CONNECTED</span><span class="p">:</span>
      <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
      <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>
</code></pre>
</div>
</td></tr></table>
  </div>
</div>

<p>Connect your LinkIt One device via USB cable and select Serial Debug COM port in Arduino IDE. Compile and Upload your sketch to device using “Upload” button.</p>

<p>After application will be uploaded and started it will try to connect to Thingsboard node using mqtt client and upload “latitude” and “longitude” attributes once per second.</p>

<h2 id="troubleshooting">Troubleshooting</h2>

<p>When application is running you can connect your device to Serial Debug COM port in Arduino IDE and open “Serial Monitor” in order to view debug information produced by serial output.</p>

<h2 id="data-visualization">Data visualization</h2>

<p>Finally, open Thingsboard Web UI. You can access this dashboard by logging in as a tenant administrator. Use</p>

<ul>
  <li>login: tenant@thingsboard.org</li>
  <li>password: tenant</li>
</ul>

<p>in case of local Thingsboard installation.</p>

<p>Go to <strong>“Devices”</strong> section and locate <strong>“LinkIt One Demo Device”</strong>, open device details and switch to <strong>“Attributes”</strong> tab. 
If all is configured correctly you should be able to see <em>“latitude”</em>, <em>“longitude”</em> and battery status attributes and theirs latest values in the table.</p>

<p><img src="/images/samples/linkit-one/gps/attributes.png" alt="image" /></p>

<p>After, open <strong>“Dashboards”</strong> section then locate and open <strong>“LinkIt One GPS Tracking Demo Dashboard”</strong>. 
As a result you will see the map widget with pointer indicating your device location and battery level widget (similar to dashboard image in the introduction).</p>

<h2 id="next-steps">Next steps</h2>

<p>Browse other <a href="/docs/samples">samples</a> or explore guides related to main Thingsboard features:</p>

<ul>
  <li><a href="/docs/user-guide/attributes/">Device attributes</a> - how to use device attributes.</li>
  <li><a href="/docs/user-guide/telemetry/">Telemetry data collection</a> - how to collect telemetry data.</li>
  <li><a href="/docs/user-guide/rpc/">Using RPC capabilities</a> - how to send commands to/from devices.</li>
  <li><a href="/docs/user-guide/rule-engine/">Rule Engine</a> - how to use rule engine to analyze data from devices.</li>
  <li><a href="/docs/user-guide/visualization/">Data Visualization</a> - how to visualize collected data.</li>
</ul>

<h2 id="your-feedback">Your feedback</h2>

<p>Don’t hesitate to star Thingsboard on <strong><a href="https://github.com/thingsboard/thingsboard">github</a></strong> to help us spread the word.
If you have some questions about this sample - post it on the <strong><a href="https://groups.google.com/forum/#!forum/thingsboard">forum</a></strong>.</p>

<div id="share"></div>
<script>
    jqueryDefer(initSocials);
    function initSocials() {
        var scriptsList = [
            {src: 'https://cdn.jsdelivr.net/jquery.jssocials/1.4.0/jssocials.css', type: 'css'},
            {src: 'https://cdn.jsdelivr.net/jquery.jssocials/1.4.0/jssocials-theme-flat.css', type: 'css'},
            {src: 'https://cdn.jsdelivr.net/jquery.jssocials/1.4.0/jssocials.min.js', type: 'script'}
        ];
        loadNextScript(0, scriptsList,
                function() {
                    $("#share").jsSocials({
                        shares: ["email", "twitter", "facebook", "googleplus", "linkedin", "pinterest", "stumbleupon", "whatsapp", "telegram"],
                        showLabel: false,
                        showCount: false
                    });
                }
        );
    }
</script>


  </div>
</section>

<footer>
	<main class="light-text">
		<nav>
			<a href="/docs/getting-started-guides/helloworld/">Get Started</a>
			<a href="/docs/">Documentation</a>
			<a href="/iot-use-cases/">Use cases</a>
			<a href="https://blog.thingsboard.io/">Blog</a>
			<a href="/docs/services/">Services</a>
			<a href="/docs/contact-us/">Contact us</a>
		</nav>
		<div class="newsletterSubsContainer">
			<form id="newsletter-form" method="post" onsubmit="return validateNewsletterForm(this)">
				<fieldset>
					<div class="newsletterInputs">
						<p class="subsTitle">Sign up for Thingsboard IoT newsletter</p>
						<input id="subsEmail" placeholder="Email" class="text-input" name="email" type="text" size="20" maxlength="80">
						<input type="hidden" name="_next" value="/docs/newsletter-thanks/" />
						<input type="text" name="_gotcha" style="display:none" />
						<input class="button" value="Submit" type="submit">
					</div>
				</fieldset>
			</form>
		</div>
		<div class="center">
			<div class="social">
				<div>
					<a href="https://twitter.com/thingsboard" class="twitter"><span>twitter</span></a>
					<a href="https://github.com/thingsboard/thingsboard" class="github"><span>Github</span></a>
					<a href="https://gitter.im/thingsboard/chat" class="gitter"><span>Gitter</span></a>
					<a href="http://stackoverflow.com/questions/tagged/thingsboard" class="stack-overflow"><span>Stack Overflow</span></a>
				</div>
				<div>
					<a href="https://groups.google.com/forum/#!forum/thingsboard" class="mailing-list"><span>Mailing List</span></a>
					<a href="https://www.youtube.com/channel/UCDb9fsV-YR4JmnipAMGsVAQ" class="youtube"><span>YouTube Channel</span></a>
					<a href="https://www.facebook.com/thingsboard" class="facebook"><span>Facebook Page</span></a>
				</div>
			</div>
		</div>
		<div id="miceType" class="center">&copy; 2017 The Thingsboard Authors</div>
	</main>

	<script type="text/javascript">

		function validateNewsletterForm(form) {
			var email = $('input[name=email]', form).val();

			if (!validateValue('Email Address', email)) {
				return false;
			}

			var emailExp = /^[a-zA-Z0-9._%-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;
			if(email.match(emailExp)==null) {
				window.alert("Entered Email Address is not valid.");
				return false;
			}
			return true;
		}

		function validateValue(name, val) {
			if (isEmpty(val)) {
				window.alert("Please fill '" + name + "' field.");
				return false;
			}
			return true;
		}

		function isEmpty(val) {
			return val === undefined || val.trim().length == 0;
		}

	</script>

	<script type="text/javascript">

		var newsletterform =  document.getElementById('newsletter-form');
		newsletterform.setAttribute('action', 'https://formspree.io/' + 'newsletter' + '@' + 'thingsboard' + '.' + 'io');

	</script>

</footer>



<button class="flyout-button" onclick="tb.toggleToc()"></button>


<style>
  .cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
  }
  .gsc-control-cse table, .gsc-control-cse-en table {
    margin:0px !important;
  }
  .gsc-above-wrapper-area {
    border-bottom: 0;
  }
</style>
</body>
</html>
