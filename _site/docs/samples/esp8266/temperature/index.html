

<!Doctype html>
<html id="docs" class="Samples">



<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	
	<!-- Begin Jekyll SEO tag v2.0.0 -->
<title>Temperature upload over MQTT using ESP8266 and DHT22 sensor - Thingsboard</title>
<meta property="og:title" content="Temperature upload over MQTT using ESP8266 and DHT22 sensor" />
<meta name="description" content="Thingsboard IoT Platform sample for temperature data upload over MQTT using ESP8266 and DHT22 sensor." />
<meta property="og:description" content="Thingsboard IoT Platform sample for temperature data upload over MQTT using ESP8266 and DHT22 sensor." />
<link rel="canonical" href="http://localhost:4000/docs/samples/esp8266/temperature/" />
<meta property="og:url" content="http://localhost:4000/docs/samples/esp8266/temperature/" />
<meta property="og:site_name" content="Thingsboard" />
<meta property="og:image" content="http://localhost:4000/images/thingsboard_logo.png" />
<meta name="twitter:image" content="http://localhost:4000/images/thingsboard_logo.png" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="@thingsboard" />
<meta name="twitter:creator" content="@thingsboard" />
<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "WebPage",
    "headline": "Temperature upload over MQTT using ESP8266 and DHT22 sensor",
    "image": "http://localhost:4000/images/thingsboard_logo.png",
    "description": "Thingsboard IoT Platform sample for temperature data upload over MQTT using ESP8266 and DHT22 sensor.",
    "logo": "http://localhost:4000/images/thingsboard_logo.png",
    "url": "http://localhost:4000/docs/samples/esp8266/temperature/"
  }
</script>
<!-- End Jekyll SEO tag -->
	
	
	<link rel="shortcut icon" type="image/png" href="/images/favicon.png">

	<link rel="stylesheet" href="/css/styles.css">
	<script type="text/javascript">
		/*! loadCSS. [c]2017 Filament Group, Inc. MIT License */
		!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);
		/*! onloadCSS. (onload callback for loadCSS) [c]2017 Filament Group, Inc. MIT License */
		function onloadCSS(a,b){function c(){!d&&b&&(d=!0,b.call(a))}var d;a.addEventListener&&a.addEventListener("load",c),a.attachEvent&&a.attachEvent("onload",c),"isApplicationInstalled"in navigator&&"onloadcssdefined"in a&&a.onloadcssdefined(c)}
	</script>
	<script type="text/javascript">

		function jqueryDefer(method) {
			if (window.jQuery) {
				method();
			} else {
				setTimeout(function() {
					jqueryDefer(method)
				}, 50);
			}
		}

		function jqueryUiDefer(method) {
			if (window.jQuery && window.jQuery.ui) {
				method();
			} else {
				setTimeout(function() {
					jqueryUiDefer(method)
				}, 50);
			}
		}

		function loadScript(src, callback)
		{
			var s, r, t;
			r = false;
			s = document.createElement('script');
			s.type = 'text/javascript';
			s.src = src;
			s.onload = s.onreadystatechange = function() {
				if ( !r && (!this.readyState || this.readyState == 'complete') )
				{
					r = true;
					if (callback) {
						callback();
					}
				}
			};
			t = document.getElementsByTagName('script')[0];
			t.parentNode.insertBefore(s, t);
		}

		function loadCssAsync(src, callback) {
			var stylesheet = loadCSS( src );
			if (callback) {
				onloadCSS(stylesheet, callback);
			}
		}

		function loadNextScript(index, scriptsList, completeCallback) {
			if (index < scriptsList.length) {
				var script = scriptsList[index];
				if (script.type === 'script') {
					loadScript(script.src, function() {
						index++;
						loadNextScript(index, scriptsList, completeCallback);
					});
				} else if (script.type === 'css') {
					loadCssAsync(script.src, function() {
						index++;
						loadNextScript(index, scriptsList, completeCallback);
					});
				}
			} else if (completeCallback) {
				completeCallback();
			}
		}

		var initialScriptsList = [
			{src: '/js/jquery-2.2.0.min.js', type: 'script'},
			{src: '/css/jquery-ui.min.css', type: 'css'},
			{src: '/js/jquery-ui.min.js', type: 'script'},
			{src: '/js/script.js', type: 'script'},
			{src: '/css/sweetalert.css', type: 'css'},
			{src: '/js/sweetalert.min.js', type: 'script'}
		];

		loadNextScript(0, initialScriptsList);

	</script>
	<script type="text/javascript">
		function _gaLt(event) {
			/* If GA is blocked or not loaded, or not main|middle|touch click then don't track */
			if (!ga.hasOwnProperty("loaded") || ga.loaded != true || (event.which != 1 && event.which != 2)) {
				return;
			}
			var el = event.srcElement || event.target;

			while (el && (typeof el.tagName == 'undefined' || el.tagName.toLowerCase() != 'a' || !el.href)) {
				el = el.parentNode;
			}
			if (el && el.href) {
				var link = el.href;
				if ((link.indexOf(location.host) == -1 || link.indexOf('.' + location.host) > 0) && !link.match(/^javascript\:/i)) {
					var target = (el.target && !el.target.match(/^_(self|parent|top)$/i)) ? el.target : false;
					if (event.ctrlKey || event.shiftKey || event.metaKey || event.which == 2) {
						target = "_blank";
					}

					var hbrun = false; // tracker has not yet run
					var hitBack = function() {
						if (hbrun) return;
						hbrun = true;
						window.location.href = link;
					};

					if (target) {
						ga(
								"send", "event", "Outgoing Links", link,
								document.location.pathname + document.location.search
						);
					} else {
						event.preventDefault ? event.preventDefault() : event.returnValue = !1;
						ga(
								"send", "event", "Outgoing Links", link,
								document.location.pathname + document.location.search, {
									"hitCallback": hitBack
								}
						);

						setTimeout(hitBack, 1000);
					}
				}
			}
		}

		var _w = window;
		var _gaLtEvt = ("ontouchstart" in _w) ? "click" : "mousedown";
		_w.addEventListener ? _w.addEventListener("load", function() {document.body.addEventListener(_gaLtEvt, _gaLt, !1)}, !1)
				: _w.attachEvent && _w.attachEvent("onload", function() {document.body.attachEvent("on" + _gaLtEvt, _gaLt)});
	</script>
</head>
<body>
<div id="cellophane" onclick="tb.toggleMenu()"></div>
<header>
	<a href="#" class="logo"></a>
	<div class="nav-buttons" data-auto-burger="primary">
		<a href="#" class="button" id="viewDocs" data-auto-burger-exclude>&nbsp;&nbsp;主要功能&nbsp;&nbsp;</a>
		<a href="#" class="button" id="useCases" data-auto-burger-exclude>&nbsp;&nbsp;查看文档&nbsp;&nbsp;</a>
		<a href="#" class="button" id="useCases" data-auto-burger-exclude>&nbsp;&nbsp;案例分析&nbsp;&nbsp;</a>
		<a href="#" class="button" id="gettingStarted" data-auto-burger-exclude>&nbsp;&nbsp;开始使用&nbsp;&nbsp;</a>
		<button id="hamburger" onclick="tb.toggleMenu()" data-auto-burger-exclude><div></div></button>
	</div>

	<nav id="mainNav">
		<main id="headNav" data-auto-burger="primary">
			<div class="nav-box">
				<h3><a href="#">开始使用<a></h3>
			</div>
			<div class="nav-box">
				<h3><a href="#">查看文档</a></h3>
			</div>
			<div class="nav-box">
				<h3><a href="#">案例分析</a></h3>
			</div>
			<div class="nav-box">
				<h3><a href="http://osswangxining.github.io/">Blog</a></h3>
			</div>
			<div class="nav-box">
				<h3><a href="#">服务支持</a></h3>
			</div>
			<div class="nav-box">
				<h3><a href="#">联系我们</a></h3>
			</div>
		</main>

	</nav>
</header>


<!--  HERO  -->
<section id="hero" class="light-text">
  <h1>Samples</h1>
  <h5>A collection of example applications that show how to use Thingsboard.</h5>
  <div id="vendorStrip" class="light-text">
    <div id="docsList">
        <ul>
          <li><a href="/docs/" >DOCS HOME</a></li>
          <li><a href="/docs/api/" >API</a></li>
          <li><a href="/docs/iot-gateway/" >IOT GATEWAY</a></li>
          <li><a href="/docs/reference/" >REFERENCE</a></li>
          <li><a href="/docs/samples/" class="YAH">SAMPLES</a></li>
          <li><a href="/iot-use-cases/" >USE CASES</a></li>
          <li><a href="/docs/iot-video-tutorials/" >VIDEO TUTORIALS</a></li>
          <li><a href="/docs/faq/" >FAQ</a></li>
          <li><a href="/docs/services/" >SERVICES</a></li>
          <li><a href="/docs/contact-us/" >CONTACT US</a></li>
        </ul>
    </div>
    <div id="searchBox">
      <input type="text" id="search" placeholder="Search" onkeydown="if (event.keyCode==13) window.location.replace('/docs/search/?q=' + this.value)">
    </div>
  </div>
</section>





<section id="encyclopedia">
  
  <div id="docsToc" >
        <div class="pi-accordion">
        
    <a class="item" data-title="Samples" href="/docs/samples/"></a>
    <a class="item" data-title="Live Demo Server" href="/docs/user-guide/live-demo/"></a>
    <a class="item" data-title="Local Demo Account" href="/docs/samples/demo-account/"></a>
<div class="item" data-title="Hardware samples">
  <div class="container">
<div class="item" data-title="Arduino">
  <div class="container">
    <a class="item" data-title="Arduino overview" href="/docs/samples/arduino/"></a>
    <a class="item" data-title="Temperature upload over MQTT using Arduino UNO, ESP8266 and DHT22 sensor" href="/docs/samples/arduino/temperature/"></a>
  </div>
</div>
<div class="item" data-title="ESP8266">
  <div class="container">
    <a class="item" data-title="ESP8266 overview" href="/docs/samples/esp8266/"></a>
    <a class="item" data-title="Temperature upload over MQTT using ESP8266 and DHT22 sensor" href="/docs/samples/esp8266/temperature/"></a>
    <a class="item" data-title="ESP8266 GPIO control over MQTT using Thingsboard" href="/docs/samples/esp8266/gpio/"></a>
  </div>
</div>
<div class="item" data-title="NodeMCU">
  <div class="container">
    <a class="item" data-title="NodeMCU overview" href="/docs/samples/nodemcu/"></a>
    <a class="item" data-title="Temperature upload over MQTT using NodeMCU and DHT11 sensor" href="/docs/samples/nodemcu/temperature/"></a>
  </div>
</div>
<div class="item" data-title="Raspberry Pi">
  <div class="container">
    <a class="item" data-title="Raspberry Pi overview" href="/docs/samples/raspberry/"></a>
    <a class="item" data-title="Raspberry Pi GPIO control over MQTT using Thingsboard" href="/docs/samples/raspberry/gpio/"></a>
    <a class="item" data-title="Raspberry Pi GPIO control using Android Things and Thingsboard" href="/docs/samples/raspberry/gpio-android-things/"></a>
    <a class="item" data-title="Temperature upload over MQTT using Raspberry Pi and DHT22 sensor" href="/docs/samples/raspberry/temperature/"></a>
  </div>
</div>
<div class="item" data-title="LinkIt ONE">
  <div class="container">
    <a class="item" data-title="LinkIt ONE overview" href="/docs/samples/linkit-one/"></a>
    <a class="item" data-title="GPS data upload and visualization using LinkIt ONE and Thingsboard" href="/docs/samples/linkit-one/gps/"></a>
  </div>
</div>
  </div>
</div>
<div class="item" data-title="Tutorials">
  <div class="container">
<div class="item" data-title="Alarms">
  <div class="container">
    <a class="item" data-title="Sending Alarms using Email Plugin" href="/docs/samples/alarms/mail/"></a>
    <a class="item" data-title="Alarms based on devices attributes and sensor readings" href="/docs/samples/alarms/basic-rules/"></a>
  </div>
</div>
    <a class="item" data-title="Facilities Monitoring PoC" href="/docs/samples/monitoring/facilities-monitoring-poc/"></a>
  </div>
</div>
        </div> <!-- /pi-accordion -->
    <button class="push-menu-close-button" onclick="tb.toggleToc()"></button>
  </div> <!-- /docsToc -->
  
  <div id="docsContent" class="">
    <h1>Temperature upload over MQTT using ESP8266 and DHT22 sensor</h1>
    <ul id="markdown-toc">
  <li><a href="#introduction" id="markdown-toc-introduction">Introduction</a></li>
  <li><a href="#prerequisites" id="markdown-toc-prerequisites">Prerequisites</a></li>
  <li><a href="#list-of-hardware-and-pinouts" id="markdown-toc-list-of-hardware-and-pinouts">List of hardware and pinouts</a></li>
  <li><a href="#wiring-schemes" id="markdown-toc-wiring-schemes">Wiring schemes</a>    <ul>
      <li><a href="#programmingflashing-schema" id="markdown-toc-programmingflashing-schema">Programming/flashing schema</a></li>
      <li><a href="#final-schema-battery-powered" id="markdown-toc-final-schema-battery-powered">Final schema (Battery Powered)</a></li>
    </ul>
  </li>
  <li><a href="#thingsboard-configuration" id="markdown-toc-thingsboard-configuration">Thingsboard configuration</a>    <ul>
      <li><a href="#provision-your-device" id="markdown-toc-provision-your-device">Provision your device</a></li>
      <li><a href="#provision-your-dashboard" id="markdown-toc-provision-your-dashboard">Provision your dashboard</a></li>
    </ul>
  </li>
  <li><a href="#programming-the-esp8266" id="markdown-toc-programming-the-esp8266">Programming the ESP8266</a>    <ul>
      <li><a href="#step-1-esp8266-and-arduino-ide-setup" id="markdown-toc-step-1-esp8266-and-arduino-ide-setup">Step 1. ESP8266 and Arduino IDE setup.</a></li>
      <li><a href="#step-2-install-arduino-libraries" id="markdown-toc-step-2-install-arduino-libraries">Step 2. Install Arduino libraries.</a></li>
      <li><a href="#step-3-prepare-and-upload-sketch" id="markdown-toc-step-3-prepare-and-upload-sketch">Step 3. Prepare and upload sketch.</a></li>
    </ul>
  </li>
  <li><a href="#autonomous-operation" id="markdown-toc-autonomous-operation">Autonomous operation</a></li>
  <li><a href="#troubleshooting" id="markdown-toc-troubleshooting">Troubleshooting</a></li>
  <li><a href="#data-visualization" id="markdown-toc-data-visualization">Data visualization</a></li>
  <li><a href="#next-steps" id="markdown-toc-next-steps">Next steps</a></li>
  <li><a href="#your-feedback" id="markdown-toc-your-feedback">Your feedback</a></li>
</ul>

<h2 id="introduction">Introduction</h2>
<p>Thingsboard is an open-source server-side platform that allows you to monitor and control IoT devices. 
It is free for both personal and commercial usage and you can deploy it anywhere. 
If this is your first experience with the platform we recommend to review 
<a href="/docs/getting-started-guides/what-is-thingsboard/">what-is-thingsboard</a> page and <a href="/docs/getting-started-guides/helloworld/">getting-started</a> guide.</p>

<p>This sample application performs collection of temperature and humidity values produced by <a href="https://www.adafruit.com/product/385">DHT22 sensor</a> and further visualization on the real-time web dashboard.
Collected data is pushed via MQTT to Thingsboard server for storage and visualization.
The purpose of this application is to demonstrate Thingsboard <a href="/docs/user-guide/telemetry/">data collection API</a> and <a href="/docs/user-guide/visualization/">visualization capabilities</a>.</p>

<p>The DHT22 sensor is connected to <a href="https://en.wikipedia.org/wiki/ESP8266">ESP8266</a>.
ESP8266 offers a complete and self-contained Wi-Fi networking solution.
ESP8266 push data to Thingsboard server via MQTT protocol by using <a href="https://github.com/knolleary/pubsubclient">PubSubClient</a> library for Arduino.
Data is visualized using built-in customizable dashboard. 
The application that is running on ESP8266 is written using Arduino SDK which is quite simple and easy to understand.</p>

<p>The video below demonstrates the final result of this tutorial.</p>

<p><br />
<br /></p>
<div id="video">
  <div id="video_wrapper">
    <iframe src="https://www.youtube.com/embed/S8JNPYsdT_M" frameborder="0" allowfullscreen=""></iframe>
  </div>
</div>
<p><br />
<br /></p>

<p>Once you complete this sample/tutorial, you will see your sensor data on the following dashboard.</p>

<p><img src="/images/samples/esp8266/temperature/dashboard.gif" alt="image" /></p>

<h2 id="prerequisites">Prerequisites</h2>

<p>You will need to Thingsboard server up and running. Use either <a href="https://demo.thingsboard.io/signup">Live Demo</a> or 
<a href="/docs/user-guide/install/installation-options/">Installation Guide</a> to install Thingsboard.</p>

<h2 id="list-of-hardware-and-pinouts">List of hardware and pinouts</h2>

<ul>
  <li><a href="https://www.aliexpress.com/item/2PCS-ESP8266-Serial-Esp-01-WIFI-Wireless-Transceiver-Module-Send-Receive-LWIP-AP-STA/32302638695.html?spm=2114.03010208.3.163.FPBlcc&amp;ws_ab_test=searchweb0_0,searchweb201602_2_10065_10068_10084_10083_10080_10082_10081_10060_10061_10062_10056_10055_10054_10059_10099_10078_10079_10093_427_10073_10103_10102_10096_10052_10050_10051,searchweb201603_3&amp;btsid=1494d8a7-6202-4a69-a0e7-877ffa333243">ESP8266 module</a></li>
</ul>

<p><img src="/images/samples/arduino/temperature/esp8266-pinout.png" alt="image" /></p>

<ul>
  <li><a href="https://www.aliexpress.com/item/1pcs-DHT22-digital-temperature-and-humidity-sensor-Temperature-and-humidity-module-AM2302-replace-SHT11-SHT15/32316036161.html?spm=2114.03010208.3.49.aZvfaG&amp;ws_ab_test=searchweb0_0,searchweb201602_2_10065_10068_10084_10083_10080_10082_10081_10060_10061_10062_10056_10055_10054_10059_10099_10078_10079_10093_426_10073_10103_10102_10096_10052_10050_10051,searchweb201603_6&amp;btsid=28d9ee9a-283a-4e97-af7b-a7e530490916">DHT22 sensor</a></li>
</ul>

<p><img src="/images/samples/arduino/temperature/dht22-pinout.png" alt="image" /></p>

<ul>
  <li>
    <p>USB to TTL</p>

    <ul>
      <li><a href="https://www.aliexpress.com/item/Free-shipping-1pcs-FT232RL-FTDI-USB-3-3V-5-5V-to-TTL-Serial-Adapter-Module-for/32256920717.html?spm=2114.03010208.3.11.qSXSby&amp;ws_ab_test=searchweb0_0,searchweb201602_2_10065_10068_10084_10083_10080_10082_10081_10060_10061_10062_10056_10055_10054_10059_10099_10078_10079_10093_427_10073_10103_10102_10096_10052_10050_10051,searchweb201603_3&amp;btsid=54ef4b72-5ab0-4ce6-aa89-74726d95c099">With DTR &amp; RTS</a></li>
    </ul>

    <p><img src="/images/samples/esp8266/temperature/usb-ttl-ft232rl-pinout.png" alt="image" /></p>

    <ul>
      <li>Or <a href="https://www.aliexpress.com/item/1pcs-lot-PL2303-USB-To-RS232-TTL-Converter-Adapter-Module-with-Dust-proof-Cover-PL2303HX/32642301991.html?spm=2114.03010208.3.50.WdAM18&amp;ws_ab_test=searchweb0_0,searchweb201602_2_10065_10068_10084_10083_10080_10082_10081_10060_10061_10062_10056_10055_10054_10059_10099_10078_10079_10093_427_10073_10103_10102_10096_10052_10050_10051,searchweb201603_3&amp;btsid=9ac20e48-da8c-4a0f-8f33-d40c241fe5a3">Without DTR &amp; RTS</a></li>
    </ul>

    <p><img src="/images/samples/esp8266/temperature/usb-ttl-pl2303hx.png" alt="image" /></p>
  </li>
  <li>
    <p>Resistor (between 4.7K and 10K)</p>
  </li>
  <li>
    <p>Breadboard</p>
  </li>
  <li>
    <p>2 female-to-female jumper wires</p>
  </li>
  <li>
    <p>10 female-to-male jumper wires</p>
  </li>
  <li>
    <p>3 male-to-male jumper wire</p>
  </li>
  <li>
    <p>3.3V power source (for example 2 AA batteries)</p>
  </li>
</ul>

<h2 id="wiring-schemes">Wiring schemes</h2>

<h3 id="programmingflashing-schema">Programming/flashing schema</h3>

<table>
  <thead>
    <tr>
      <th>ESP8266 Pin</th>
      <th>USB-TTL Pin</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>ESP8266 VCC</td>
      <td>USB-TTL VCC +3.3V</td>
    </tr>
    <tr>
      <td>ESP8266 CH_PD</td>
      <td>USB-TTL VCC +3.3V</td>
    </tr>
    <tr>
      <td>ESP8266 GND (-)</td>
      <td>USB-TTL GND</td>
    </tr>
    <tr>
      <td>ESP8266 GPIO 0</td>
      <td>USB-TTL GND</td>
    </tr>
    <tr>
      <td>ESP8266 RX</td>
      <td>USB-TTL TX</td>
    </tr>
    <tr>
      <td>ESP8266 TX</td>
      <td>USB-TTL RX</td>
    </tr>
  </tbody>
</table>

<table>
  <thead>
    <tr>
      <th>DHT-22 Pin</th>
      <th>ESP8266 Pin</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>DHT-22 Data</td>
      <td>ESP8266 GPIO 2</td>
    </tr>
  </tbody>
</table>

<table>
  <thead>
    <tr>
      <th>DHT-22 Pin</th>
      <th>USB-TTL Pin</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>DHT-22 VCC</td>
      <td>USB-TTL VCC +3.3V</td>
    </tr>
    <tr>
      <td>DHT-22 GND (-)</td>
      <td>USB-TTL GND</td>
    </tr>
  </tbody>
</table>

<p>Finally, place a resistor (between 4.7K and 10K) between pin number 1 and 2 of the DHT sensor.</p>

<p>The following picture summarizes the connections for this project in programming/debug mode:</p>

<p><img src="/images/samples/esp8266/temperature/schema-flash.png" alt="image" /></p>

<h3 id="final-schema-battery-powered">Final schema (Battery Powered)</h3>

<table>
  <thead>
    <tr>
      <th>ESP8266 Pin</th>
      <th>3.3V power source</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>ESP8266 VCC</td>
      <td>VCC+</td>
    </tr>
    <tr>
      <td>ESP8266 CH_PD</td>
      <td>VCC+</td>
    </tr>
    <tr>
      <td>ESP8266 GND (-)</td>
      <td>VCC-</td>
    </tr>
  </tbody>
</table>

<table>
  <thead>
    <tr>
      <th>DHT-22 Pin</th>
      <th>ESP8266 Pin</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>DHT-22 Data</td>
      <td>ESP8266 GPIO 2</td>
    </tr>
  </tbody>
</table>

<table>
  <thead>
    <tr>
      <th>DHT-22 Pin</th>
      <th>3.3V power source</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>DHT-22 VCC</td>
      <td>VCC+</td>
    </tr>
    <tr>
      <td>DHT-22 GND (-)</td>
      <td>VCC-</td>
    </tr>
  </tbody>
</table>

<p>The final picture:</p>

<p><img src="/images/samples/esp8266/temperature/schema.png" alt="image" /></p>

<h2 id="thingsboard-configuration">Thingsboard configuration</h2>

<p><strong>Note</strong> Thingsboard configuration steps are necessary only in case of <strong>local Thingsboard installation</strong>.
If you are using <a href="https://demo.thingsboard.io/"><strong>Live Demo</strong></a> instance all entities are pre-configured for your demo account.
However, we recommend to review this steps because you will still need to get device access token to send requests to Thingsboard.</p>

<h3 id="provision-your-device">Provision your device</h3>

<p>This step contains instructions that are necessary to connect your device to Thingsboard.</p>

<p>Open Thingsboard Web UI (http://localhost:8080) in browser and login as tenant administrator</p>

<ul>
  <li>login: tenant@thingsboard.org</li>
  <li>password: tenant</li>
</ul>

<p>Goto “Devices” section. Click “+” button and create device with name “ESP8266 Demo Device”.</p>

<p><img src="/images/samples/esp8266/temperature/device.png" alt="image" /></p>

<p>Once device created, open its details and click “Manage credentials”.
Copy auto-generated access token from the “Access token” field. Please save this device token. It will be referred to later as <strong>$ACCESS_TOKEN</strong>.</p>

<p><img src="/images/samples/esp8266/temperature/credentials.png" alt="image" /></p>

<p>Click “Copy Device ID” in device details to copy your device id to clipboard.
Paste your device id to some place, this value will be used in further steps.</p>

<h3 id="provision-your-dashboard">Provision your dashboard</h3>

<p>Download the dashboard file using this <a href="/docs/samples/esp8266/resources/esp8266_dht_temp_dashboard_v2.json"><strong>link</strong></a>. 
Use import/export <a href="/docs/user-guide/ui/dashboards/#dashboard-importexport"><strong>instructions</strong></a> to import the dashboard to your Thingsboard instance.</p>

<h2 id="programming-the-esp8266">Programming the ESP8266</h2>

<h3 id="step-1-esp8266-and-arduino-ide-setup">Step 1. ESP8266 and Arduino IDE setup.</h3>

<p>In order to start programming ESP8266 device you will need Arduino IDE installed and all related software.</p>

<p>Download and install <a href="https://www.arduino.cc/en/Main/Software">Arduino IDE</a>.</p>

<p>After starting arduino, open from the ‘file’ menu the preferences.</p>

<p><img src="/images/samples/esp8266/temperature/arduino-preferences.png" alt="image" /></p>

<p>Fill in the “Additional board managers URL” this url:  http://arduino.esp8266.com/stable/package_esp8266com_index.json</p>

<p>Close the screen by the OK button.</p>

<p>Now we can add the board ESP8266 using the board manager.</p>

<p>Click in the menu tools the menu option Board: “<em>Most likely Arduino UNO</em>”. 
There  you will find the first option  “Board Manager”.</p>

<p>Type in the search bar the 3 letters ESP. Locate and click on “<em>esp8266 by ESP8266 Community</em>”. 
Click on install and wait for a minute to download the board.</p>

<p><img src="/images/samples/esp8266/temperature/arduino-board-manager.png" alt="image" /></p>

<p><strong>Note</strong> that this tutorial was tested with the “<em>esp8266 by ESP8266 Community</em>” version 2.3.0.</p>

<p>In the menu Tools “Board “<em>Most likely Arduino UNO</em>” three new boards are added.</p>

<p>Select “Generic ESP8266 Module”.</p>

<p>Prepare your hardware according to the <a href="#programmingflashing-schema">Programming/flashing schema</a>.
Connect USB-TTL adapter with PC.</p>

<p>Select in the menu Tools, port the corresponding port of the USB-TTL adapter.
Open the serial monitor (by pressing CTRL-Shift-M or from the menu Tools).
Set the key emulation to “Both NL &amp; CR” and the speed to 115200 baud. This can be set in the bottom of terminal screen.</p>

<h3 id="step-2-install-arduino-libraries">Step 2. Install Arduino libraries.</h3>

<p>Open Arduino IDE and go to <strong>Sketch -&gt; Include Library -&gt; Manage Libraries</strong>. 
Find and install the following libraries:</p>

<ul>
  <li><a href="http://pubsubclient.knolleary.net/">PubSubClient by Nick O’Leary</a>.</li>
  <li><a href="https://github.com/adafruit/Adafruit_Sensor">Adafruit Unified Sensor by Adafruit</a></li>
  <li><a href="https://github.com/adafruit/DHT-sensor-library">DHT sensor library by Adafruit</a></li>
</ul>

<p><strong>Note</strong> that this tutorial was tested with the following versions of the libraries:</p>

<ul>
  <li>PubSubClient 2.6</li>
  <li>Adafruit Unified Sensor 1.0.2</li>
  <li>DHT sensor library 1.3.0</li>
</ul>

<h3 id="step-3-prepare-and-upload-sketch">Step 3. Prepare and upload sketch.</h3>

<p>Download and open <strong>esp8266-dht-mqtt.ino</strong> sketch.</p>

<p><strong>Note</strong> You need to edit following constants and variables in the sketch:</p>

<ul>
  <li>WIFI_AP - name of your access point</li>
  <li>WIFI_PASSWORD - access point password</li>
  <li>TOKEN - the <strong>$ACCESS_TOKEN</strong> from Thingsboard configuration step.</li>
  <li>thingsboardServer - Thingsboard HOST/IP address that is accessable within your wifi network. Specify “demo.thingsboard.io” if you are using <a href="https://demo.thingsboard.io/">live demo</a> server.</li>
</ul>

<script>
  jqueryUiDefer(initTabs);
  function initTabs() {
    $(function(){$("#arduino-sketch").tabs();});
  }
</script>

<div id="arduino-sketch">
  <ul>
    <li><a href="#esp8266-dht-mqtt">esp8266-dht-mqtt.ino</a></li>
  </ul>
  <div id="esp8266-dht-mqtt">
    <table class="includecode"><thead><tr><th><a href="https://raw.githubusercontent.com/thingsboard/thingsboard.github.io/master/docs/samples/esp8266/resources/esp8266-dht-mqtt.ino" download="resources/esp8266-dht-mqtt.ino"><code>resources/esp8266-dht-mqtt.ino</code></a><img src="/images/copycode.svg" style="max-height:24px" onclick="copyCode('resources/esp8266-dht-mqtt.ino')" title="Copy resources/esp8266-dht-mqtt.ino to clipboard" /></th></tr></thead>
<tr><td>
<div id="resources/esp8266-dht-mqtt.ino" class="language-c highlighter-rouge"><pre class="highlight"><code><span class="cp">#include "DHT.h"
#include &lt;PubSubClient.h&gt;
#include &lt;ESP8266WiFi.h&gt;
</span>
<span class="cp">#define WIFI_AP "YOUR_WIFI_AP"
#define WIFI_PASSWORD "YOUR_WIFI_PASSWORD"
</span>
<span class="cp">#define TOKEN "ESP8266_DEMO_TOKEN"
</span>
<span class="c1">// DHT
</span><span class="cp">#define DHTPIN 2
#define DHTTYPE DHT22
</span>
<span class="kt">char</span> <span class="n">thingsboardServer</span><span class="p">[]</span> <span class="o">=</span> <span class="s">"YOUR_THINGSBOARD_HOST_OR_IP"</span><span class="p">;</span>

<span class="n">WiFiClient</span> <span class="n">wifiClient</span><span class="p">;</span>

<span class="c1">// Initialize DHT sensor.
</span><span class="n">DHT</span> <span class="n">dht</span><span class="p">(</span><span class="n">DHTPIN</span><span class="p">,</span> <span class="n">DHTTYPE</span><span class="p">);</span>

<span class="n">PubSubClient</span> <span class="n">client</span><span class="p">(</span><span class="n">wifiClient</span><span class="p">);</span>

<span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">WL_IDLE_STATUS</span><span class="p">;</span>
<span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">lastSend</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span>
  <span class="n">dht</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
  <span class="n">InitWiFi</span><span class="p">();</span>
  <span class="n">client</span><span class="p">.</span><span class="n">setServer</span><span class="p">(</span> <span class="n">thingsboardServer</span><span class="p">,</span> <span class="mi">1883</span> <span class="p">);</span>
  <span class="n">lastSend</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span>
<span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span> <span class="o">!</span><span class="n">client</span><span class="p">.</span><span class="n">connected</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>
    <span class="n">reconnect</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span> <span class="n">millis</span><span class="p">()</span> <span class="o">-</span> <span class="n">lastSend</span> <span class="o">&gt;</span> <span class="mi">1000</span> <span class="p">)</span> <span class="p">{</span> <span class="c1">// Update and send only after 1 seconds
</span>    <span class="n">getAndSendTemperatureAndHumidityData</span><span class="p">();</span>
    <span class="n">lastSend</span> <span class="o">=</span> <span class="n">millis</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="n">client</span><span class="p">.</span><span class="n">loop</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">getAndSendTemperatureAndHumidityData</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Collecting temperature data."</span><span class="p">);</span>

  <span class="c1">// Reading temperature or humidity takes about 250 milliseconds!
</span>  <span class="kt">float</span> <span class="n">h</span> <span class="o">=</span> <span class="n">dht</span><span class="p">.</span><span class="n">readHumidity</span><span class="p">();</span>
  <span class="c1">// Read temperature as Celsius (the default)
</span>  <span class="kt">float</span> <span class="n">t</span> <span class="o">=</span> <span class="n">dht</span><span class="p">.</span><span class="n">readTemperature</span><span class="p">();</span>

  <span class="c1">// Check if any reads failed and exit early (to try again).
</span>  <span class="k">if</span> <span class="p">(</span><span class="n">isnan</span><span class="p">(</span><span class="n">h</span><span class="p">)</span> <span class="o">||</span> <span class="n">isnan</span><span class="p">(</span><span class="n">t</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Failed to read from DHT sensor!"</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Humidity: "</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">h</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">" %</span><span class="se">\t</span><span class="s">"</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Temperature: "</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">t</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">" *C "</span><span class="p">);</span>

  <span class="n">String</span> <span class="n">temperature</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="n">t</span><span class="p">);</span>
  <span class="n">String</span> <span class="n">humidity</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="n">h</span><span class="p">);</span>


  <span class="c1">// Just debug messages
</span>  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span> <span class="s">"Sending temperature and humidity : ["</span> <span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span> <span class="n">temperature</span> <span class="p">);</span> <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span> <span class="s">","</span> <span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span> <span class="n">humidity</span> <span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span> <span class="s">"]   -&gt; "</span> <span class="p">);</span>

  <span class="c1">// Prepare a JSON payload string
</span>  <span class="n">String</span> <span class="n">payload</span> <span class="o">=</span> <span class="s">"{"</span><span class="p">;</span>
  <span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\"</span><span class="s">temperature</span><span class="se">\"</span><span class="s">:"</span><span class="p">;</span> <span class="n">payload</span> <span class="o">+=</span> <span class="n">temperature</span><span class="p">;</span> <span class="n">payload</span> <span class="o">+=</span> <span class="s">","</span><span class="p">;</span>
  <span class="n">payload</span> <span class="o">+=</span> <span class="s">"</span><span class="se">\"</span><span class="s">humidity</span><span class="se">\"</span><span class="s">:"</span><span class="p">;</span> <span class="n">payload</span> <span class="o">+=</span> <span class="n">humidity</span><span class="p">;</span>
  <span class="n">payload</span> <span class="o">+=</span> <span class="s">"}"</span><span class="p">;</span>

  <span class="c1">// Send payload
</span>  <span class="kt">char</span> <span class="n">attributes</span><span class="p">[</span><span class="mi">100</span><span class="p">];</span>
  <span class="n">payload</span><span class="p">.</span><span class="n">toCharArray</span><span class="p">(</span> <span class="n">attributes</span><span class="p">,</span> <span class="mi">100</span> <span class="p">);</span>
  <span class="n">client</span><span class="p">.</span><span class="n">publish</span><span class="p">(</span> <span class="s">"v1/devices/me/telemetry"</span><span class="p">,</span> <span class="n">attributes</span> <span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span> <span class="n">attributes</span> <span class="p">);</span>

<span class="p">}</span>

<span class="kt">void</span> <span class="nf">InitWiFi</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Connecting to AP ..."</span><span class="p">);</span>
  <span class="c1">// attempt to connect to WiFi network
</span>
  <span class="n">WiFi</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="n">WIFI_AP</span><span class="p">,</span> <span class="n">WIFI_PASSWORD</span><span class="p">);</span>
  <span class="k">while</span> <span class="p">(</span><span class="n">WiFi</span><span class="p">.</span><span class="n">status</span><span class="p">()</span> <span class="o">!=</span> <span class="n">WL_CONNECTED</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"."</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Connected to AP"</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="nf">reconnect</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Loop until we're reconnected
</span>  <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">client</span><span class="p">.</span><span class="n">connected</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">WiFi</span><span class="p">.</span><span class="n">status</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span> <span class="n">status</span> <span class="o">!=</span> <span class="n">WL_CONNECTED</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">WiFi</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="n">WIFI_AP</span><span class="p">,</span> <span class="n">WIFI_PASSWORD</span><span class="p">);</span>
      <span class="k">while</span> <span class="p">(</span><span class="n">WiFi</span><span class="p">.</span><span class="n">status</span><span class="p">()</span> <span class="o">!=</span> <span class="n">WL_CONNECTED</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
        <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"."</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Connected to AP"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Connecting to Thingsboard node ..."</span><span class="p">);</span>
    <span class="c1">// Attempt to connect (clientId, username, password)
</span>    <span class="k">if</span> <span class="p">(</span> <span class="n">client</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="s">"ESP8266 Device"</span><span class="p">,</span> <span class="n">TOKEN</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
      <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span> <span class="s">"[DONE]"</span> <span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span> <span class="s">"[FAILED] [ rc = "</span> <span class="p">);</span>
      <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span> <span class="n">client</span><span class="p">.</span><span class="n">state</span><span class="p">()</span> <span class="p">);</span>
      <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span> <span class="s">" : retrying in 5 seconds]"</span> <span class="p">);</span>
      <span class="c1">// Wait 5 seconds before retrying
</span>      <span class="n">delay</span><span class="p">(</span> <span class="mi">5000</span> <span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>
</td></tr></table>
  </div>
</div>

<p>Connect USB-TTL adapter to PC and select the corresponding port in Arduino IDE. Compile and Upload your sketch to device using “Upload” button.</p>

<p>After application will be uploaded and started it will try to connect to Thingsboard node using mqtt client and upload “temperature” and “humidity” timeseries data once per second.</p>

<h2 id="autonomous-operation">Autonomous operation</h2>

<p>When you have uploaded the sketch, you may remove all the wires required for uploading including USB-TTL adapter and connect your ESP8266 and DHT sensor directly to power source according to the <a href="#final-schema-battery-powered">Final wiring schema</a>.</p>

<h2 id="troubleshooting">Troubleshooting</h2>

<p>In order to perform troubleshooting you should assemble your hardware according to the <a href="#programmingflashing-schema">Programming/flashing schema</a>.
Then connect USB-TTL adapter with PC and select port of the USB-TTL adapter in Arduino IDE. Finally open “Serial Monitor” in order to view debug information produced by serial output.</p>

<h2 id="data-visualization">Data visualization</h2>

<p>Finally, open Thingsboard Web UI. You can access this dashboard by logging in as a tenant administrator. Use:</p>

<ul>
  <li>login: tenant@thingsboard.org</li>
  <li>password: tenant</li>
</ul>

<p>in case of local Thingsboard installation.</p>

<p>Go to <strong>“Devices”</strong> section and locate <strong>“ESP8266 Demo Device”</strong>, open device details and switch to <strong>“Latest telemetry”</strong> tab. 
If all is configured correctly you should be able to see latest values of <em>“temperature”</em> and <em>“humidity”</em> in the table.</p>

<p><img src="/images/samples/esp8266/temperature/attributes.png" alt="image" /></p>

<p>After, open <strong>“Dashboards”</strong> section then locate and open <strong>“ESP8266 DHT22: Temperature &amp; Humidity Demo Dashboard”</strong>. 
As a result you will see two digital gauges and two time-series charts displaying temperature and humidity level (similar to dashboard image in the introduction).</p>

<h2 id="next-steps">Next steps</h2>

<p>Browse other <a href="/docs/samples">samples</a> or explore guides related to main Thingsboard features:</p>

<ul>
  <li><a href="/docs/user-guide/attributes/">Device attributes</a> - how to use device attributes.</li>
  <li><a href="/docs/user-guide/telemetry/">Telemetry data collection</a> - how to collect telemetry data.</li>
  <li><a href="/docs/user-guide/rpc/">Using RPC capabilities</a> - how to send commands to/from devices.</li>
  <li><a href="/docs/user-guide/rule-engine/">Rule Engine</a> - how to use rule engine to analyze data from devices.</li>
  <li><a href="/docs/user-guide/visualization/">Data Visualization</a> - how to visualize collected data.</li>
</ul>

<h2 id="your-feedback">Your feedback</h2>

<p>Don’t hesitate to star Thingsboard on <strong><a href="https://github.com/thingsboard/thingsboard">github</a></strong> to help us spread the word.
If you have some questions about this sample - post it on the <strong><a href="https://groups.google.com/forum/#!forum/thingsboard">forum</a></strong>.</p>

<div id="share"></div>
<script>
    jqueryDefer(initSocials);
    function initSocials() {
        var scriptsList = [
            {src: 'https://cdn.jsdelivr.net/jquery.jssocials/1.4.0/jssocials.css', type: 'css'},
            {src: 'https://cdn.jsdelivr.net/jquery.jssocials/1.4.0/jssocials-theme-flat.css', type: 'css'},
            {src: 'https://cdn.jsdelivr.net/jquery.jssocials/1.4.0/jssocials.min.js', type: 'script'}
        ];
        loadNextScript(0, scriptsList,
                function() {
                    $("#share").jsSocials({
                        shares: ["email", "twitter", "facebook", "googleplus", "linkedin", "pinterest", "stumbleupon", "whatsapp", "telegram"],
                        showLabel: false,
                        showCount: false
                    });
                }
        );
    }
</script>


  </div>
</section>

<footer>
	<main class="light-text">
		
		<div id="miceType" class="center">&copy; 2016 - 2017 IoT套件</div>
	</main>

</footer>



<button class="flyout-button" onclick="tb.toggleToc()"></button>


<style>
  .cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
  }
  .gsc-control-cse table, .gsc-control-cse-en table {
    margin:0px !important;
  }
  .gsc-above-wrapper-area {
    border-bottom: 0;
  }
</style>
</body>
</html>
