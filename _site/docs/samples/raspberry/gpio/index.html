

<!Doctype html>
<html id="docs" class="Samples">



<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	
	<!-- Begin Jekyll SEO tag v2.0.0 -->
<title>Raspberry Pi GPIO control over MQTT using Thingsboard - Thingsboard</title>
<meta property="og:title" content="Raspberry Pi GPIO control over MQTT using Thingsboard" />
<meta name="description" content="Thingsboard IoT Platform sample for Raspberry Pi GPIO control over MQTT" />
<meta property="og:description" content="Thingsboard IoT Platform sample for Raspberry Pi GPIO control over MQTT" />
<link rel="canonical" href="http://localhost:4000/docs/samples/raspberry/gpio/" />
<meta property="og:url" content="http://localhost:4000/docs/samples/raspberry/gpio/" />
<meta property="og:site_name" content="Thingsboard" />
<meta property="og:image" content="http://localhost:4000/images/thingsboard_logo.png" />
<meta name="twitter:image" content="http://localhost:4000/images/thingsboard_logo.png" />
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="@thingsboard" />
<meta name="twitter:creator" content="@thingsboard" />
<script type="application/ld+json">
  {
    "@context": "http://schema.org",
    "@type": "WebPage",
    "headline": "Raspberry Pi GPIO control over MQTT using Thingsboard",
    "image": "http://localhost:4000/images/thingsboard_logo.png",
    "description": "Thingsboard IoT Platform sample for Raspberry Pi GPIO control over MQTT",
    "logo": "http://localhost:4000/images/thingsboard_logo.png",
    "url": "http://localhost:4000/docs/samples/raspberry/gpio/"
  }
</script>
<!-- End Jekyll SEO tag -->
	
	
	<meta name="twitter:description" content="Thingsboard IoT Platform sample for Raspberry Pi GPIO control over MQTT"/>
	
	
	<link rel="shortcut icon" type="image/png" href="/images/favicon.png">
	<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700" rel="stylesheet">
	<link rel="stylesheet" href="/css/styles.css">
	<script type="text/javascript">
		/*! loadCSS. [c]2017 Filament Group, Inc. MIT License */
		!function(a){"use strict";var b=function(b,c,d){function e(a){return h.body?a():void setTimeout(function(){e(a)})}function f(){i.addEventListener&&i.removeEventListener("load",f),i.media=d||"all"}var g,h=a.document,i=h.createElement("link");if(c)g=c;else{var j=(h.body||h.getElementsByTagName("head")[0]).childNodes;g=j[j.length-1]}var k=h.styleSheets;i.rel="stylesheet",i.href=b,i.media="only x",e(function(){g.parentNode.insertBefore(i,c?g:g.nextSibling)});var l=function(a){for(var b=i.href,c=k.length;c--;)if(k[c].href===b)return a();setTimeout(function(){l(a)})};return i.addEventListener&&i.addEventListener("load",f),i.onloadcssdefined=l,l(f),i};"undefined"!=typeof exports?exports.loadCSS=b:a.loadCSS=b}("undefined"!=typeof global?global:this);
		/*! onloadCSS. (onload callback for loadCSS) [c]2017 Filament Group, Inc. MIT License */
		function onloadCSS(a,b){function c(){!d&&b&&(d=!0,b.call(a))}var d;a.addEventListener&&a.addEventListener("load",c),a.attachEvent&&a.attachEvent("onload",c),"isApplicationInstalled"in navigator&&"onloadcssdefined"in a&&a.onloadcssdefined(c)}
	</script>
	<script type="text/javascript">

		function jqueryDefer(method) {
			if (window.jQuery) {
				method();
			} else {
				setTimeout(function() {
					jqueryDefer(method)
				}, 50);
			}
		}

		function jqueryUiDefer(method) {
			if (window.jQuery && window.jQuery.ui) {
				method();
			} else {
				setTimeout(function() {
					jqueryUiDefer(method)
				}, 50);
			}
		}

		function loadScript(src, callback)
		{
			var s, r, t;
			r = false;
			s = document.createElement('script');
			s.type = 'text/javascript';
			s.src = src;
			s.onload = s.onreadystatechange = function() {
				if ( !r && (!this.readyState || this.readyState == 'complete') )
				{
					r = true;
					if (callback) {
						callback();
					}
				}
			};
			t = document.getElementsByTagName('script')[0];
			t.parentNode.insertBefore(s, t);
		}

		function loadCssAsync(src, callback) {
			var stylesheet = loadCSS( src );
			if (callback) {
				onloadCSS(stylesheet, callback);
			}
		}

		function loadNextScript(index, scriptsList, completeCallback) {
			if (index < scriptsList.length) {
				var script = scriptsList[index];
				if (script.type === 'script') {
					loadScript(script.src, function() {
						index++;
						loadNextScript(index, scriptsList, completeCallback);
					});
				} else if (script.type === 'css') {
					loadCssAsync(script.src, function() {
						index++;
						loadNextScript(index, scriptsList, completeCallback);
					});
				}
			} else if (completeCallback) {
				completeCallback();
			}
		}

		var initialScriptsList = [
			{src: '/js/jquery-2.2.0.min.js', type: 'script'},
			{src: '/css/jquery-ui.min.css', type: 'css'},
			{src: '/js/jquery-ui.min.js', type: 'script'},
			{src: '/js/script.js', type: 'script'},
			{src: '/css/sweetalert.css', type: 'css'},
			{src: '/js/sweetalert.min.js', type: 'script'}
		];

		loadNextScript(0, initialScriptsList);

	</script>
	<script type="text/javascript">
		function _gaLt(event) {
			/* If GA is blocked or not loaded, or not main|middle|touch click then don't track */
			if (!ga.hasOwnProperty("loaded") || ga.loaded != true || (event.which != 1 && event.which != 2)) {
				return;
			}
			var el = event.srcElement || event.target;

			while (el && (typeof el.tagName == 'undefined' || el.tagName.toLowerCase() != 'a' || !el.href)) {
				el = el.parentNode;
			}
			if (el && el.href) {
				var link = el.href;
				if ((link.indexOf(location.host) == -1 || link.indexOf('.' + location.host) > 0) && !link.match(/^javascript\:/i)) {
					var target = (el.target && !el.target.match(/^_(self|parent|top)$/i)) ? el.target : false;
					if (event.ctrlKey || event.shiftKey || event.metaKey || event.which == 2) {
						target = "_blank";
					}

					var hbrun = false; // tracker has not yet run
					var hitBack = function() {
						if (hbrun) return;
						hbrun = true;
						window.location.href = link;
					};

					if (target) {
						ga(
								"send", "event", "Outgoing Links", link,
								document.location.pathname + document.location.search
						);
					} else {
						event.preventDefault ? event.preventDefault() : event.returnValue = !1;
						ga(
								"send", "event", "Outgoing Links", link,
								document.location.pathname + document.location.search, {
									"hitCallback": hitBack
								}
						);

						setTimeout(hitBack, 1000);
					}
				}
			}
		}

		var _w = window;
		var _gaLtEvt = ("ontouchstart" in _w) ? "click" : "mousedown";
		_w.addEventListener ? _w.addEventListener("load", function() {document.body.addEventListener(_gaLtEvt, _gaLt, !1)}, !1)
				: _w.attachEvent && _w.attachEvent("onload", function() {document.body.attachEvent("on" + _gaLtEvt, _gaLt)});
	</script>
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
					(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
				m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-88383331-1', 'auto');
		ga('send', 'pageview');
	</script>
</head>
<body>
<div id="cellophane" onclick="tb.toggleMenu()"></div>
<header>
	<a href="/" class="logo"></a>
	<div id="githubButtonContainer">
		<iframe id="gh-btn-frame" src="https://ghbtns.com/github-btn.html?user=thingsboard&repo=thingsboard&type=star&count=true&size=large"
				frameborder="0"
				scrolling="0" width="130px" height="30px"></iframe>
	</div>
	<div class="nav-buttons" data-auto-burger="primary">
		<a href="/docs/" class="button" id="viewDocs" data-auto-burger-exclude>View Documentation</a>
		<a href="/iot-use-cases/" class="button" id="useCases" data-auto-burger-exclude>Use cases</a>
		<a href="/docs/getting-started-guides/helloworld/" class="button" id="gettingStarted" data-auto-burger-exclude>Getting started</a>
		<a target="_blank" href="https://demo.thingsboard.io/signup" class="button" id="liveDemo" data-auto-burger-exclude>Live demo</a>
		<button id="hamburger" onclick="tb.toggleMenu()" data-auto-burger-exclude><div></div></button>
	</div>

	<nav id="mainNav">
		<main id="headNav" data-auto-burger="primary">
			<div class="nav-box">
				<h3><a href="/docs/getting-started-guides/helloworld/">Get Started</a></h3>
			</div>
			<div class="nav-box">
				<h3><a href="/docs/">Documentation</a></h3>
			</div>
			<div class="nav-box">
				<h3><a href="/iot-use-cases/">Use cases</a></h3>
			</div>
			<div class="nav-box">
				<h3><a href="http://blog.thingsboard.io/">Blog</a></h3>
			</div>
			<div class="nav-box">
				<h3><a href="/docs/services/">Services</a></h3>
			</div>
			<div class="nav-box">
				<h3><a href="/docs/contact-us/">Contact us</a></h3>
			</div>
		</main>
		<main data-auto-burger="primary">
			<div class="center">
				<div class="social">
					<a href="https://twitter.com/thingsboard" class="twitter"><span>Twitter</span></a>
					<a href="https://github.com/thingsboard/thingsboard" class="github"><span>Github</span></a>
					<a href="https://gitter.im/thingsboard/chat" class="gitter"><span>Gitter</span></a>
					<a href="http://stackoverflow.com/questions/tagged/thingsboard" class="stack-overflow"><span>Stack Overflow</span></a>
					<a href="https://groups.google.com/forum/#!forum/thingsboard" class="mailing-list"><span>Mailing List</span></a>
					<a href="https://www.youtube.com/channel/UCDb9fsV-YR4JmnipAMGsVAQ" class="youtube"><span>YouTube Channel</span></a>
					<a href="https://www.facebook.com/thingsboard" class="facebook"><span>Facebook Page</span></a>
				</div>
			</div>
			<div class="clear" style="clear: both"></div>
		</main>
	</nav>
</header>


<!--  HERO  -->
<section id="hero" class="light-text">
  <h1>Samples</h1>
  <h5>A collection of example applications that show how to use Thingsboard.</h5>
  <div id="vendorStrip" class="light-text">
    <div id="docsList">
        <ul>
          <li><a href="/docs/" >DOCS HOME</a></li>
          <li><a href="/docs/api/" >API</a></li>
          <li><a href="/docs/iot-gateway/" >IOT GATEWAY</a></li>
          <li><a href="/docs/reference/" >REFERENCE</a></li>
          <li><a href="/docs/samples/" class="YAH">SAMPLES</a></li>
          <li><a href="/iot-use-cases/" >USE CASES</a></li>
          <li><a href="/docs/iot-video-tutorials/" >VIDEO TUTORIALS</a></li>
          <li><a href="/docs/faq/" >FAQ</a></li>
          <li><a href="/docs/services/" >SERVICES</a></li>
          <li><a href="/docs/contact-us/" >CONTACT US</a></li>
        </ul>
    </div>
    <div id="searchBox">
      <input type="text" id="search" placeholder="Search" onkeydown="if (event.keyCode==13) window.location.replace('/docs/search/?q=' + this.value)">
    </div>
  </div>
</section>





<section id="encyclopedia">
  
  <div id="docsToc" >
        <div class="pi-accordion">
        
    <a class="item" data-title="Samples" href="/docs/samples/"></a>
    <a class="item" data-title="Live Demo Server" href="/docs/user-guide/live-demo/"></a>
    <a class="item" data-title="Local Demo Account" href="/docs/samples/demo-account/"></a>
<div class="item" data-title="Hardware samples">
  <div class="container">
<div class="item" data-title="Arduino">
  <div class="container">
    <a class="item" data-title="Arduino overview" href="/docs/samples/arduino/"></a>
    <a class="item" data-title="Temperature upload over MQTT using Arduino UNO, ESP8266 and DHT22 sensor" href="/docs/samples/arduino/temperature/"></a>
  </div>
</div>
<div class="item" data-title="ESP8266">
  <div class="container">
    <a class="item" data-title="ESP8266 overview" href="/docs/samples/esp8266/"></a>
    <a class="item" data-title="Temperature upload over MQTT using ESP8266 and DHT22 sensor" href="/docs/samples/esp8266/temperature/"></a>
    <a class="item" data-title="ESP8266 GPIO control over MQTT using Thingsboard" href="/docs/samples/esp8266/gpio/"></a>
  </div>
</div>
<div class="item" data-title="NodeMCU">
  <div class="container">
    <a class="item" data-title="NodeMCU overview" href="/docs/samples/nodemcu/"></a>
    <a class="item" data-title="Temperature upload over MQTT using NodeMCU and DHT11 sensor" href="/docs/samples/nodemcu/temperature/"></a>
  </div>
</div>
<div class="item" data-title="Raspberry Pi">
  <div class="container">
    <a class="item" data-title="Raspberry Pi overview" href="/docs/samples/raspberry/"></a>
    <a class="item" data-title="Raspberry Pi GPIO control over MQTT using Thingsboard" href="/docs/samples/raspberry/gpio/"></a>
    <a class="item" data-title="Raspberry Pi GPIO control using Android Things and Thingsboard" href="/docs/samples/raspberry/gpio-android-things/"></a>
    <a class="item" data-title="Temperature upload over MQTT using Raspberry Pi and DHT22 sensor" href="/docs/samples/raspberry/temperature/"></a>
  </div>
</div>
<div class="item" data-title="LinkIt ONE">
  <div class="container">
    <a class="item" data-title="LinkIt ONE overview" href="/docs/samples/linkit-one/"></a>
    <a class="item" data-title="GPS data upload and visualization using LinkIt ONE and Thingsboard" href="/docs/samples/linkit-one/gps/"></a>
  </div>
</div>
  </div>
</div>
<div class="item" data-title="Tutorials">
  <div class="container">
<div class="item" data-title="Alarms">
  <div class="container">
    <a class="item" data-title="Sending Alarms using Email Plugin" href="/docs/samples/alarms/mail/"></a>
    <a class="item" data-title="Alarms based on devices attributes and sensor readings" href="/docs/samples/alarms/basic-rules/"></a>
  </div>
</div>
    <a class="item" data-title="Facilities Monitoring PoC" href="/docs/samples/monitoring/facilities-monitoring-poc/"></a>
  </div>
</div>
        </div> <!-- /pi-accordion -->
    <button class="push-menu-close-button" onclick="tb.toggleToc()"></button>
  </div> <!-- /docsToc -->
  
  <div id="docsContent" class="">
    <h1>Raspberry Pi GPIO control over MQTT using Thingsboard</h1>
    <ul id="markdown-toc">
  <li><a href="#introduction" id="markdown-toc-introduction">Introduction</a></li>
  <li><a href="#prerequisites" id="markdown-toc-prerequisites">Prerequisites</a></li>
  <li><a href="#list-of-hardware-and-pinouts" id="markdown-toc-list-of-hardware-and-pinouts">List of hardware and pinouts</a></li>
  <li><a href="#wiring-schema" id="markdown-toc-wiring-schema">Wiring schema</a></li>
  <li><a href="#programming-the-raspberry-pi" id="markdown-toc-programming-the-raspberry-pi">Programming the Raspberry Pi</a>    <ul>
      <li><a href="#mqtt-library-installation" id="markdown-toc-mqtt-library-installation">MQTT library installation</a></li>
      <li><a href="#application-source-code" id="markdown-toc-application-source-code">Application source code</a></li>
      <li><a href="#running-the-application" id="markdown-toc-running-the-application">Running the application</a></li>
    </ul>
  </li>
  <li><a href="#data-visualization" id="markdown-toc-data-visualization">Data visualization</a></li>
  <li><a href="#next-steps" id="markdown-toc-next-steps">Next steps</a></li>
  <li><a href="#your-feedback" id="markdown-toc-your-feedback">Your feedback</a></li>
</ul>

<h2 id="introduction">Introduction</h2>
<p>Thingsboard is an open-source server-side platform that allows you to monitor and control IoT devices. 
It is free for both personal and commercial usage and you can deploy it anywhere. 
If this is your first experience with the platform we recommend to review 
<a href="/docs/getting-started-guides/what-is-thingsboard/">what-is-thingsboard</a> page and <a href="/docs/getting-started-guides/helloworld/">getting-started</a> guide.</p>

<p>This sample application will allow you to control GPIO of your Raspberry Pi device using Thingsboard web UI. We will observe GPIO control using Led connected to one of the pins. 
The purpose of this application is to demonstrate Thingsboard <a href="/docs/user-guide/rpc/">RPC capabilities</a>.</p>

<p>Raspberry Pi will use simple application written in Python that will connect to Thingsboard server via <a href="https://en.wikipedia.org/wiki/MQTT">MQTT</a> and listen to RPC commands.
Current GPIO state and GPIO control widget is visualized using built-in customizable dashboard.</p>

<p>The video below demonstrates the final result of this tutorial.</p>

<p><br />
<br /></p>
<div id="video">
  <div id="video_wrapper">
    <iframe src="https://www.youtube.com/embed/SRnYjoS3M0Y" frameborder="0" allowfullscreen=""></iframe>
  </div>
</div>
<p><br />
<br /></p>

<h2 id="prerequisites">Prerequisites</h2>

<p>You will need to Thingsboard server up and running. Use either <a href="https://demo.thingsboard.io/signup">Live Demo</a> or 
<a href="/docs/user-guide/install/installation-options/">Installation Guide</a> to install Thingsboard.</p>

<h2 id="list-of-hardware-and-pinouts">List of hardware and pinouts</h2>

<ul>
  <li>
    <p><a href="https://en.wikipedia.org/wiki/Raspberry_Pi">Raspberry Pi</a> - we will use Raspberry Pi 3 Model B but you can use any other model.</p>
  </li>
  <li>
    <p>Led and corresponding resistor</p>
  </li>
  <li>
    <p>2 female-to-male jumper wires</p>
  </li>
</ul>

<h2 id="wiring-schema">Wiring schema</h2>

<p>Since our application will allow to control state of all available GPIO pins, we recommend to attach some LEDs to those pins for visibility.
 You can use this <a href="https://www.raspberrypi.org/documentation/usage/gpio/">basic instruction</a> or <a href="https://projects.drogon.net/raspberry-pi/gpio-examples/tux-crossing/gpio-examples-1-a-single-led/">another one</a> to wire some LEDs.</p>

<h2 id="programming-the-raspberry-pi">Programming the Raspberry Pi</h2>

<h3 id="mqtt-library-installation">MQTT library installation</h3>

<p>Following command will install MQTT Python library:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>sudo pip install paho-mqtt
</code></pre>
</div>

<h3 id="application-source-code">Application source code</h3>

<p>Our application consists of single python script that is well commented. 
You will need to modify <strong>THINGSBOARD_HOST</strong> constant to match your Thingsboard server installation IP address or hostname. 
Use “demo.thingsboard.io” if you are using <a href="https://demo.thingsboard.io/">live demo</a> server.</p>

<p>The value of <strong>ACCESS_TOKEN</strong> constant corresponds to sample Raspberry Pi device in pre-provisioned <a href="/docs/samples/demo-account/#tenant-devices">demo data</a>.
If you are using <a href="https://demo.thingsboard.io/">live demo</a> server - <a href="/docs/user-guide/ui/devices/#manage-device-credentials">get the access token</a> for pre-provisioned “Raspberry Pi Demo Device”.</p>

<script>
  jqueryUiDefer(initTabs);
  function initTabs() {
    $(function(){$("#python-script").tabs();});
  }
</script>

<div id="python-script">
  <ul>
    <li><a href="#gpio">gpio.py</a></li>
  </ul>
  <div id="gpio">
    <table class="includecode"><thead><tr><th><a href="https://raw.githubusercontent.com/thingsboard/thingsboard.github.io/master/docs/samples/raspberry/resources/gpio.py" download="resources/gpio.py"><code>resources/gpio.py</code></a><img src="/images/copycode.svg" style="max-height:24px" onclick="copyCode('resources/gpio.py')" title="Copy resources/gpio.py to clipboard" /></th></tr></thead>
<tr><td>
<div id="resources/gpio.py" class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">paho.mqtt.client</span> <span class="kn">as</span> <span class="nn">mqtt</span>
<span class="kn">import</span> <span class="nn">RPi.GPIO</span> <span class="kn">as</span> <span class="nn">GPIO</span>
<span class="kn">import</span> <span class="nn">json</span>

<span class="n">THINGSBOARD_HOST</span> <span class="o">=</span> <span class="s">'YOUR_THINGSBOARD_IP_OR_HOSTNAME'</span>
<span class="n">ACCESS_TOKEN</span> <span class="o">=</span> <span class="s">'RASPBERRY_PI_DEMO_TOKEN'</span>

<span class="c"># We assume that all GPIOs are LOW</span>
<span class="n">gpio_state</span> <span class="o">=</span> <span class="p">{</span><span class="mi">7</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span> <span class="mi">11</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span> <span class="mi">12</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span> <span class="mi">13</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span> <span class="mi">15</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span> <span class="mi">16</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span> <span class="mi">18</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span> <span class="mi">22</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span> <span class="mi">29</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
              <span class="mi">31</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span> <span class="mi">32</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span> <span class="mi">33</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span> <span class="mi">35</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span> <span class="mi">36</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span> <span class="mi">37</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span> <span class="mi">38</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span> <span class="mi">40</span><span class="p">:</span> <span class="bp">False</span><span class="p">}</span>


<span class="c"># The callback for when the client receives a CONNACK response from the server.</span>
<span class="k">def</span> <span class="nf">on_connect</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">userdata</span><span class="p">,</span> <span class="n">rc</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Connected with result code '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rc</span><span class="p">))</span>
    <span class="c"># Subscribing to receive RPC requests</span>
    <span class="n">client</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span><span class="s">'v1/devices/me/rpc/request/+'</span><span class="p">)</span>
    <span class="c"># Sending current GPIO status</span>
    <span class="n">client</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="s">'v1/devices/me/attributes'</span><span class="p">,</span> <span class="n">get_gpio_status</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>


<span class="c"># The callback for when a PUBLISH message is received from the server.</span>
<span class="k">def</span> <span class="nf">on_message</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">userdata</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">'Topic: '</span> <span class="o">+</span> <span class="n">msg</span><span class="o">.</span><span class="n">topic</span> <span class="o">+</span> <span class="s">'</span><span class="se">\n</span><span class="s">Message: '</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">payload</span><span class="p">)</span>
    <span class="c"># Decode JSON request</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">payload</span><span class="p">)</span>
    <span class="c"># Check request method</span>
    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s">'method'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'getGpioStatus'</span><span class="p">:</span>
        <span class="c"># Reply with GPIO status</span>
        <span class="n">client</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">topic</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'request'</span><span class="p">,</span> <span class="s">'response'</span><span class="p">),</span> <span class="n">get_gpio_status</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">data</span><span class="p">[</span><span class="s">'method'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'setGpioStatus'</span><span class="p">:</span>
        <span class="c"># Update GPIO status and reply</span>
        <span class="n">set_gpio_status</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s">'params'</span><span class="p">][</span><span class="s">'pin'</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s">'params'</span><span class="p">][</span><span class="s">'enabled'</span><span class="p">])</span>
        <span class="n">client</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">msg</span><span class="o">.</span><span class="n">topic</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'request'</span><span class="p">,</span> <span class="s">'response'</span><span class="p">),</span> <span class="n">get_gpio_status</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">client</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="s">'v1/devices/me/attributes'</span><span class="p">,</span> <span class="n">get_gpio_status</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">get_gpio_status</span><span class="p">():</span>
    <span class="c"># Encode GPIOs state to json</span>
    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">gpio_state</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">set_gpio_status</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span> <span class="n">status</span><span class="p">):</span>
    <span class="c"># Output GPIOs state</span>
    <span class="n">GPIO</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">HIGH</span> <span class="k">if</span> <span class="n">status</span> <span class="k">else</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">LOW</span><span class="p">)</span>
    <span class="c"># Update GPIOs state</span>
    <span class="n">gpio_state</span><span class="p">[</span><span class="n">pin</span><span class="p">]</span> <span class="o">=</span> <span class="n">status</span>


<span class="c"># Using board GPIO layout</span>
<span class="n">GPIO</span><span class="o">.</span><span class="n">setmode</span><span class="p">(</span><span class="n">GPIO</span><span class="o">.</span><span class="n">BOARD</span><span class="p">)</span>
<span class="k">for</span> <span class="n">pin</span> <span class="ow">in</span> <span class="n">gpio_state</span><span class="p">:</span>
    <span class="c"># Set output mode for all GPIO pins</span>
    <span class="n">GPIO</span><span class="o">.</span><span class="n">setup</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span> <span class="n">GPIO</span><span class="o">.</span><span class="n">OUT</span><span class="p">)</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">mqtt</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>
<span class="c"># Register connect callback</span>
<span class="n">client</span><span class="o">.</span><span class="n">on_connect</span> <span class="o">=</span> <span class="n">on_connect</span>
<span class="c"># Registed publish message callback</span>
<span class="n">client</span><span class="o">.</span><span class="n">on_message</span> <span class="o">=</span> <span class="n">on_message</span>
<span class="c"># Set access token</span>
<span class="n">client</span><span class="o">.</span><span class="n">username_pw_set</span><span class="p">(</span><span class="n">ACCESS_TOKEN</span><span class="p">)</span>
<span class="c"># Connect to Thingsboard using default MQTT port and 60 seconds keepalive interval</span>
<span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">THINGSBOARD_HOST</span><span class="p">,</span> <span class="mi">1883</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">client</span><span class="o">.</span><span class="n">loop_forever</span><span class="p">()</span>
<span class="k">except</span> <span class="nb">KeyboardInterrupt</span><span class="p">:</span>
    <span class="n">GPIO</span><span class="o">.</span><span class="n">cleanup</span><span class="p">()</span>
</code></pre>
</div>
</td></tr></table>
  </div>
</div>

<h3 id="running-the-application">Running the application</h3>

<p>This simple command will launch the application:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>python gpio.py
</code></pre>
</div>

<h2 id="data-visualization">Data visualization</h2>

<p>In order to simplify this guide we have included “Raspberry PI GPIO Demo Dashboard” to the <a href="/docs/samples/demo-account/#dashboards">demo data</a> that is available in each thingboard installation. 
Of course, you can modify this dashboard: tune, add, delete widgets, etc.
You can access this dashboard by logging in as a tenant administrator. Use</p>

<ul>
  <li>login: tenant@thingsboard.org</li>
  <li>password: tenant</li>
</ul>

<p>in case of local Thingsboard installation.</p>

<p>Once logged in, open <strong>Dashboards-&gt;Raspberry PI GPIO Demo Dashboard</strong> page. You should observe demo dashboard with GPIO control and status panel for your device. 
Now you can switch status of GPIOs using control panel. As a result you will see LEDs status change on device and on the status panel.</p>

<p>Below is the screenshot of the “Raspberry PI GPIO Demo Dashboard”.</p>

<p><img src="/images/samples/raspberry/gpio/dashboard.png" alt="image" /></p>

<h2 id="next-steps">Next steps</h2>

<p>Browse other <a href="/docs/samples">samples</a> or explore guides related to main Thingsboard features:</p>

<ul>
  <li><a href="/docs/user-guide/attributes/">Device attributes</a> - how to use device attributes.</li>
  <li><a href="/docs/user-guide/telemetry/">Telemetry data collection</a> - how to collect telemetry data.</li>
  <li><a href="/docs/user-guide/rpc/">Using RPC capabilities</a> - how to send commands to/from devices.</li>
  <li><a href="/docs/user-guide/rule-engine/">Rule Engine</a> - how to use rule engine to analyze data from devices.</li>
  <li><a href="/docs/user-guide/visualization/">Data Visualization</a> - how to visualize collected data.</li>
</ul>

<h2 id="your-feedback">Your feedback</h2>

<p>Don’t hesitate to star Thingsboard on <strong><a href="https://github.com/thingsboard/thingsboard">github</a></strong> to help us spread the word.
If you have some questions about this sample - post it on the <strong><a href="https://groups.google.com/forum/#!forum/thingsboard">forum</a></strong>.</p>

<div id="share"></div>
<script>
    jqueryDefer(initSocials);
    function initSocials() {
        var scriptsList = [
            {src: 'https://cdn.jsdelivr.net/jquery.jssocials/1.4.0/jssocials.css', type: 'css'},
            {src: 'https://cdn.jsdelivr.net/jquery.jssocials/1.4.0/jssocials-theme-flat.css', type: 'css'},
            {src: 'https://cdn.jsdelivr.net/jquery.jssocials/1.4.0/jssocials.min.js', type: 'script'}
        ];
        loadNextScript(0, scriptsList,
                function() {
                    $("#share").jsSocials({
                        shares: ["email", "twitter", "facebook", "googleplus", "linkedin", "pinterest", "stumbleupon", "whatsapp", "telegram"],
                        showLabel: false,
                        showCount: false
                    });
                }
        );
    }
</script>


  </div>
</section>

<footer>
	<main class="light-text">
		<nav>
			<a href="/docs/getting-started-guides/helloworld/">Get Started</a>
			<a href="/docs/">Documentation</a>
			<a href="/iot-use-cases/">Use cases</a>
			<a href="https://blog.thingsboard.io/">Blog</a>
			<a href="/docs/services/">Services</a>
			<a href="/docs/contact-us/">Contact us</a>
		</nav>
		<div class="newsletterSubsContainer">
			<form id="newsletter-form" method="post" onsubmit="return validateNewsletterForm(this)">
				<fieldset>
					<div class="newsletterInputs">
						<p class="subsTitle">Sign up for Thingsboard IoT newsletter</p>
						<input id="subsEmail" placeholder="Email" class="text-input" name="email" type="text" size="20" maxlength="80">
						<input type="hidden" name="_next" value="/docs/newsletter-thanks/" />
						<input type="text" name="_gotcha" style="display:none" />
						<input class="button" value="Submit" type="submit">
					</div>
				</fieldset>
			</form>
		</div>
		<div class="center">
			<div class="social">
				<div>
					<a href="https://twitter.com/thingsboard" class="twitter"><span>twitter</span></a>
					<a href="https://github.com/thingsboard/thingsboard" class="github"><span>Github</span></a>
					<a href="https://gitter.im/thingsboard/chat" class="gitter"><span>Gitter</span></a>
					<a href="http://stackoverflow.com/questions/tagged/thingsboard" class="stack-overflow"><span>Stack Overflow</span></a>
				</div>
				<div>
					<a href="https://groups.google.com/forum/#!forum/thingsboard" class="mailing-list"><span>Mailing List</span></a>
					<a href="https://www.youtube.com/channel/UCDb9fsV-YR4JmnipAMGsVAQ" class="youtube"><span>YouTube Channel</span></a>
					<a href="https://www.facebook.com/thingsboard" class="facebook"><span>Facebook Page</span></a>
				</div>
			</div>
		</div>
		<div id="miceType" class="center">&copy; 2017 The Thingsboard Authors</div>
	</main>

	<script type="text/javascript">

		function validateNewsletterForm(form) {
			var email = $('input[name=email]', form).val();

			if (!validateValue('Email Address', email)) {
				return false;
			}

			var emailExp = /^[a-zA-Z0-9._%-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/;
			if(email.match(emailExp)==null) {
				window.alert("Entered Email Address is not valid.");
				return false;
			}
			return true;
		}

		function validateValue(name, val) {
			if (isEmpty(val)) {
				window.alert("Please fill '" + name + "' field.");
				return false;
			}
			return true;
		}

		function isEmpty(val) {
			return val === undefined || val.trim().length == 0;
		}

	</script>

	<script type="text/javascript">

		var newsletterform =  document.getElementById('newsletter-form');
		newsletterform.setAttribute('action', 'https://formspree.io/' + 'newsletter' + '@' + 'thingsboard' + '.' + 'io');

	</script>

</footer>



<button class="flyout-button" onclick="tb.toggleToc()"></button>


<style>
  .cse .gsc-control-cse, .gsc-control-cse {
    padding: 0;
  }
  .gsc-control-cse table, .gsc-control-cse-en table {
    margin:0px !important;
  }
  .gsc-above-wrapper-area {
    border-bottom: 0;
  }
</style>
</body>
</html>
